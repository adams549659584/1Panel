import{d as B,x as R,S as te,r as f,o as T,b as s,h as $,i as O,e as o,w as n,c as k,y as U,F as j,O as z,v as oe,K as M,L as J,a2 as Q,f as ne,g as F,t as w,Y as re,ag as N,$ as ae,j as L,a1 as ve,av as _e,J as be,l as ge,m as ye,ah as ke,a3 as Ve,A as ue,af as $e,a5 as se,Q as he,aq as Ie,p as Ce,X as Ue}from"./index-9eeac04e.js";/* empty css                *//* empty css               *//* empty css                *//* empty css                     *//* empty css                 *//* empty css            */import{_ as Ee}from"./index-e1bcfb8a.js";/* empty css               */import{C as Se,U as De,G as Pe,D as Re,S as qe}from"./runtime-58d185e4.js";import{t as we,b as Oe}from"./util-cbaccc93.js";import{_ as je}from"./index-913c5065.js";import{_ as Ae}from"./index-8d9ad139.js";import{_ as Fe}from"./layout-content-27c09564.js";import{_ as ze}from"./index-bb4c3e65.js";/* empty css                *//* empty css             *//* empty css              *//* empty css            *//* empty css              *//* empty css               *//* empty css                    *//* empty css              */import"./form-item-d76e7d20.js";import{S as Ke,d as Ne,e as Le}from"./app-b908b206.js";import{R as D}from"./form-rules-028b05ac.js";import{_ as le}from"./index-167a1d38.js";import{u as Be}from"./use-delete-data-8b6821a4.js";import"./tooltip-b30db216.js";import"./index-5ffc91ba.js";/* empty css             *//* empty css                     *//* empty css              *//* empty css                    *//* empty css             */const Ge=B({__name:"index",props:{form:{type:Object,default:function(){return{}}},params:{type:Object,default:function(){return{}}},rules:{type:Object,default:function(){return{}}}},emits:["update:form","update:rules"],setup(A,{emit:h}){const E=A;let d=R({}),b=R({});const V=te({get(){return E.params},set(){}}),v=()=>{h("update:form",d)},g=f([]),p=()=>{if(b=E.rules,V.value!=null&&V.value.formFields!=null){for(const a of V.value.formFields){const I=a;I.prop=a.envKey,I.disabled=a.disabled,d[a.envKey]="",g.value.push(I),a.required&&(a.type==="select"?b[a.envKey]=[D.requiredSelect]:b[a.envKey]=[D.requiredInput])}h("update:rules",b),v()}},S=a=>oe().locale.value=="zh"?a.labelZh:a.labelEn;return T(()=>{p()}),(a,I)=>{const r=M,l=J,_=Q;return s(!0),$(j,null,O(g.value,(i,C)=>(s(),$("div",{key:C},[o(_,{label:S(i),prop:i.prop},{default:n(()=>[i.type=="select"?(s(),k(l,{key:0,modelValue:U(d)[i.envKey],"onUpdate:modelValue":c=>U(d)[i.envKey]=c,multiple:i.multiple,filterable:"",onChange:v},{default:n(()=>[(s(!0),$(j,null,O(i.values,c=>(s(),k(r,{key:c.label,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","multiple"])):z("",!0)]),_:2},1032,["label","prop"])]))),128)}}}),Ze=B({__name:"index",props:{form:{type:Object,default:function(){return{}}},params:{type:Array,default:function(){return[]}},rules:{type:Object,default:function(){return{}}}},emits:["update:form","update:rules"],setup(A,{emit:h}){const E=A;let d=R({}),b=R({});const V=te({get(){return E.params},set(){}}),v=()=>{h("update:form",d)},g=f([]),p=()=>{if(b=E.rules,V.value!=null){for(const a of V.value)d[a.key]=a.value,g.value.push({prop:a.key,labelEn:a.labelEn,labelZh:a.labelZh,values:a.values,value:a.value,required:a.required,edit:a.edit,key:a.key,rule:a.rule,type:a.type,multiple:a.multiple}),a.required&&(a.type==="select"?b[a.key]=[D.requiredSelect]:b[a.key]=[D.requiredInput]);h("update:rules",b),v()}},S=a=>oe().locale.value=="zh"?a.labelZh:a.labelEn;return T(()=>{p()}),(a,I)=>{const r=M,l=J,_=Q;return s(!0),$(j,null,O(g.value,(i,C)=>(s(),$("div",{key:C},[o(_,{label:S(i),prop:i.prop},{default:n(()=>[i.type=="select"?(s(),k(l,{key:0,modelValue:U(d)[i.key],"onUpdate:modelValue":c=>U(d)[i.key]=c,multiple:i.multiple,filterable:"",onChange:v},{default:n(()=>[(s(!0),$(j,null,O(i.values,c=>(s(),k(r,{key:c.label,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","multiple"])):z("",!0)]),_:2},1032,["label","prop"])]))),128)}}}),He={key:0},Te={key:0},Me={key:1},Je=B({__name:"index",emits:["close"],setup(A,{expose:h,emit:E}){const d=f(!1),b=f([]),V=f(),v=f(!1),g=f(!1),p=f("create");let S=f(),a=f(),I=f([]),r=R({type:"php",page:1,pageSize:20});const l=f({name:"",appDetailId:void 0,image:"",params:{},type:"php",resource:"appstore"});let _=f({name:[D.appName],resource:[D.requiredInput],appId:[D.requiredSelect],version:[D.requiredInput],image:[D.requiredInput,D.imageName]});const i=()=>{d.value=!1,E("close",!1)},C=u=>{u==="local"?(l.value.appDetailId=void 0,l.value.version="",l.value.params={},l.value.image=""):(l.value.version="",c(null))},c=u=>{Ke(r).then(e=>{b.value=e.data.items||[],e.data&&e.data.items&&e.data.items.length>0&&(u==null?(l.value.appId=e.data.items[0].id,K(e.data.items[0].key,p.value)):e.data.items.forEach(m=>{m.id===u&&K(m.key,p.value)}))})},K=(u,e)=>{Ne(u).then(m=>{I.value=m.data.versions||[],m.data.versions.length>0&&(l.value.version=m.data.versions[0],e==="create"?Le(l.value.appId,l.value.version,"runtime").then(P=>{l.value.appDetailId=P.data.id,l.value.image=P.data.image+":"+l.value.version,S.value=P.data.params,g.value=!0}):g.value=!0)})},G=async u=>{!u||await u.validate(e=>{!e||(v.value=!0,p.value=="create"?Se(l.value).then(()=>{ae(L.global.t("commons.msg.createSuccess")),i()}).finally(()=>{v.value=!1}):De(l.value).then(()=>{ae(L.global.t("commons.msg.updateSuccess")),i()}).finally(()=>{v.value=!1}))})},y=async u=>{try{const m=(await Pe(u)).data;l.value={id:m.id,name:m.name,appDetailId:m.appDetailId,image:m.image,params:{},type:m.type,resource:m.resource,appId:m.appId,version:m.version},a.value=m.appParams,p.value=="create"?c(m.appId):g.value=!0}catch{}};return h({acceptParams:async u=>{p.value=u.mode,u.mode==="create"?(l.value={name:"",appDetailId:void 0,image:"",params:{},type:u.type,resource:"appstore"},c(null)):y(u.id),d.value=!0}}),(u,e)=>{const m=ze,P=ve,q=Q,X=_e,pe=be,Y=M,W=J,Z=ge,x=ye,me=ke,de=Ve,ee=ue,ce=$e,fe=se;return s(),k(ce,{"close-on-click-modal":!1,modelValue:d.value,"onUpdate:modelValue":e[14]||(e[14]=t=>d.value=t),size:"50%"},{header:n(()=>[o(m,{header:u.$t("runtime.create"),back:i},null,8,["header"])]),footer:n(()=>[ne("span",null,[o(ee,{onClick:i,disabled:v.value},{default:n(()=>[F(w(u.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),o(ee,{type:"primary",onClick:e[13]||(e[13]=t=>G(V.value)),disabled:v.value},{default:n(()=>[F(w(u.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:n(()=>[re((s(),k(x,null,{default:n(()=>[o(Z,{span:22,offset:1},{default:n(()=>[o(de,{ref_key:"runtimeForm",ref:V,"label-position":"top",model:l.value,"label-width":"125px",rules:U(_),"validate-on-rule-change":!1},{default:n(()=>[o(q,{label:u.$t("runtime.name"),prop:"name"},{default:n(()=>[o(P,{disabled:p.value==="edit",modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t)},null,8,["disabled","modelValue"])]),_:1},8,["label"]),o(q,{label:u.$t("runtime.resource"),prop:"resource"},{default:n(()=>[o(pe,{disabled:p.value==="edit",modelValue:l.value.resource,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.resource=t),onChange:e[2]||(e[2]=t=>C(l.value.resource))},{default:n(()=>[o(X,{label:"appstore"},{default:n(()=>[F(w(u.$t("runtime.appstore")),1)]),_:1}),o(X,{label:"local"},{default:n(()=>[F(w(u.$t("runtime.local")),1)]),_:1})]),_:1},8,["disabled","modelValue"])]),_:1},8,["label"]),l.value.resource==="appstore"?(s(),$("div",He,[o(q,{label:u.$t("runtime.app"),prop:"appId"},{default:n(()=>[o(x,{gutter:20},{default:n(()=>[o(Z,{span:12},{default:n(()=>[o(W,{modelValue:l.value.appId,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.appId=t),disabled:p.value==="edit"},{default:n(()=>[(s(!0),$(j,null,O(b.value,(t,H)=>(s(),k(Y,{key:H,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),o(Z,{span:12},{default:n(()=>[o(W,{modelValue:l.value.version,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.version=t),disabled:p.value==="edit"},{default:n(()=>[(s(!0),$(j,null,O(U(I),(t,H)=>(s(),k(Y,{key:H,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1},8,["label"]),o(q,{label:u.$t("runtime.image"),prop:"image"},{default:n(()=>[o(P,{modelValue:l.value.image,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.image=t)},null,8,["modelValue"])]),_:1},8,["label"]),g.value?(s(),$("div",Te,[p.value==="create"?(s(),k(Ge,{key:0,form:l.value.params,"onUpdate:form":e[6]||(e[6]=t=>l.value.params=t),params:U(S),"onUpdate:params":e[7]||(e[7]=t=>N(S)?S.value=t:S=t),rules:U(_),"onUpdate:rules":e[8]||(e[8]=t=>N(_)?_.value=t:_=t)},null,8,["form","params","rules"])):z("",!0),p.value==="edit"?(s(),k(Ze,{key:1,form:l.value.params,"onUpdate:form":e[9]||(e[9]=t=>l.value.params=t),params:U(a),"onUpdate:params":e[10]||(e[10]=t=>N(a)?a.value=t:a=t),rules:U(_),"onUpdate:rules":e[11]||(e[11]=t=>N(_)?_.value=t:_=t)},null,8,["form","params","rules"])):z("",!0)])):z("",!0)])):(s(),$("div",Me,[o(q,null,{default:n(()=>[o(me,{title:u.$t("runtime.localHelper"),type:"info",closable:!1},null,8,["title"])]),_:1}),o(q,{label:u.$t("runtime.version"),prop:"version"},{default:n(()=>[o(P,{modelValue:l.value.version,"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.version=t)},null,8,["modelValue"])]),_:1},8,["label"])]))]),_:1},8,["model","rules"])]),_:1})]),_:1})),[[fe,v.value]])]),_:1},8,["modelValue"])}}}),Qe={key:1},Ra=B({__name:"index",setup(A){const h=R({currentPage:1,pageSize:10,total:0});let E=R({name:"",page:1,pageSize:40}),d=null;const b=[{label:L.global.t("commons.button.edit"),click:function(r){a(r)}},{label:L.global.t("commons.button.delete"),click:function(r){I(r)}}],V=f(!1),v=f([]),g=f(),p=async()=>{E.page=h.currentPage,E.pageSize=h.pageSize,V.value=!0;try{const r=await qe(E);v.value=r.data.items,h.total=r.data.total}catch{}finally{V.value=!1}},S=()=>{g.value.acceptParams({type:"php",mode:"create"})},a=r=>{g.value.acceptParams({type:r.type,mode:"edit",id:r.id})},I=async r=>{await Be(Re,{id:r.id},"commons.msg.delete"),p()};return T(()=>{p(),d=setInterval(()=>{p()},1e4*3)}),he(()=>{clearInterval(Number(d)),d=null}),(r,l)=>{const _=ue,i=Ee,C=Ie,c=Ce,K=Ue("fu-table-operations"),G=se;return s(),$("div",null,[o(je,{buttons:[{label:"PHP",path:"/runtimes/php"}]}),re((s(),k(Fe,{title:r.$t("runtime.runtime")},{toolbar:n(()=>[o(_,{type:"primary",onClick:S},{default:n(()=>[F(w(r.$t("runtime.create")),1)]),_:1})]),main:n(()=>[o(Ae,{"pagination-config":h,data:v.value,onSearch:l[0]||(l[0]=y=>p())},{default:n(()=>[o(C,{label:r.$t("commons.table.name"),fix:"",prop:"name","min-width":"120px"},{default:n(({row:y})=>[o(i,{text:y.name,onClick:ie=>a(y)},null,8,["text","onClick"])]),_:1},8,["label"]),o(C,{label:r.$t("runtime.resource"),prop:"resource"},{default:n(({row:y})=>[ne("span",null,w(r.$t("runtime."+U(we)(y.resource))),1)]),_:1},8,["label"]),o(C,{label:r.$t("runtime.version"),prop:"version"},null,8,["label"]),o(C,{label:r.$t("runtime.image"),prop:"image","show-overflow-tooltip":""},null,8,["label"]),o(C,{label:r.$t("runtime.status"),prop:"status"},{default:n(({row:y})=>[y.status==="error"?(s(),k(c,{key:0,placement:"bottom",width:400,trigger:"hover",content:y.message},{reference:n(()=>[(s(),k(le,{key:y.status,status:y.status},null,8,["status"]))]),_:2},1032,["content"])):(s(),$("div",Qe,[(s(),k(le,{key:y.status,status:y.status},null,8,["status"]))]))]),_:1},8,["label"]),o(C,{prop:"createdAt",label:r.$t("commons.table.date"),formatter:U(Oe),"show-overflow-tooltip":""},null,8,["label","formatter"]),o(K,{ellipsis:10,width:"260px",buttons:b,label:r.$t("commons.table.operate"),fixed:"right",fix:""},null,8,["label"])]),_:1},8,["pagination-config","data"])]),_:1},8,["title"])),[[G,V.value]]),o(Je,{ref_key:"createRef",ref:g,onClose:p},null,512)])}}});export{Ra as default};
