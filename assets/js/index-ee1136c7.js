import{d as J,r as b,Y as H,b as d,h as g,e as t,w as e,f as y,t as s,g as i,c as _,O as $,$ as j,j as h,ap as ue,E as ie,A as Q,a2 as Z,C as Se,a3 as x,af as ee,au as he,ao as we,a5 as te,x as M,F as X,i as Y,K as de,L as me,a1 as pe,l as ce,m as fe,o as Ve,aq as Ce,k as Re,ae as Fe,y as P,X as re}from"./index-9eeac04e.js";/* empty css                */import{_ as le}from"./index-bb4c3e65.js";/* empty css                */import"./form-item-d76e7d20.js";/* empty css              *//* empty css            *//* empty css               *//* empty css               */import"./tooltip-b30db216.js";/* empty css                     *//* empty css                 *//* empty css            *//* empty css               */import{_ as Ae}from"./index-8d9ad139.js";import{T as Be}from"./index-2dd05578.js";import{y as Ee,z as Ue,A as De,g as be,B as Te,C as Ie,D as Le,E as Pe,F as We}from"./setting-f1c3ee2a.js";import{b as Ne}from"./util-cbaccc93.js";import{u as ze}from"./use-delete-data-8b6821a4.js";import{R as G}from"./form-rules-028b05ac.js";import{_ as Oe}from"./layout-content-27c09564.js";/* empty css               *//* empty css               *//* empty css             *//* empty css             *//* empty css                    *//* empty css                */import"./index-5ffc91ba.js";import"./base64-e52cbffd.js";const Me={class:"card-header"},je={key:0},qe={key:0},He={key:1},Ke={key:1},Xe={key:1},Ye={style:{"word-break":"break-all","flex-wrap":"wrap","word-wrap":"break-word"}},Ge={class:"card-header"},Je={key:0},Qe={key:0},Ze={key:1},xe={key:1},et={key:1},tt={style:{"word-break":"break-all","flex-wrap":"wrap","word-wrap":"break-word"}},lt={class:"card-header"},at={style:{"margin-top":"15px"}},ot={class:"dialog-footer"},st=J({__name:"index",emits:["search"],setup(ae,{expose:F,emit:E}){const v=b(!1),u=b(),k=b(),V=b(),R=b(),S=a=>{u.value=a.snapInfo,v.value=!0},U=()=>{v.value=!1},A=async a=>{k.value=!0,await Ee({id:u.value.id,isNew:a,reDownload:R.value}).then(()=>{E("search"),k.value=!1,V.value=!1,v.value=!1,j(h.global.t("commons.msg.operationSuccess"))}).catch(()=>{k.value=!1})},D=async a=>{ue.confirm(h.global.t("setting.recoverHelper",[u.value.name]),{confirmButtonText:h.global.t("commons.button.confirm"),cancelButtonText:h.global.t("commons.button.cancel"),type:"info"}).then(async()=>{A(a)})},C=async()=>{ue.confirm(h.global.t("setting.rollbackHelper"),{confirmButtonText:h.global.t("commons.button.confirm"),cancelButtonText:h.global.t("commons.button.cancel"),type:"info"}).then(async()=>{k.value=!0,await Ue({id:u.value.id,isNew:!1,reDownload:!1}).then(()=>{E("search"),k.value=!1,V.value=!1,v.value=!1,j(h.global.t("commons.msg.operationSuccess"))}).catch(()=>{k.value=!1})})};return F({acceptParams:S}),(a,p)=>{const m=ie,r=Q,c=Z,T=Se,I=x,W=ee,N=he,z=we,w=te;return H((d(),g("div",null,[t(W,{modelValue:v.value,"onUpdate:modelValue":p[5]||(p[5]=l=>v.value=l)},{header:e(()=>[t(le,{header:a.$t("setting.recoverDetail"),back:U},null,8,["header"])]),default:e(()=>[t(I,{"label-width":"120px"},{default:e(()=>[t(T,null,{header:e(()=>[y("div",Me,[y("span",null,s(a.$t("setting.recover")),1)])]),default:e(()=>[u.value.recoverStatus?(d(),g("div",Ke,[t(c,{label:a.$t("commons.table.status")},{default:e(()=>[u.value.recoverStatus==="Failed"?(d(),_(m,{key:0,type:"danger"},{default:e(()=>[i(s(a.$t("commons.table.statusFailed")),1)]),_:1})):$("",!0),u.value.recoverStatus==="Success"?(d(),_(m,{key:1,type:"success"},{default:e(()=>[i(s(a.$t("commons.table.statusSuccess")),1)]),_:1})):$("",!0),u.value.recoverStatus==="Waiting"?(d(),_(m,{key:2,type:"info"},{default:e(()=>[i(s(a.$t("commons.table.statusWaiting")),1)]),_:1})):$("",!0),t(r,{style:{"margin-left":"15px"},onClick:p[2]||(p[2]=l=>D(!0)),disabled:u.value.recoverStatus!=="Success"},{default:e(()=>[i(s(a.$t("setting.recover")),1)]),_:1},8,["disabled"])]),_:1},8,["label"]),u.value.recoverStatus!=="Waiting"?(d(),_(c,{key:0,label:a.$t("setting.lastRecoverAt")},{default:e(()=>[i(s(u.value.lastRecoveredAt),1)]),_:1},8,["label"])):$("",!0),u.value.recoverStatus==="Failed"?(d(),g("div",Xe,[t(c,{label:a.$t("commons.button.log")},{default:e(()=>[y("span",Ye,s(u.value.recoverMessage),1)]),_:1},8,["label"]),t(c,null,{default:e(()=>[t(r,{onClick:p[3]||(p[3]=l=>V.value=!0),type:"primary"},{default:e(()=>[i(s(a.$t("commons.button.retry")),1)]),_:1})]),_:1})])):$("",!0)])):(d(),g("div",je,[u.value.lastRecoveredAt?(d(),g("div",qe,[t(c,{label:a.$t("commons.table.status")},{default:e(()=>[t(m,{type:"success"},{default:e(()=>[i(s(a.$t("commons.table.statusSuccess")),1)]),_:1}),t(r,{onClick:p[0]||(p[0]=l=>D(!0)),style:{"margin-left":"10px"},type:"primary"},{default:e(()=>[i(s(a.$t("setting.recover")),1)]),_:1})]),_:1},8,["label"]),t(c,{label:a.$t("setting.lastRecoverAt")},{default:e(()=>[i(s(u.value.lastRecoveredAt),1)]),_:1},8,["label"])])):(d(),g("div",He,[t(c,null,{default:e(()=>[t(m,{type:"info"},{default:e(()=>[i(s(a.$t("setting.noRecoverRecord")),1)]),_:1})]),_:1}),t(c,null,{default:e(()=>[t(r,{onClick:p[1]||(p[1]=l=>D(!0)),type:"primary"},{default:e(()=>[i(s(a.$t("setting.recover")),1)]),_:1})]),_:1})]))]))]),_:1}),u.value.recoverStatus==="Failed"?(d(),_(T,{key:0,style:{"margin-top":"20px"}},{header:e(()=>[y("div",Ge,[y("span",null,s(a.$t("setting.rollback")),1)])]),default:e(()=>[u.value.rollbackStatus?(d(),g("div",xe,[t(c,{label:a.$t("commons.table.status")},{default:e(()=>[u.value.rollbackStatus==="Success"?(d(),_(m,{key:0,type:"success"},{default:e(()=>[i(s(a.$t("commons.table.statusSuccess")),1)]),_:1})):$("",!0),u.value.rollbackStatus==="Failed"?(d(),_(m,{key:1,type:"danger"},{default:e(()=>[i(s(a.$t("commons.table.statusFailed")),1)]),_:1})):$("",!0),u.value.rollbackStatus==="Waiting"?(d(),_(m,{key:2,type:"info"},{default:e(()=>[i(s(a.$t("commons.table.statusWaiting")),1)]),_:1})):$("",!0),t(r,{style:{"margin-left":"15px"},disabled:u.value.rollbackStatus!=="Success",onClick:C},{default:e(()=>[i(s(a.$t("setting.rollback")),1)]),_:1},8,["disabled"])]),_:1},8,["label"]),u.value.rollbackStatus!=="Waiting"?(d(),_(c,{key:0,label:a.$t("setting.lastRollbackAt")},{default:e(()=>[i(s(u.value.lastRollbackedAt),1)]),_:1},8,["label"])):$("",!0),u.value.rollbackStatus==="Failed"?(d(),g("div",et,[t(c,{label:a.$t("commons.button.log")},{default:e(()=>[y("span",tt,s(u.value.rollbackMessage),1)]),_:1},8,["label"]),t(c,null,{default:e(()=>[t(r,{onClick:p[4]||(p[4]=l=>C()),type:"primary"},{default:e(()=>[i(s(a.$t("commons.button.retry")),1)]),_:1})]),_:1})])):$("",!0)])):(d(),g("div",Je,[u.value.lastRollbackedAt?(d(),g("div",Qe,[t(c,{label:a.$t("commons.table.status")},{default:e(()=>[t(m,{type:"success"},{default:e(()=>[i(s(a.$t("commons.table.statusSuccess")),1)]),_:1}),t(r,{onClick:C,style:{"margin-left":"10px"},type:"primary"},{default:e(()=>[i(s(a.$t("setting.recover")),1)]),_:1})]),_:1},8,["label"]),t(c,{label:a.$t("setting.lastRollbackAt")},{default:e(()=>[i(s(u.value.lastRollbackedAt),1)]),_:1},8,["label"])])):(d(),g("div",Ze,[t(c,null,{default:e(()=>[t(m,{type:"info"},{default:e(()=>[i(s(a.$t("setting.noRollbackRecord")),1)]),_:1})]),_:1}),t(c,null,{default:e(()=>[t(r,{onClick:C,type:"primary"},{default:e(()=>[i(s(a.$t("setting.rollback")),1)]),_:1})]),_:1})]))]))]),_:1})):$("",!0)]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:V.value,"onUpdate:modelValue":p[9]||(p[9]=l=>V.value=l),"destroy-on-close":!0,"close-on-click-modal":!1,width:"30%"},{header:e(()=>[y("div",lt,[y("span",null,s(a.$t("commons.button.retry")),1)])]),footer:e(()=>[y("span",ot,[t(r,{disabled:k.value,onClick:p[7]||(p[7]=l=>V.value=!1)},{default:e(()=>[i(s(a.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),t(r,{disabled:k.value,type:"primary",onClick:p[8]||(p[8]=l=>A(!1))},{default:e(()=>[i(s(a.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:e(()=>[y("div",null,[y("span",null,s(a.$t("setting.reDownload")),1),t(N,{style:{"margin-left":"15px"},modelValue:R.value,"onUpdate:modelValue":p[6]||(p[6]=l=>R.value=l)},null,8,["modelValue"])]),y("div",at,[y("span",null,s(a.$t("setting.recoverHelper",[u.value.name])),1)])]),_:1},8,["modelValue"])])),[[w,k.value]])}}}),nt={class:"dialog-footer"},ut=J({__name:"index",emits:["search"],setup(ae,{expose:F,emit:E}){const v=b(!1),u=b(),k=b(),V=b(),R=b(),S=M({from:"",names:[],description:""}),U=M({from:[G.requiredSelect],name:[G.requiredSelect]}),A=()=>{S.from="",S.names=[],a(),v.value=!0},D=()=>{v.value=!1},C=async m=>{u.value=!0,m&&m.validate(async r=>{!r||await De(S).then(()=>{E("search"),u.value=!1,v.value=!1,j(h.global.t("commons.msg.operationSuccess"))}).catch(()=>{u.value=!1})})},a=async()=>{const m=await be();V.value=[];for(const r of m.data)r.type!=="LOCAL"&&r.id!==0&&V.value.push({label:h.global.t("setting."+r.type),value:r.type})},p=async()=>{const m=await Te(S.from);R.value=m.data||[];for(let r=0;r<R.value.length;r++)R.value[r]=R.value[r].replaceAll("system_snapshot/","")};return F({acceptParams:A}),(m,r)=>{const c=de,T=me,I=Z,W=pe,N=ce,z=fe,w=x,l=Q,o=ee,B=te;return H((d(),g("div",null,[t(o,{modelValue:v.value,"onUpdate:modelValue":r[5]||(r[5]=f=>v.value=f),size:"50%"},{header:e(()=>[t(le,{header:m.$t("setting.importSnapshot"),back:D},null,8,["header"])]),footer:e(()=>[y("span",nt,[t(l,{disabled:u.value,onClick:r[3]||(r[3]=f=>v.value=!1)},{default:e(()=>[i(s(m.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),t(l,{disabled:u.value,type:"primary",onClick:r[4]||(r[4]=f=>C(k.value))},{default:e(()=>[i(s(m.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:e(()=>[t(w,{ref_key:"formRef",ref:k,"label-position":"top",model:S,rules:U},{default:e(()=>[t(z,{type:"flex",justify:"center"},{default:e(()=>[t(N,{span:22},{default:e(()=>[t(I,{label:m.$t("setting.backupAccount"),prop:"from"},{default:e(()=>[t(T,{style:{width:"100%"},modelValue:S.from,"onUpdate:modelValue":r[0]||(r[0]=f=>S.from=f),onChange:p,clearable:""},{default:e(()=>[(d(!0),g(X,null,Y(V.value,f=>(d(),_(c,{key:f.label,value:f.value,label:f.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(I,{label:m.$t("commons.table.name"),prop:"names"},{default:e(()=>[t(T,{style:{width:"100%"},modelValue:S.names,"onUpdate:modelValue":r[1]||(r[1]=f=>S.names=f),multiple:"",clearable:""},{default:e(()=>[(d(!0),g(X,null,Y(R.value,f=>(d(),_(c,{key:f,value:f,label:f},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(I,{label:m.$t("commons.table.description"),prop:"description"},{default:e(()=>[t(W,{type:"textarea",clearable:"",modelValue:S.description,"onUpdate:modelValue":r[2]||(r[2]=f=>S.description=f)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])),[[B,u.value]])}}}),rt={class:"search-button"},it={key:0},dt={style:{width:"300px","word-break":"break-all"}},mt={class:"dialog-footer"},Ot=J({__name:"index",setup(ae){const F=b(!1),E=b(),v=b([]),u=M({currentPage:1,pageSize:10,total:0}),k=b(),V=b(),R=b(),S=b(),U=b(),A=b(),D=M({from:[G.requiredSelect]});let C=M({from:"",description:""});const a=b(!1),p=async()=>{N(),a.value=!0},m=()=>{R.value.acceptParams()},r=()=>{a.value=!1},c=async l=>{l.edit||(await Ie({id:l.id,description:l.description}),j(h.global.t("commons.msg.operationSuccess")))},T=l=>{!l||l.validate(async o=>{!o||(F.value=!0,await Le(C).then(()=>{F.value=!1,a.value=!1,w(),j(h.global.t("commons.msg.operationSuccess"))}).catch(()=>{F.value=!1}))})},I=async()=>{const l=await be();U.value=[];for(const o of l.data)o.type!=="LOCAL"&&o.id!==0&&U.value.push({label:h.global.t("setting."+o.type),value:o.type})},W=async l=>{let o=[];l===null?v.value.forEach(B=>{o.push(B.id)}):o.push(l.id),await ze(Pe,{ids:o},"commons.msg.delete"),w()};function N(){A.value&&A.value.resetFields()}const z=[{label:h.global.t("commons.button.recover"),icon:"RefreshLeft",click:l=>{V.value.acceptParams({snapInfo:l})},disabled:l=>l.status!=="Success"},{label:h.global.t("commons.button.delete"),icon:"Delete",click:W}],w=async()=>{let l={info:k.value,page:u.currentPage,pageSize:u.pageSize};const o=await We(l);E.value=o.data.items||[],u.total=o.data.total};return Ve(()=>{w(),I()}),(l,o)=>{const B=Q,f=ce,K=pe,oe=fe,L=Ce,q=ie,ve=Re,_e=re("fu-read-write-switch"),ye=re("fu-table-operations"),ge=de,$e=me,se=Z,ke=ee,ne=te;return d(),g("div",null,[S.value?$("",!0):H((d(),_(Oe,{key:0,title:l.$t("setting.snapshot")},{toolbar:e(()=>[t(oe,null,{default:e(()=>[t(f,{span:16},{default:e(()=>[t(B,{type:"primary",onClick:o[0]||(o[0]=n=>p())},{default:e(()=>[i(s(l.$t("setting.createSnapshot")),1)]),_:1}),t(B,{type:"primary",plain:"",onClick:o[1]||(o[1]=n=>m())},{default:e(()=>[i(s(l.$t("setting.importSnapshot")),1)]),_:1}),t(B,{type:"primary",plain:"",disabled:v.value.length===0,onClick:o[2]||(o[2]=n=>W(null))},{default:e(()=>[i(s(l.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),_:1}),t(f,{span:8},{default:e(()=>[t(Be,{ref:"timerRef",onSearch:o[3]||(o[3]=n=>w())},null,512),y("div",rt,[t(K,{modelValue:k.value,"onUpdate:modelValue":o[4]||(o[4]=n=>k.value=n),clearable:"",onClear:o[5]||(o[5]=n=>w()),"suffix-icon":"Search",onKeyup:o[6]||(o[6]=Fe(n=>w(),["enter"])),onBlur:o[7]||(o[7]=n=>w()),placeholder:l.$t("commons.button.search")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),main:e(()=>[t(Ae,{"pagination-config":u,selects:v.value,"onUpdate:selects":o[8]||(o[8]=n=>v.value=n),data:E.value,style:{"margin-top":"20px"},onSearch:w},{default:e(()=>[t(L,{type:"selection",fix:""}),t(L,{"show-overflow-tooltip":"",label:l.$t("commons.table.name"),"min-width":"100",prop:"name",fix:""},null,8,["label"]),t(L,{prop:"version",label:l.$t("app.version")},null,8,["label"]),t(L,{label:l.$t("setting.backupAccount"),"min-width":"80",prop:"from"},{default:e(({row:n})=>[n.from?(d(),g("span",it,s(l.$t("setting."+n.from)),1)):$("",!0)]),_:1},8,["label"]),t(L,{label:l.$t("commons.table.status"),"min-width":"80",prop:"status"},{default:e(({row:n})=>[n.status==="Success"?(d(),_(q,{key:0,type:"success"},{default:e(()=>[i(s(l.$t("commons.table.statusSuccess")),1)]),_:1})):$("",!0),n.status==="Waiting"?(d(),_(q,{key:1,type:"info"},{default:e(()=>[i(s(l.$t("commons.table.statusWaiting")),1)]),_:1})):$("",!0),n.status==="Uploading"?(d(),_(q,{key:2,type:"info"},{default:e(()=>[i(s(l.$t("commons.status.uploading"))+"... ",1)]),_:1})):$("",!0),n.status==="Failed"?(d(),_(ve,{key:3,effect:"dark",placement:"top"},{content:e(()=>[y("div",dt,s(n.message),1)]),default:e(()=>[t(q,{type:"danger"},{default:e(()=>[i(s(l.$t("commons.table.statusFailed")),1)]),_:1})]),_:2},1024)):$("",!0)]),_:1},8,["label"]),t(L,{label:l.$t("commons.table.description"),prop:"description"},{default:e(({row:n})=>[t(_e,{data:n.description,modelValue:n.edit,"onUpdate:modelValue":O=>n.edit=O,onChange:O=>c(n)},{default:e(()=>[t(K,{modelValue:n.description,"onUpdate:modelValue":O=>n.description=O,onBlur:O=>n.edit=!1},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1032,["data","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),t(L,{prop:"createdAt",label:l.$t("commons.table.date"),formatter:P(Ne),"show-overflow-tooltip":""},null,8,["label","formatter"]),t(ye,{width:"200px",ellipsis:10,buttons:z,label:l.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title"])),[[ne,F.value]]),t(st,{ref_key:"recoverStatusRef",ref:V,onSearch:o[9]||(o[9]=n=>w())},null,512),t(ut,{ref_key:"importRef",ref:R,onSearch:o[10]||(o[10]=n=>w())},null,512),t(ke,{modelValue:a.value,"onUpdate:modelValue":o[15]||(o[15]=n=>a.value=n),size:"50%"},{header:e(()=>[t(le,{header:l.$t("setting.createSnapshot"),back:r},null,8,["header"])]),footer:e(()=>[y("span",mt,[t(B,{disabled:F.value,onClick:o[13]||(o[13]=n=>a.value=!1)},{default:e(()=>[i(s(l.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),t(B,{disabled:F.value,type:"primary",onClick:o[14]||(o[14]=n=>T(A.value))},{default:e(()=>[i(s(l.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:e(()=>[H((d(),_(P(x),{"label-position":"top",ref_key:"snapRef",ref:A,"label-width":"100px",model:P(C),rules:D},{default:e(()=>[t(oe,{type:"flex",justify:"center"},{default:e(()=>[t(f,{span:22},{default:e(()=>[t(se,{label:l.$t("cronjob.target")+" ( "+l.$t("setting.thirdPartySupport")+" )",prop:"from"},{default:e(()=>[t($e,{modelValue:P(C).from,"onUpdate:modelValue":o[11]||(o[11]=n=>P(C).from=n),clearable:""},{default:e(()=>[(d(!0),g(X,null,Y(U.value,n=>(d(),_(ge,{key:n.label,value:n.value,label:n.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(se,{label:l.$t("commons.table.description"),prop:"description"},{default:e(()=>[t(K,{type:"textarea",clearable:"",modelValue:P(C).description,"onUpdate:modelValue":o[12]||(o[12]=n=>P(C).description=n)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[ne,F.value]])]),_:1},8,["modelValue"])])}}});export{Ot as default};
