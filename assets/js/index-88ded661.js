import{d as le,r as c,x as Z,Y as oe,b as p,h as D,e,w as l,f as q,g as R,t as b,F as se,i as ue,$ as ae,j as A,K as fe,L as ve,a2 as be,a3 as _e,l as ie,m as de,A as ne,af as ge,a5 as ye,c as H,O as J,U as Pe,a1 as me,av as Ue,J as ke,X as we,ae as xe,aq as qe,y,ah as Xe,_ as Qe,G as Ye,P as Ze,H as el,ag as pe,aS as ll,n as Ie,a0 as tl,k as al,a4 as ol,aT as nl,p as rl,aU as sl,aV as ul,aW as il,aX as dl,o as ml,Q as cl,I as pl,C as fl,aJ as vl}from"./index-9eeac04e.js";/* empty css             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                     *//* empty css                 *//* empty css            *//* empty css              *//* empty css               *//* empty css               *//* empty css            *//* empty css               */import{_ as ze}from"./layout-content-27c09564.js";import{_ as bl}from"./index-bcb238d7.js";import{_ as $e}from"./index-bb4c3e65.js";/* empty css                *//* empty css             */import"./form-item-d76e7d20.js";import{R as L}from"./form-rules-028b05ac.js";import{e as _l,a as Le,b as gl,t as He,d as yl,s as $l,c as hl,f as kl,g as wl,h as Vl,i as Se,j as Cl,k as Re}from"./host-190478f5.js";import{G as Ve}from"./group-e1575ac2.js";/* empty css              */import{_ as Ae}from"./index-8d9ad139.js";import{u as Be}from"./use-delete-data-8b6821a4.js";/* empty css                *//* empty css                 */import"./tooltip-b30db216.js";/* empty css             */import{T as Dl}from"./index-5896e1bd.js";/* empty css              *//* empty css                    */import"./index-5ffc91ba.js";import"./base64-e52cbffd.js";import"./util-cbaccc93.js";const El={class:"dialog-footer"},Il=le({__name:"index",emits:["search"],setup(S,{expose:w,emit:v}){const o=c(),$=c(!1),a=c({id:0,groupID:0}),s=c(),F=g=>{a.value.id=g.id,m(g.group),$.value=!0},E=()=>{$.value=!1},V=c(),U=Z({groupID:[L.requiredSelect]}),m=async g=>{const r=await Ve({type:"host"});s.value=r.data;for(const u of s.value)if(u.name===g){a.value.groupID=u.id;break}},d=g=>{!g||g.validate(async r=>{!r||(o.value=!0,await _l(a.value).then(()=>{o.value=!1,ae(A.global.t("commons.msg.operationSuccess")),$.value=!1,v("search")}).catch(()=>{o.value=!1}))})};return w({acceptParams:F}),(g,r)=>{const u=$e,P=fe,h=ve,T=be,M=_e,t=ie,n=de,f=ne,j=ge,X=ye;return oe((p(),D("div",null,[e(j,{modelValue:$.value,"onUpdate:modelValue":r[3]||(r[3]=x=>$.value=x),"destroy-on-close":!0,"close-on-click-modal":!1,size:"30%"},{header:l(()=>[e(u,{header:g.$t("terminal.groupChange"),back:E},null,8,["header"])]),footer:l(()=>[q("span",El,[e(f,{onClick:r[1]||(r[1]=x=>$.value=!1)},{default:l(()=>[R(b(g.$t("commons.button.cancel")),1)]),_:1}),e(f,{type:"primary",onClick:r[2]||(r[2]=x=>d(V.value))},{default:l(()=>[R(b(g.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[e(n,{type:"flex",justify:"center"},{default:l(()=>[e(t,{span:22},{default:l(()=>[e(M,{ref_key:"hostInfoRef",ref:V,"label-position":"top",model:a.value,rules:U},{default:l(()=>[e(T,{label:g.$t("commons.table.group"),prop:"group"},{default:l(()=>[e(h,{filterable:"",modelValue:a.value.groupID,"onUpdate:modelValue":r[0]||(r[0]=x=>a.value.groupID=x),clearable:"",style:{width:"100%"}},{default:l(()=>[(p(!0),D(se,null,ue(s.value,x=>(p(),D("div",{key:x.id},[e(P,{label:x.name,value:x.id},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[X,o.value]])}}}),Sl={key:0},Rl={class:"dialog-footer"},Fl=le({__name:"index",emits:["search"],setup(S,{expose:w,emit:v}){const o=c(),$=c(""),a=c(!1),s=c({title:""}),F=c(),E=r=>{s.value=r,$.value=A.global.t("commons.button."+s.value.title),a.value=!0,d()},V=()=>{a.value=!1},U=c(),m=Z({groupID:[L.requiredSelect],addr:[L.host],port:[L.requiredInput,L.port],user:[L.requiredInput],authMode:[L.requiredSelect]}),d=async()=>{const r=await Ve({type:"host"});if(F.value=r.data,s.value.title==="create"){for(const u of F.value)if(u.isDefault){s.value.rowData.groupID=u.id;break}}},g=(r,u)=>{!r||r.validate(async P=>{!P||(u==="create"&&(o.value=!0,await Le(s.value.rowData).then(()=>{o.value=!1,ae(A.global.t("commons.msg.operationSuccess")),a.value=!1,v("search")}).catch(()=>{o.value=!1})),u==="edit"&&(o.value=!0,await gl(s.value.rowData).then(()=>{o.value=!1,ae(A.global.t("commons.msg.operationSuccess")),a.value=!1,v("search")}).catch(()=>{o.value=!1})),u==="testconn"&&(o.value=!0,await He(s.value.rowData).then(h=>{o.value=!1,h.data?ae(A.global.t("terminal.connTestOk")):Pe(A.global.t("terminal.connTestFailed"))})))})};return w({acceptParams:E}),(r,u)=>{const P=$e,h=me,T=be,M=Ue,t=ke,n=fe,f=ve,j=_e,X=ie,x=de,W=ne,ee=ge,K=ye;return oe((p(),D("div",null,[e(ee,{modelValue:a.value,"onUpdate:modelValue":u[12]||(u[12]=k=>a.value=k),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:l(()=>[e(P,{header:r.$t("terminal.host"),back:V},null,8,["header"])]),footer:l(()=>[q("span",Rl,[e(W,{onClick:u[9]||(u[9]=k=>a.value=!1)},{default:l(()=>[R(b(r.$t("commons.button.cancel")),1)]),_:1}),e(W,{onClick:u[10]||(u[10]=k=>g(U.value,"testconn"))},{default:l(()=>[R(b(r.$t("terminal.testConn")),1)]),_:1}),e(W,{type:"primary",onClick:u[11]||(u[11]=k=>g(U.value,s.value.title))},{default:l(()=>[R(b(r.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[e(x,{type:"flex",justify:"center"},{default:l(()=>[e(X,{span:22},{default:l(()=>[e(j,{ref_key:"hostInfoRef",ref:U,"label-position":"top",model:s.value.rowData,rules:m},{default:l(()=>[e(T,{label:r.$t("terminal.ip"),prop:"addr"},{default:l(()=>[s.value.rowData.addr==="127.0.0.1"&&s.value.title==="edit"?(p(),D("span",Sl,b(s.value.rowData.addr),1)):(p(),H(h,{key:1,clearable:"",modelValue:s.value.rowData.addr,"onUpdate:modelValue":u[0]||(u[0]=k=>s.value.rowData.addr=k),modelModifiers:{trim:!0}},null,8,["modelValue"]))]),_:1},8,["label"]),e(T,{label:r.$t("terminal.user"),prop:"user"},{default:l(()=>[e(h,{clearable:"",modelValue:s.value.rowData.user,"onUpdate:modelValue":u[1]||(u[1]=k=>s.value.rowData.user=k)},null,8,["modelValue"])]),_:1},8,["label"]),e(T,{label:r.$t("terminal.authMode"),prop:"authMode"},{default:l(()=>[e(t,{modelValue:s.value.rowData.authMode,"onUpdate:modelValue":u[2]||(u[2]=k=>s.value.rowData.authMode=k)},{default:l(()=>[e(M,{label:"password"},{default:l(()=>[R(b(r.$t("terminal.passwordMode")),1)]),_:1}),e(M,{label:"key"},{default:l(()=>[R(b(r.$t("terminal.keyMode")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s.value.rowData.authMode==="password"?(p(),H(T,{key:0,label:r.$t("terminal.password"),prop:"password"},{default:l(()=>[e(h,{clearable:"","show-password":"",type:"password",modelValue:s.value.rowData.password,"onUpdate:modelValue":u[3]||(u[3]=k=>s.value.rowData.password=k)},null,8,["modelValue"])]),_:1},8,["label"])):J("",!0),s.value.rowData.authMode==="key"?(p(),H(T,{key:1,label:r.$t("terminal.key"),prop:"privateKey"},{default:l(()=>[e(h,{clearable:"",type:"textarea",modelValue:s.value.rowData.privateKey,"onUpdate:modelValue":u[4]||(u[4]=k=>s.value.rowData.privateKey=k)},null,8,["modelValue"])]),_:1},8,["label"])):J("",!0),e(T,{label:r.$t("terminal.port"),prop:"port"},{default:l(()=>[e(h,{clearable:"",modelValue:s.value.rowData.port,"onUpdate:modelValue":u[5]||(u[5]=k=>s.value.rowData.port=k),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"]),e(T,{label:r.$t("commons.table.group"),prop:"groupID"},{default:l(()=>[e(f,{filterable:"",modelValue:s.value.rowData.groupID,"onUpdate:modelValue":u[6]||(u[6]=k=>s.value.rowData.groupID=k),clearable:"",style:{width:"100%"}},{default:l(()=>[(p(!0),D(se,null,ue(F.value,k=>(p(),H(n,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(T,{label:r.$t("commons.table.title"),prop:"name"},{default:l(()=>[e(h,{clearable:"",modelValue:s.value.rowData.name,"onUpdate:modelValue":u[7]||(u[7]=k=>s.value.rowData.name=k)},null,8,["modelValue"])]),_:1},8,["label"]),e(T,{label:r.$t("commons.table.description"),prop:"description"},{default:l(()=>[e(h,{clearable:"",type:"textarea",modelValue:s.value.rowData.description,"onUpdate:modelValue":u[8]||(u[8]=k=>s.value.rowData.description=k)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[K,o.value]])}}}),Ml={class:"search-button"},Tl={key:0},Pl={key:1},Ul={key:0},xl={key:1},ql=le({__name:"index",setup(S,{expose:w}){const v=c(),o=c(),$=c(),a=c([]),s=Z({currentPage:1,pageSize:10,total:0}),F=c(),E=c(""),V=c(),U=()=>{M()};function m(t){return t.addr!=="127.0.0.1"}const d=c(),g=async(t,n={port:22,user:"root",authMode:"password"})=>{let f={title:t,rowData:{...n}};d.value.acceptParams(f)},r=c(),u=()=>{r.value.acceptParams({type:"host"})},P=async t=>{let n=[];t?n.push(t.id):a.value.forEach(f=>{n.push(f.id)}),await Be(yl,{ids:n},"commons.msg.delete"),M()},h=async()=>{const t=await Ve({type:"host"});$.value=t.data},T=[{label:A.global.t("terminal.groupChange"),click:t=>{V.value.acceptParams({id:t.id,group:t.groupBelong})}},{label:A.global.t("commons.button.edit"),click:t=>{g("edit",t)}},{label:A.global.t("commons.button.delete"),click:t=>{P(t)},disabled:t=>t.addr==="127.0.0.1"}],M=async()=>{let t={page:s.currentPage,pageSize:s.pageSize,groupID:Number(E.value),info:F.value};h(),v.value=!0,await $l(t).then(n=>{v.value=!1,o.value=n.data.items||[],s.total=n.data.total}).catch(()=>{v.value=!1})};return w({acceptParams:U}),(t,n)=>{const f=ne,j=ie,X=me,x=de,W=fe,ee=ve,K=qe,k=we("fu-table-operations"),te=ye;return p(),D("div",null,[oe((p(),H(ze,{title:t.$t("terminal.host")},{toolbar:l(()=>[e(x,null,{default:l(()=>[e(j,{span:20},{default:l(()=>[e(f,{type:"primary",onClick:n[0]||(n[0]=I=>g("create"))},{default:l(()=>[R(b(t.$t("terminal.addHost")),1)]),_:1}),e(f,{type:"primary",plain:"",onClick:n[1]||(n[1]=I=>u())},{default:l(()=>[R(b(t.$t("terminal.group")),1)]),_:1}),e(f,{type:"primary",plain:"",disabled:a.value.length===0,onClick:n[2]||(n[2]=I=>P(null))},{default:l(()=>[R(b(t.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),_:1}),e(j,{span:4},{default:l(()=>[q("div",Ml,[e(X,{modelValue:F.value,"onUpdate:modelValue":n[3]||(n[3]=I=>F.value=I),clearable:"",onClear:n[4]||(n[4]=I=>M()),"suffix-icon":"Search",onKeyup:n[5]||(n[5]=xe(I=>M(),["enter"])),onBlur:n[6]||(n[6]=I=>M()),placeholder:t.$t("commons.button.search")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),search:l(()=>[e(ee,{modelValue:E.value,"onUpdate:modelValue":n[7]||(n[7]=I=>E.value=I),onChange:n[8]||(n[8]=I=>M()),clearable:""},{prefix:l(()=>[R(b(t.$t("terminal.group")),1)]),default:l(()=>[e(W,{label:t.$t("commons.table.all"),value:""},null,8,["label"]),(p(!0),D(se,null,ue($.value,I=>(p(),D("div",{key:I.name},[e(W,{value:I.id,label:I.name},null,8,["value","label"])]))),128))]),_:1},8,["modelValue"])]),main:l(()=>[e(Ae,{"pagination-config":s,selects:a.value,"onUpdate:selects":n[9]||(n[9]=I=>a.value=I),data:o.value,onSearch:M},{default:l(()=>[e(K,{type:"selection",selectable:m,fix:""}),e(K,{label:t.$t("terminal.ip"),prop:"addr",fix:""},null,8,["label"]),e(K,{label:t.$t("terminal.user"),"show-overflow-tooltip":"",prop:"user"},null,8,["label"]),e(K,{label:t.$t("terminal.port"),prop:"port"},null,8,["label"]),e(K,{label:t.$t("commons.table.group"),"show-overflow-tooltip":"",prop:"groupBelong"},{default:l(({row:I})=>[I.groupBelong==="default"?(p(),D("span",Tl,b(t.$t("website.default")),1)):(p(),D("span",Pl,b(I.groupBelong),1))]),_:1},8,["label"]),e(K,{label:t.$t("commons.table.title"),"show-overflow-tooltip":"",prop:"name"},{default:l(({row:I})=>[I.addr==="127.0.0.1"?(p(),D("span",Ul,b(t.$t("terminal.localhost")),1)):(p(),D("span",xl,b(I.name),1))]),_:1},8,["label"]),e(K,{label:t.$t("commons.table.description"),"show-overflow-tooltip":"",prop:"description"},null,8,["label"]),e(k,{width:"200px",buttons:T,label:t.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title"])),[[te,v.value]]),e(Fl,{onSearch:M,ref_key:"dialogRef",ref:d},null,512),e(bl,{onSearch:M,ref_key:"dialogGroupRef",ref:r},null,512),e(Il,{onSearch:M,ref_key:"dialogGroupChangeRef",ref:V},null,512)])}}}),zl={class:"dialog-footer"},Ll=le({__name:"index",setup(S,{expose:w}){const v=c(),o=c(),$=c([]),a=Z({currentPage:1,pageSize:10,total:0}),s=c(),F=c(),E=Z({name:[L.requiredInput],command:[L.requiredInput]});let V=c("create");const U=()=>{M()};let m=Z({id:0,name:"",command:""});const d=c(!1),g=async()=>{m.id=0,m.name="",m.command="",V.value="create",d.value=!0},r=()=>{d.value=!1},u=t=>{!t||t.validate(async n=>{!n||(V.value==="create"?await hl(m):await kl(m),d.value=!1,M(),ae(A.global.t("commons.msg.operationSuccess")))})},P=async t=>{t!==null&&(m.id=t.id,m.name=t.name,m.command=t.command,V.value="edit",d.value=!0)},h=async t=>{let n=[];t===null?$.value.forEach(f=>{n.push(f.id)}):n.push(t.id),await Be(wl,{ids:n},"commons.msg.delete"),M()},T=[{label:A.global.t("commons.button.edit"),icon:"Edit",click:P},{label:A.global.t("commons.button.delete"),icon:"Delete",click:h}],M=async()=>{let t={page:a.currentPage,pageSize:a.pageSize,info:s.value};v.value=!0,await Vl(t).then(n=>{v.value=!1,o.value=n.data.items||[],a.total=n.data.total}).catch(()=>{v.value=!1})};return w({acceptParams:U}),(t,n)=>{const f=ne,j=qe,X=we("fu-table-operations"),x=me,W=be,ee=_e,K=ie,k=de,te=ge,I=ye;return p(),D("div",null,[oe((p(),H(ze,{title:t.$t("terminal.quickCommand")},{toolbar:l(()=>[e(f,{type:"primary",onClick:n[0]||(n[0]=G=>g())},{default:l(()=>[R(b(t.$t("commons.button.create"))+b(t.$t("terminal.quickCommand")),1)]),_:1}),e(f,{type:"primary",plain:"",disabled:$.value.length===0,onClick:n[1]||(n[1]=G=>h(null))},{default:l(()=>[R(b(t.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),main:l(()=>[e(Ae,{"pagination-config":a,selects:$.value,"onUpdate:selects":n[2]||(n[2]=G=>$.value=G),data:o.value,onSearch:M},{default:l(()=>[e(j,{type:"selection",fix:""}),e(j,{label:t.$t("commons.table.name"),"show-overflow-tooltip":"","min-width":"100",prop:"name",fix:""},null,8,["label"]),e(j,{label:t.$t("terminal.command"),"min-width":"300","show-overflow-tooltip":"",prop:"command"},null,8,["label"]),e(X,{buttons:T,label:t.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title"])),[[I,v.value]]),e(te,{modelValue:d.value,"onUpdate:modelValue":n[7]||(n[7]=G=>d.value=G),"destroy-on-close":!0,"close-on-click-modal":!1,size:"30%"},{header:l(()=>[e($e,{header:t.$t("commons.button."+y(V))+t.$t("terminal.quickCommand"),back:r},null,8,["header"])]),footer:l(()=>[q("span",zl,[e(f,{onClick:n[5]||(n[5]=G=>d.value=!1)},{default:l(()=>[R(b(t.$t("commons.button.cancel")),1)]),_:1}),e(f,{type:"primary",onClick:n[6]||(n[6]=G=>u(F.value))},{default:l(()=>[R(b(t.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[e(k,{type:"flex",justify:"center"},{default:l(()=>[e(K,{span:22},{default:l(()=>[e(ee,{ref_key:"commandInfoRef",ref:F,"label-width":"100px","label-position":"top",model:y(m),rules:E},{default:l(()=>[e(W,{label:t.$t("commons.table.name"),prop:"name"},{default:l(()=>[e(x,{clearable:"",modelValue:y(m).name,"onUpdate:modelValue":n[3]||(n[3]=G=>y(m).name=G)},null,8,["modelValue"])]),_:1},8,["label"]),e(W,{label:t.$t("terminal.command"),prop:"command"},{default:l(()=>[e(x,{type:"textarea",clearable:"",modelValue:y(m).command,"onUpdate:modelValue":n[4]||(n[4]=G=>y(m).command=G)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const Hl={style:{"margin-left":"12px"}},Al={key:0},Bl={class:"dialog-footer"},Gl=le({__name:"host-create",emits:["on-conn-terminal","load-host-tree"],setup(S,{expose:w,emit:v}){const o=c(),$=c();let a=Z({id:0,name:"",groupID:0,addr:"",port:22,user:"",authMode:"password",password:"",privateKey:"",description:""});const s=Z({addr:[L.host],port:[L.requiredInput,L.port],user:[L.requiredInput],authMode:[L.requiredSelect],password:[L.requiredInput],privateKey:[L.requiredInput]}),F=c(!1),E=m=>{a.addr="",a.name="",a.groupID=0,a.addr="",a.port=22,a.user="",a.authMode="password",a.password="",a.privateKey="",a.description="",F.value=m.isLocal,m.isLocal&&(a.addr="127.0.0.1",a.user="root"),o.value=!0},V=()=>{o.value=!1},U=(m,d)=>{!m||m.validate(async g=>{if(!!g)switch(a.groupID=0,d){case"testConn":await He(a).then(h=>{h.data?ae(A.global.t("terminal.connTestOk")):Pe(A.global.t("terminal.connTestFailed"))});break;case"saveAndConn":const r=await Le(a);o.value=!1;let u=r.data.user+"@"+r.data.addr+":"+r.data.port;r.data.name.length!==0&&(u=r.data.name+"-"+u);let P=a.addr==="127.0.0.1";v("on-conn-terminal",u,r.data.id,P),v("load-host-tree");break}})};return w({acceptParams:E}),(m,d)=>{const g=Xe,r=me,u=be,P=Ue,h=ke,T=ie,M=de,t=ne,n=ge;return p(),D("div",null,[e(n,{modelValue:o.value,"onUpdate:modelValue":d[11]||(d[11]=f=>o.value=f),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:l(()=>[e($e,{header:m.$t("terminal.addHost"),back:V},null,8,["header"])]),footer:l(()=>[q("span",Bl,[e(t,{onClick:d[8]||(d[8]=f=>o.value=!1)},{default:l(()=>[R(b(m.$t("commons.button.cancel")),1)]),_:1}),e(t,{onClick:d[9]||(d[9]=f=>U($.value,"testConn"))},{default:l(()=>[R(b(m.$t("terminal.testConn")),1)]),_:1}),e(t,{type:"primary",onClick:d[10]||(d[10]=f=>U($.value,"saveAndConn"))},{default:l(()=>[R(b(m.$t("terminal.saveAndConn")),1)]),_:1})])]),default:l(()=>[e(y(_e),{ref_key:"hostRef",ref:$,"label-width":"100px","label-position":"top",model:y(a),rules:s},{default:l(()=>[e(M,{type:"flex",justify:"center"},{default:l(()=>[e(T,{span:22},{default:l(()=>[F.value?(p(),H(g,{key:0,style:{"margin-bottom":"20px"},center:"",title:m.$t("terminal.connLocalErr"),closable:!1,type:"warning"},null,8,["title"])):J("",!0),e(u,{label:m.$t("terminal.ip"),prop:"addr"},{default:l(()=>[F.value?J("",!0):(p(),H(r,{key:0,clearable:"",modelValue:y(a).addr,"onUpdate:modelValue":d[0]||(d[0]=f=>y(a).addr=f),modelModifiers:{trim:!0}},null,8,["modelValue"])),q("div",Hl,[F.value?(p(),D("span",Al,b(y(a).addr),1)):J("",!0)])]),_:1},8,["label"]),e(u,{label:m.$t("terminal.user"),prop:"user"},{default:l(()=>[e(r,{clearable:"",modelValue:y(a).user,"onUpdate:modelValue":d[1]||(d[1]=f=>y(a).user=f)},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{label:m.$t("terminal.authMode"),prop:"authMode"},{default:l(()=>[e(h,{modelValue:y(a).authMode,"onUpdate:modelValue":d[2]||(d[2]=f=>y(a).authMode=f)},{default:l(()=>[e(P,{label:"password"},{default:l(()=>[R(b(m.$t("terminal.passwordMode")),1)]),_:1}),e(P,{label:"key"},{default:l(()=>[R(b(m.$t("terminal.keyMode")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),y(a).authMode==="password"?(p(),H(u,{key:1,label:m.$t("terminal.password"),prop:"password"},{default:l(()=>[e(r,{clearable:"","show-password":"",type:"password",modelValue:y(a).password,"onUpdate:modelValue":d[3]||(d[3]=f=>y(a).password=f)},null,8,["modelValue"])]),_:1},8,["label"])):J("",!0),y(a).authMode==="key"?(p(),H(u,{key:2,label:m.$t("terminal.key"),prop:"privateKey"},{default:l(()=>[e(r,{clearable:"",type:"textarea",modelValue:y(a).privateKey,"onUpdate:modelValue":d[4]||(d[4]=f=>y(a).privateKey=f)},null,8,["modelValue"])]),_:1},8,["label"])):J("",!0),e(u,{label:m.$t("terminal.port"),prop:"port"},{default:l(()=>[e(r,{clearable:"",modelValue:y(a).port,"onUpdate:modelValue":d[5]||(d[5]=f=>y(a).port=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{label:m.$t("commons.table.title"),prop:"name"},{default:l(()=>[e(r,{clearable:"",modelValue:y(a).name,"onUpdate:modelValue":d[6]||(d[6]=f=>y(a).name=f)},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{label:m.$t("commons.table.description"),prop:"description"},{default:l(()=>[e(r,{clearable:"",modelValue:y(a).description,"onUpdate:modelValue":d[7]||(d[7]=f=>y(a).description=f)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),Fe=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Y=(()=>{if(typeof document=="undefined")return!1;const S=Fe[0],w={};for(const v of Fe)if((v==null?void 0:v[1])in document){for(const[$,a]of v.entries())w[S[$]]=a;return w}return!1})(),Me={change:Y.fullscreenchange,error:Y.fullscreenerror};let N={request(S=document.documentElement,w){return new Promise((v,o)=>{const $=()=>{N.off("change",$),v()};N.on("change",$);const a=S[Y.requestFullscreen](w);a instanceof Promise&&a.then($).catch(o)})},exit(){return new Promise((S,w)=>{if(!N.isFullscreen){S();return}const v=()=>{N.off("change",v),S()};N.on("change",v);const o=document[Y.exitFullscreen]();o instanceof Promise&&o.then(v).catch(w)})},toggle(S,w){return N.isFullscreen?N.exit():N.request(S,w)},onchange(S){N.on("change",S)},onerror(S){N.on("error",S)},on(S,w){const v=Me[S];v&&document.addEventListener(v,w,!1)},off(S,w){const v=Me[S];v&&document.removeEventListener(v,w,!1)},raw:Y};Object.defineProperties(N,{isFullscreen:{get:()=>Boolean(document[Y.fullscreenElement])},element:{enumerable:!0,get:()=>{var S;return(S=document[Y.fullscreenElement])!=null?S:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[Y.fullscreenEnabled])}});Y||(N={isEnabled:!1});var Te=N;const Kl={class:"custom-tabs-label"},Ol={key:2},Nl={style:{"margin-left":"10px"}},jl={style:{"margin-left":"10px"}},Jl={class:"search-button",style:{float:"none"}},Wl={class:"custom-tree-node"},Xl={key:0},Ql={key:1},Yl={key:0},Zl=["onClick"],et=["onClick"],lt={key:0},tt=le({__name:"index",setup(S,{expose:w}){const v=c(),o=dl(),$=Ye();function a(){Te.isEnabled&&(Te.toggle(),$.setScreenFull())}const s=c();let F=null;const E=c(),V=c([]);let U=0;const m=c();let d=c(),g=c(),r=c(!1);const u=c(),P=c(""),h=c(),T=c(),M={label:"label",children:"children"},t=async()=>{x();const i=await Se({});h.value=i.data,F=setInterval(()=>{Ce()},1e3*5);for(let _=0;_<h.value.length;_++)if(!!h.value[_].children){for(let B=0;B<h.value[_].children.length;B++)if(h.value[_].children[B].label.indexOf("@127.0.0.1:")!==-1){if(s.value=h.value[_].children[B].id,h.value[_].children.splice(B,1),h.value[_].children.length===0&&h.value.splice(_,1),V.value.length!==0)return;te();return}}},n=()=>{clearInterval(Number(F)),F=null;for(const i of V.value)o&&o.refs[`t-${i.index}`][0]&&(i.status=o.refs[`t-${i.index}`][0].onClose())},f=(i,_)=>{if(_!=="remove")return;o&&o.refs[`t-${i}`]&&o.refs[`t-${i}`][0].onClose();const B=V.value;let Q=E.value;Q===i&&B.forEach((O,re)=>{if(O.index===i){const ce=B[re+1]||B[re-1];ce&&(Q=ce.index)}}),E.value=Q,V.value=B.filter(O=>O.index!==i)},j=async()=>{const i=await Se({});h.value=i.data};Ze(P,i=>{T.value.filter(i)});const X=(i,_)=>i?_.label.includes(i):!0,x=async()=>{const i=await Cl();m.value=i.data};function W(i){if(i!==""&&o){if(r.value){for(const _ of V.value)o.refs[`t-${_.index}`]&&o.refs[`t-${_.index}`][0].sendMsg(i+`
`);return}o.refs[`t-${E.value}`]&&o.refs[`t-${E.value}`][0].sendMsg(i+`
`),d.value=""}}function ee(){if(!(g.value===""||!o)){if(r.value){for(const i of V.value)o.refs[`t-${i.index}`]&&o.refs[`t-${i.index}`][0].sendMsg(g.value+`
`);g.value="";return}o.refs[`t-${E.value}`]&&o.refs[`t-${E.value}`][0].sendMsg(g.value+`
`),g.value=""}}function K(i){if(i==="newTabs")return!1}const k=()=>{v.value.acceptParams({isLocal:!1})},te=()=>{he(A.global.t("terminal.localhost"),s.value,!0)},I=(i,_)=>{i.level!==1&&he(i.label,_.id,!1)},G=async i=>{o&&o.refs[`t-${i.index}`]&&o.refs[`t-${i.index}`][0].onClose(),i.Refresh=!i.Refresh;const _=await Re(i.wsID);Ie(()=>{o.refs[`t-${i.index}`]&&o.refs[`t-${i.index}`][0].acceptParams({endpoint:"/api/v1/terminals",args:`id=${i.wsID}`,error:_.data?"":"Failed to set up the connection. Please check the host information"})}),Ce()},he=async(i,_,B)=>{const Q=await Re(_);if(B){for(const O of V.value)if(O.title.indexOf("@127.0.0.1:")!==-1||O.title===A.global.t("terminal.localhost")){G(O);return}}V.value.push({index:U,title:i,wsID:_,status:Q.data?"online":"closed",latency:0}),E.value=U,!Q.data&&B&&v.value.acceptParams({isLocal:!0}),Ie(()=>{o.refs[`t-${E.value}`]&&o.refs[`t-${E.value}`][0].acceptParams({endpoint:"/api/v1/terminals",args:`id=${_}`,error:Q.data?"":"Authentication failed.  Please check the host information !"})}),U++};function Ce(){for(const i of V.value)o&&o.refs[`t-${i.index}`][0]&&(i.status=o.refs[`t-${i.index}`][0].isWsOpen()?"online":"closed",i.latency=o.refs[`t-${i.index}`][0].getLatency())}return w({acceptParams:t,cleanTimer:n}),(i,_)=>{const B=we("circleCheck"),Q=tl,O=ne,re=al,ce=fe,Ge=ve,Ke=ol,De=me,Ee=nl,Oe=rl,Ne=sl,je=ul,Je=il;return p(),D("div",null,[e(je,{type:"card",class:"terminal-tabs",style:{"background-color":"#efefef","margin-top":"20px"},modelValue:E.value,"onUpdate:modelValue":_[4]||(_[4]=C=>E.value=C),"before-leave":K,onTabChange:_[5]||(_[5]=C=>pe(d)?d.value="":d=""),onEdit:f},{default:l(()=>[(p(!0),D(se,null,ue(y(V),C=>(p(),H(Ee,{key:C.index,closable:!0,label:C.title,name:C.index},{label:l(()=>[q("span",Kl,[C.status==="online"?(p(),D("span",{key:0,style:el(`color: ${C.latency<100?"#69db7c":C.latency<300?"#f59f00":"#d9480f"}; display: inline-flex; align-items: center`)},[q("span",null,"\xA0"+b(C.latency)+"\xA0ms\xA0",1),e(Q,null,{default:l(()=>[e(B)]),_:1})],4)):J("",!0),C.status==="closed"?(p(),H(O,{key:1,icon:"Refresh",style:{color:"white"},size:"default",link:"",onClick:z=>G(C)},null,8,["onClick"])):J("",!0),C.title.length<=20?(p(),D("span",Ol,"\xA0"+b(C.title)+"\xA0",1)):(p(),H(re,{key:3,content:C.title,placement:"top-start"},{default:l(()=>[q("span",null,"\xA0"+b(C.title.substring(0,17))+"...\xA0",1)]),_:2},1032,["content"]))])]),default:l(()=>[(p(),H(Dl,{style:{height:"calc(100vh - 227px)","background-color":"#000"},ref_for:!0,ref:"t-"+C.index,key:C.Refresh})),q("div",null,[e(Ge,{modelValue:y(d),"onUpdate:modelValue":_[0]||(_[0]=z=>pe(d)?d.value=z:d=z),clearable:"",filterable:"",onChange:W,style:{width:"25%"}},{prefix:l(()=>[R(b(i.$t("terminal.quickCommand")),1)]),default:l(()=>[(p(!0),D(se,null,ue(m.value,z=>(p(),H(ce,{key:z.id,label:z.name,value:z.command},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(De,{modelValue:y(g),"onUpdate:modelValue":_[2]||(_[2]=z=>pe(g)?g.value=z:g=z),onKeyup:xe(ee,["enter"]),style:{width:"75%"}},{prepend:l(()=>[e(Ke,{label:i.$t("terminal.batchInput"),modelValue:y(r),"onUpdate:modelValue":_[1]||(_[1]=z=>pe(r)?r.value=z:r=z)},null,8,["label","modelValue"])]),_:1},8,["modelValue","onKeyup"])])]),_:2},1032,["label","name"]))),128)),e(Ee,{closable:!1,name:"newTabs"},{label:l(()=>[oe(e(O,{style:{"background-color":"#ededed",border:"0"},icon:"Plus"},null,512),[[Je,u.value]]),e(Oe,{ref_key:"popoverRef",ref:u,width:"250px",trigger:"hover","virtual-triggering":"",persistent:""},{default:l(()=>[q("div",Nl,[e(O,{link:"",type:"primary",onClick:k},{default:l(()=>[R(b(i.$t("terminal.createConn")),1)]),_:1})]),q("div",jl,[e(O,{link:"",type:"primary",onClick:te},{default:l(()=>[R(b(i.$t("terminal.localhost")),1)]),_:1})]),q("div",Jl,[e(De,{modelValue:P.value,"onUpdate:modelValue":_[3]||(_[3]=C=>P.value=C),style:{"margin-top":"5px"},clearable:"","suffix-icon":"Search",placeholder:i.$t("commons.button.search")},null,8,["modelValue","placeholder"])]),e(y(ll),{ref_key:"treeRef",ref:T,"expand-on-click-node":!1,"node-key":"id","default-expand-all":!0,data:h.value,props:M,"filter-node-method":X,"empty-text":i.$t("terminal.noHost")},{default:l(({node:C,data:z})=>[q("span",Wl,[C.label==="default"?(p(),D("span",Xl,b(i.$t("website.default")),1)):(p(),D("div",Ql,[C.label.length<=25?(p(),D("span",Yl,[q("a",{onClick:We=>I(C,z)},b(C.label),9,Zl)])):(p(),H(re,{key:1,content:C.label,placement:"top-start"},{default:l(()=>[q("span",null,[q("a",{onClick:We=>I(C,z)},b(C.label.substring(0,22))+"... ",9,et)])]),_:2},1032,["content"]))]))])]),_:1},8,["data","empty-text"])]),_:1},512)]),_:1}),y(V).length===0?(p(),D("div",lt,[e(Ne,{style:{"background-color":"#000",height:"calc(100vh - 200px)"},description:i.$t("terminal.emptyTerminal")},null,8,["description"])])):J("",!0)]),_:1},8,["modelValue"]),e(O,{onClick:a,class:"fullScreen",icon:"FullScreen"}),e(Gl,{ref_key:"dialogRef",ref:v,onOnConnTerminal:he,onLoadHostTree:j},null,512)])}}});var at=Qe(tt,[["__scopeId","data-v-bc8b83bc"]]);const ot={key:0},nt={key:1},At=le({__name:"index",setup(S){const w=c("terminal"),v=c(),o=c(),$=c(),a=s=>{s==="host"&&v.value.acceptParams(),s==="command"&&o.value.acceptParams(),s==="terminal"&&$.value.acceptParams()};return ml(()=>{a("terminal")}),cl(()=>{var s;(s=$.value)==null||s.cleanTimer()}),(s,F)=>{const E=pl,V=ke,U=fl;return p(),D("div",null,[e(U,{class:"router_card"},{default:l(()=>[e(V,{modelValue:w.value,"onUpdate:modelValue":F[0]||(F[0]=m=>w.value=m),onChange:a},{default:l(()=>[e(E,{class:"router_card_button",size:"large",label:"terminal"},{default:l(()=>[R(b(s.$t("menu.terminal")),1)]),_:1}),e(E,{class:"router_card_button",size:"large",label:"host"},{default:l(()=>[R(b(s.$t("menu.host")),1)]),_:1}),e(E,{class:"router_card_button",size:"large",label:"command"},{default:l(()=>[R(b(s.$t("terminal.quickCommand")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),oe(q("div",null,[e(at,{ref_key:"terminalTabRef",ref:$},null,512)],512),[[vl,w.value==="terminal"]]),w.value==="host"?(p(),D("div",ot,[e(ql,{ref_key:"hostTabRef",ref:v},null,512)])):J("",!0),w.value==="command"?(p(),D("div",nt,[e(Ll,{ref_key:"commandTabRef",ref:o},null,512)])):J("",!0)])}}});export{At as default};
