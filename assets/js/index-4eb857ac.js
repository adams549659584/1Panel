import{d as G,r as m,x as ee,a1 as le,a2 as T,a3 as ae,l as W,m as X,A as Y,af as te,a5 as Z,b as _,c as E,w as a,e,f as r,g as I,t as v,y as l,Y as q,ag as h,O as A,u as oe,v as ne,o as se,z as ie,K as pe,L as re,ah as ue,a0 as de,ai as me,M as _e,N as ce,h as D,F as H,i as fe,V as ve,X as K}from"./index-609fd921.js";/* empty css                *//* empty css                          *//* empty css             *//* empty css             *//* empty css            *//* empty css               *//* empty css              */import"./form-item-d76e7d20.js";/* empty css              *//* empty css            *//* empty css               *//* empty css               *//* empty css               */import{I as be,d as ye,e as ge}from"./app-1a8bdb12.js";import{_ as ke}from"./layout-content-47227111.js";import{E as Ee}from"./md-editor-v3.es-602e0c4e.js";import{_ as we}from"./index-110fbc44.js";/* empty css                *//* empty css             */import{R as De}from"./form-rules-08616160.js";import{_ as Ve}from"./index-c1fce76b.js";import"./index-e09fb15b.js";/* empty css                    *//* empty css             */import"./util-bdb43d7e.js";const $e={class:"dialog-footer"},he=G({name:"appInstall"}),Ae=G({...he,setup(P,{expose:C}){const N=oe(),o=m({appDetailId:0});let u=m(!1),i=m({}),c=m({NAME:[De.appName]}),f=m(!1);const b=m(),g=ee({appDetailId:0,params:{},name:""}),y=()=>{u.value=!1,k()},k=()=>{b.value&&(b.value.clearValidate(),b.value.resetFields())},F=t=>{o.value=t,k(),u.value=!0},n=async t=>{!t||await t.validate(s=>{!s||(g.appDetailId=o.value.appDetailId,g.params=i.value,g.name=i.value.NAME,f.value=!0,be(g).then(()=>{y(),N.push({path:"/apps/installed"})}).finally(()=>{f.value=!1}))})};return C({acceptParams:F}),(t,s)=>{const w=le,M=T,B=ae,L=W,R=X,V=Y,$=te,U=Z;return _(),E($,{"close-on-click-modal":!1,modelValue:l(u),"onUpdate:modelValue":s[5]||(s[5]=p=>h(u)?u.value=p:u=p),title:t.$t("app.install"),size:"50%","before-close":y},{header:a(()=>[e(we,{header:t.$t("app.install"),back:y},null,8,["header"])]),footer:a(()=>[r("span",$e,[e(V,{onClick:y,disabled:l(f)},{default:a(()=>[I(v(t.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),e(V,{type:"primary",onClick:s[4]||(s[4]=p=>n(b.value)),disabled:l(f)},{default:a(()=>[I(v(t.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:a(()=>[q((_(),E(R,null,{default:a(()=>[e(L,{span:22,offset:1},{default:a(()=>[e(B,{ref_key:"paramForm",ref:b,"label-position":"top",model:l(i),"label-width":"150px",rules:l(c),"validate-on-rule-change":!1},{default:a(()=>[e(M,{label:t.$t("app.name"),prop:"NAME"},{default:a(()=>[e(w,{modelValue:l(i).NAME,"onUpdate:modelValue":s[0]||(s[0]=p=>l(i).NAME=p),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1},8,["label"]),l(u)?(_(),E(Ve,{key:0,form:l(i),"onUpdate:form":s[1]||(s[1]=p=>h(i)?i.value=p:i=p),params:o.value.params,"onUpdate:params":s[2]||(s[2]=p=>o.value.params=p),rules:l(c),"onUpdate:rules":s[3]||(s[3]=p=>h(c)?c.value=p:c=p)},null,8,["form","params","rules"])):A("",!0)]),_:1},8,["model","rules"])]),_:1})]),_:1})),[[U,l(f)]])]),_:1},8,["modelValue","title"])}}});const Ie={class:"brief"},Ce={class:"detail"},Ne={class:"name"},Fe={class:"description"},Me={class:"version"},Be=r("br",null,null,-1),Le={key:0},Re=r("div",{class:"divider"},null,-1),Ue={class:"descriptions"},Oe={style:{"margin-left":"10px"}},ul=G({__name:"index",props:{appKey:{default:""}},setup(P){const C=P,N=ne().locale.value;let o=m({}),u=m({}),i=m(""),c=m(!1),f=m(!1);const b=m(),g=async()=>{f.value=!0;try{const n=await ye(C.appKey);o.value=n.data,o.value.icon="data:image/png;base64,"+n.data.icon,i.value=o.value.versions[0],y(o.value.id,i.value)}finally{f.value=!1}},y=async(n,t)=>{c.value=!0;try{const s=await ge(n,t,"app");u.value=s.data}finally{c.value=!1}},k=n=>{window.open(n,"_blank")},F=()=>{let n={params:u.value.params,appDetailId:u.value.id};o.value,o.value.type==="php"?ve.push({path:"/websites/runtime/php"}):b.value.acceptParams(n)};return se(()=>{g()}),(n,t)=>{const s=ie,w=W,M=pe,B=re,L=T,R=ue,V=Y,$=X,U=K("OfficeBuilding"),p=de,O=me,z=_e,j=K("Document"),x=K("Link"),J=ce,S=Z;return _(),D(H,null,[e(ke,{title:n.$t("app.detail"),"back-name":"App",divider:!0},{main:a(()=>[q((_(),D("div",Ie,[e($,{gutter:20},{default:a(()=>[r("div",null,[e(w,{span:3},{default:a(()=>[e(s,{shape:"square",size:180,src:l(o).icon},null,8,["src"])]),_:1})]),e(w,{span:18},{default:a(()=>[r("div",Ce,[r("div",Ne,[r("span",null,v(l(o).name),1)]),r("div",Fe,[r("span",null,v(l(N)=="zh"?l(o).shortDescZh:l(o).shortDescEn),1)]),r("div",Me,[e(L,{label:n.$t("app.version")},{default:a(()=>[e(B,{modelValue:l(i),"onUpdate:modelValue":t[0]||(t[0]=d=>h(i)?i.value=d:i=d),onChange:t[1]||(t[1]=d=>y(l(o).id,l(i)))},{default:a(()=>[(_(!0),D(H,null,fe(l(o).versions,(d,Q)=>(_(),E(M,{key:Q,value:d,label:d},{default:a(()=>[I(v(d),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),Be,l(c)?A("",!0):(_(),D("div",Le,[l(u).enable?A("",!0):(_(),E(R,{key:0,style:{width:"300px"},title:n.$t("app.limitHelper"),type:"warning","show-icon":"",closable:!1},null,8,["title"]))])),r("div",null,[l(u).enable?(_(),E(V,{key:0,round:"",onClick:F,type:"primary"},{default:a(()=>[I(v(n.$t("app.install")),1)]),_:1})):A("",!0)])])]),_:1})]),_:1}),Re,r("div",null,[e($,null,{default:a(()=>[e(w,{span:12},{default:a(()=>[r("div",Ue,[e(J,{direction:"vertical"},{default:a(()=>[e(z,null,{default:a(()=>[e(O,{onClick:t[2]||(t[2]=d=>k(l(o).website))},{default:a(()=>[e(p,null,{default:a(()=>[e(U)]),_:1}),r("span",null,v(n.$t("app.appOfficeWebsite")),1)]),_:1})]),_:1}),e(z,null,{default:a(()=>[e(O,{onClick:t[3]||(t[3]=d=>k(l(o).document))},{default:a(()=>[e(p,null,{default:a(()=>[e(j)]),_:1}),r("span",null,v(n.$t("app.document")),1)]),_:1})]),_:1}),e(z,null,{default:a(()=>[e(O,{onClick:t[4]||(t[4]=d=>k(l(o).github))},{default:a(()=>[e(p,null,{default:a(()=>[e(x)]),_:1}),r("span",null,v(n.$t("app.github")),1)]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})])])),[[S,l(f)]]),q((_(),D("div",Oe,[e(l(Ee),{modelValue:l(u).readme,"onUpdate:modelValue":t[5]||(t[5]=d=>l(u).readme=d),previewOnly:""},null,8,["modelValue"])])),[[S,l(c)]])]),_:1},8,["title"]),e(Ae,{ref_key:"installRef",ref:b},null,512)],64)}}});export{ul as default};
