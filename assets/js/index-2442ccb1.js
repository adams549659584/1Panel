import{d as le,r as m,x as ee,Y as oe,b as v,h as E,e,w as l,f as A,g as M,t as y,F as se,i as ue,$ as ae,j as O,K as fe,L as ve,a2 as be,a3 as _e,l as ie,m as de,A as ne,af as ge,a5 as ye,c as B,O as X,U as Ue,a1 as ce,av as ze,J as ke,X as Ve,ae as qe,aq as Ae,y as V,_ as Be,P as Le,a as el,n as $e,ah as ll,G as tl,ag as pe,aS as al,a0 as ol,k as nl,a4 as rl,aT as sl,p as ul,aU as il,aV as dl,aW as cl,aX as ml,o as pl,Q as fl,I as vl,C as bl,aJ as _l}from"./index-609fd921.js";/* empty css             *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                     *//* empty css                 *//* empty css            *//* empty css              *//* empty css               *//* empty css               *//* empty css            *//* empty css               */import{_ as He}from"./layout-content-47227111.js";import{_ as gl}from"./index-990170cf.js";import{_ as he}from"./index-110fbc44.js";/* empty css                *//* empty css             */import"./form-item-d76e7d20.js";import{R as H}from"./form-rules-08616160.js";import{e as yl,a as Oe,b as hl,t as Ge,d as wl,s as $l,c as kl,f as Vl,g as Cl,h as Sl,i as Ie,j as Dl,k as Re}from"./host-791f5b47.js";import{G as Ce}from"./group-b21a3a2d.js";/* empty css              */import{_ as Ke}from"./index-af1c8b2d.js";import{u as Ne}from"./use-delete-data-3fb8ebbf.js";/* empty css                *//* empty css                 */import"./tooltip-b30db216.js";/* empty css             */import{x as El,a as Te,b as Il}from"./xterm-addon-fit-023687d7.js";import{g as Me}from"./base64-e52cbffd.js";import{i as Rl}from"./util-bdb43d7e.js";/* empty css              *//* empty css                    */import"./index-e09fb15b.js";const Tl={class:"dialog-footer"},Ml=le({__name:"index",emits:["search"],setup(I,{expose:C,emit:f}){const n=m(),$=m(!1),t=m({id:0,groupID:0}),s=m(),D=w=>{t.value.id=w.id,p(w.group),$.value=!0},_=()=>{$.value=!1},d=m(),z=ee({groupID:[H.requiredSelect]}),p=async w=>{const r=await Ce({type:"host"});s.value=r.data;for(const u of s.value)if(u.name===w){t.value.groupID=u.id;break}},c=w=>{!w||w.validate(async r=>{!r||(n.value=!0,await yl(t.value).then(()=>{n.value=!1,ae(O.global.t("commons.msg.operationSuccess")),$.value=!1,f("search")}).catch(()=>{n.value=!1}))})};return C({acceptParams:D}),(w,r)=>{const u=he,U=fe,k=ve,x=be,R=_e,a=ie,o=de,b=ne,g=ge,P=ye;return oe((v(),E("div",null,[e(g,{modelValue:$.value,"onUpdate:modelValue":r[3]||(r[3]=q=>$.value=q),"destroy-on-close":!0,"close-on-click-modal":!1,size:"30%"},{header:l(()=>[e(u,{header:w.$t("terminal.groupChange"),back:_},null,8,["header"])]),footer:l(()=>[A("span",Tl,[e(b,{onClick:r[1]||(r[1]=q=>$.value=!1)},{default:l(()=>[M(y(w.$t("commons.button.cancel")),1)]),_:1}),e(b,{type:"primary",onClick:r[2]||(r[2]=q=>c(d.value))},{default:l(()=>[M(y(w.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[e(o,{type:"flex",justify:"center"},{default:l(()=>[e(a,{span:22},{default:l(()=>[e(R,{ref_key:"hostInfoRef",ref:d,"label-position":"top",model:t.value,rules:z},{default:l(()=>[e(x,{label:w.$t("commons.table.group"),prop:"group"},{default:l(()=>[e(k,{filterable:"",modelValue:t.value.groupID,"onUpdate:modelValue":r[0]||(r[0]=q=>t.value.groupID=q),clearable:"",style:{width:"100%"}},{default:l(()=>[(v(!0),E(se,null,ue(s.value,q=>(v(),E("div",{key:q.id},[e(U,{label:q.name,value:q.id},null,8,["label","value"])]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[P,n.value]])}}}),Fl={key:0},xl={class:"dialog-footer"},Pl=le({__name:"index",emits:["search"],setup(I,{expose:C,emit:f}){const n=m(),$=m(""),t=m(!1),s=m({title:""}),D=m(),_=r=>{s.value=r,$.value=O.global.t("commons.button."+s.value.title),t.value=!0,c()},d=()=>{t.value=!1},z=m(),p=ee({groupID:[H.requiredSelect],addr:[H.host],port:[H.requiredInput,H.port],user:[H.requiredInput],authMode:[H.requiredSelect]}),c=async()=>{const r=await Ce({type:"host"});if(D.value=r.data,s.value.title==="create"){for(const u of D.value)if(u.isDefault){s.value.rowData.groupID=u.id;break}}},w=(r,u)=>{!r||r.validate(async U=>{!U||(u==="create"&&(n.value=!0,await Oe(s.value.rowData).then(()=>{n.value=!1,ae(O.global.t("commons.msg.operationSuccess")),t.value=!1,f("search")}).catch(()=>{n.value=!1})),u==="edit"&&(n.value=!0,await hl(s.value.rowData).then(()=>{n.value=!1,ae(O.global.t("commons.msg.operationSuccess")),t.value=!1,f("search")}).catch(()=>{n.value=!1})),u==="testconn"&&(n.value=!0,await Ge(s.value.rowData).then(k=>{n.value=!1,k.data?ae(O.global.t("terminal.connTestOk")):Ue(O.global.t("terminal.connTestFailed"))})))})};return C({acceptParams:_}),(r,u)=>{const U=he,k=ce,x=be,R=ze,a=ke,o=fe,b=ve,g=_e,P=ie,q=de,N=ne,Y=ge,W=ye;return oe((v(),E("div",null,[e(Y,{modelValue:t.value,"onUpdate:modelValue":u[12]||(u[12]=S=>t.value=S),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:l(()=>[e(U,{header:r.$t("terminal.host"),back:d},null,8,["header"])]),footer:l(()=>[A("span",xl,[e(N,{onClick:u[9]||(u[9]=S=>t.value=!1)},{default:l(()=>[M(y(r.$t("commons.button.cancel")),1)]),_:1}),e(N,{onClick:u[10]||(u[10]=S=>w(z.value,"testconn"))},{default:l(()=>[M(y(r.$t("terminal.testConn")),1)]),_:1}),e(N,{type:"primary",onClick:u[11]||(u[11]=S=>w(z.value,s.value.title))},{default:l(()=>[M(y(r.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[e(q,{type:"flex",justify:"center"},{default:l(()=>[e(P,{span:22},{default:l(()=>[e(g,{ref_key:"hostInfoRef",ref:z,"label-position":"top",model:s.value.rowData,rules:p},{default:l(()=>[e(x,{label:r.$t("terminal.ip"),prop:"addr"},{default:l(()=>[s.value.rowData.addr==="127.0.0.1"&&s.value.title==="edit"?(v(),E("span",Fl,y(s.value.rowData.addr),1)):(v(),B(k,{key:1,clearable:"",modelValue:s.value.rowData.addr,"onUpdate:modelValue":u[0]||(u[0]=S=>s.value.rowData.addr=S),modelModifiers:{trim:!0}},null,8,["modelValue"]))]),_:1},8,["label"]),e(x,{label:r.$t("terminal.user"),prop:"user"},{default:l(()=>[e(k,{clearable:"",modelValue:s.value.rowData.user,"onUpdate:modelValue":u[1]||(u[1]=S=>s.value.rowData.user=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(x,{label:r.$t("terminal.authMode"),prop:"authMode"},{default:l(()=>[e(a,{modelValue:s.value.rowData.authMode,"onUpdate:modelValue":u[2]||(u[2]=S=>s.value.rowData.authMode=S)},{default:l(()=>[e(R,{label:"password"},{default:l(()=>[M(y(r.$t("terminal.passwordMode")),1)]),_:1}),e(R,{label:"key"},{default:l(()=>[M(y(r.$t("terminal.keyMode")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s.value.rowData.authMode==="password"?(v(),B(x,{key:0,label:r.$t("terminal.password"),prop:"password"},{default:l(()=>[e(k,{clearable:"","show-password":"",type:"password",modelValue:s.value.rowData.password,"onUpdate:modelValue":u[3]||(u[3]=S=>s.value.rowData.password=S)},null,8,["modelValue"])]),_:1},8,["label"])):X("",!0),s.value.rowData.authMode==="key"?(v(),B(x,{key:1,label:r.$t("terminal.key"),prop:"privateKey"},{default:l(()=>[e(k,{clearable:"",type:"textarea",modelValue:s.value.rowData.privateKey,"onUpdate:modelValue":u[4]||(u[4]=S=>s.value.rowData.privateKey=S)},null,8,["modelValue"])]),_:1},8,["label"])):X("",!0),e(x,{label:r.$t("terminal.port"),prop:"port"},{default:l(()=>[e(k,{clearable:"",modelValue:s.value.rowData.port,"onUpdate:modelValue":u[5]||(u[5]=S=>s.value.rowData.port=S),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"]),e(x,{label:r.$t("commons.table.group"),prop:"groupID"},{default:l(()=>[e(b,{filterable:"",modelValue:s.value.rowData.groupID,"onUpdate:modelValue":u[6]||(u[6]=S=>s.value.rowData.groupID=S),clearable:"",style:{width:"100%"}},{default:l(()=>[(v(!0),E(se,null,ue(D.value,S=>(v(),B(o,{key:S.id,label:S.name,value:S.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(x,{label:r.$t("commons.table.title"),prop:"name"},{default:l(()=>[e(k,{clearable:"",modelValue:s.value.rowData.name,"onUpdate:modelValue":u[7]||(u[7]=S=>s.value.rowData.name=S)},null,8,["modelValue"])]),_:1},8,["label"]),e(x,{label:r.$t("commons.table.description"),prop:"description"},{default:l(()=>[e(k,{clearable:"",type:"textarea",modelValue:s.value.rowData.description,"onUpdate:modelValue":u[8]||(u[8]=S=>s.value.rowData.description=S)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[W,n.value]])}}}),Ul={class:"search-button"},zl={key:0},ql={key:1},Al={key:0},Bl={key:1},Ll=le({__name:"index",setup(I,{expose:C}){const f=m(),n=m(),$=m(),t=m([]),s=ee({currentPage:1,pageSize:10,total:0}),D=m(),_=m(""),d=m(),z=()=>{R()};function p(a){return a.addr!=="127.0.0.1"}const c=m(),w=async(a,o={port:22,user:"root",authMode:"password"})=>{let b={title:a,rowData:{...o}};c.value.acceptParams(b)},r=m(),u=()=>{r.value.acceptParams({type:"host"})},U=async a=>{let o=[];a?o.push(a.id):t.value.forEach(b=>{o.push(b.id)}),await Ne(wl,{ids:o},"commons.msg.delete"),R()},k=async()=>{const a=await Ce({type:"host"});$.value=a.data},x=[{label:O.global.t("terminal.groupChange"),click:a=>{d.value.acceptParams({id:a.id,group:a.groupBelong})}},{label:O.global.t("commons.button.edit"),click:a=>{w("edit",a)}},{label:O.global.t("commons.button.delete"),click:a=>{U(a)},disabled:a=>a.addr==="127.0.0.1"}],R=async()=>{let a={page:s.currentPage,pageSize:s.pageSize,groupID:Number(_.value),info:D.value};k(),f.value=!0,await $l(a).then(o=>{f.value=!1,n.value=o.data.items||[],s.total=o.data.total}).catch(()=>{f.value=!1})};return C({acceptParams:z}),(a,o)=>{const b=ne,g=ie,P=ce,q=de,N=fe,Y=ve,W=Ae,S=Ve("fu-table-operations"),te=ye;return v(),E("div",null,[oe((v(),B(He,{title:a.$t("terminal.host")},{toolbar:l(()=>[e(q,null,{default:l(()=>[e(g,{span:20},{default:l(()=>[e(b,{type:"primary",onClick:o[0]||(o[0]=T=>w("create"))},{default:l(()=>[M(y(a.$t("terminal.addHost")),1)]),_:1}),e(b,{type:"primary",plain:"",onClick:o[1]||(o[1]=T=>u())},{default:l(()=>[M(y(a.$t("terminal.group")),1)]),_:1}),e(b,{type:"primary",plain:"",disabled:t.value.length===0,onClick:o[2]||(o[2]=T=>U(null))},{default:l(()=>[M(y(a.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),_:1}),e(g,{span:4},{default:l(()=>[A("div",Ul,[e(P,{modelValue:D.value,"onUpdate:modelValue":o[3]||(o[3]=T=>D.value=T),clearable:"",onClear:o[4]||(o[4]=T=>R()),"suffix-icon":"Search",onKeyup:o[5]||(o[5]=qe(T=>R(),["enter"])),onBlur:o[6]||(o[6]=T=>R()),placeholder:a.$t("commons.button.search")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),search:l(()=>[e(Y,{modelValue:_.value,"onUpdate:modelValue":o[7]||(o[7]=T=>_.value=T),onChange:o[8]||(o[8]=T=>R()),clearable:""},{prefix:l(()=>[M(y(a.$t("terminal.group")),1)]),default:l(()=>[e(N,{label:a.$t("commons.table.all"),value:""},null,8,["label"]),(v(!0),E(se,null,ue($.value,T=>(v(),E("div",{key:T.name},[e(N,{value:T.id,label:T.name},null,8,["value","label"])]))),128))]),_:1},8,["modelValue"])]),main:l(()=>[e(Ke,{"pagination-config":s,selects:t.value,"onUpdate:selects":o[9]||(o[9]=T=>t.value=T),data:n.value,onSearch:R},{default:l(()=>[e(W,{type:"selection",selectable:p,fix:""}),e(W,{label:a.$t("terminal.ip"),prop:"addr",fix:""},null,8,["label"]),e(W,{label:a.$t("terminal.user"),"show-overflow-tooltip":"",prop:"user"},null,8,["label"]),e(W,{label:a.$t("terminal.port"),prop:"port"},null,8,["label"]),e(W,{label:a.$t("commons.table.group"),"show-overflow-tooltip":"",prop:"groupBelong"},{default:l(({row:T})=>[T.groupBelong==="default"?(v(),E("span",zl,y(a.$t("website.default")),1)):(v(),E("span",ql,y(T.groupBelong),1))]),_:1},8,["label"]),e(W,{label:a.$t("commons.table.title"),"show-overflow-tooltip":"",prop:"name"},{default:l(({row:T})=>[T.addr==="127.0.0.1"?(v(),E("span",Al,y(a.$t("terminal.localhost")),1)):(v(),E("span",Bl,y(T.name),1))]),_:1},8,["label"]),e(W,{label:a.$t("commons.table.description"),"show-overflow-tooltip":"",prop:"description"},null,8,["label"]),e(S,{width:"200px",buttons:x,label:a.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title"])),[[te,f.value]]),e(Pl,{onSearch:R,ref_key:"dialogRef",ref:c},null,512),e(gl,{onSearch:R,ref_key:"dialogGroupRef",ref:r},null,512),e(Ml,{onSearch:R,ref_key:"dialogGroupChangeRef",ref:d},null,512)])}}}),Hl={class:"dialog-footer"},Ol=le({__name:"index",setup(I,{expose:C}){const f=m(),n=m(),$=m([]),t=ee({currentPage:1,pageSize:10,total:0}),s=m(),D=m(),_=ee({name:[H.requiredInput],command:[H.requiredInput]});let d=m("create");const z=()=>{R()};let p=ee({id:0,name:"",command:""});const c=m(!1),w=async()=>{p.id=0,p.name="",p.command="",d.value="create",c.value=!0},r=()=>{c.value=!1},u=a=>{!a||a.validate(async o=>{!o||(d.value==="create"?await kl(p):await Vl(p),c.value=!1,R(),ae(O.global.t("commons.msg.operationSuccess")))})},U=async a=>{a!==null&&(p.id=a.id,p.name=a.name,p.command=a.command,d.value="edit",c.value=!0)},k=async a=>{let o=[];a===null?$.value.forEach(b=>{o.push(b.id)}):o.push(a.id),await Ne(Cl,{ids:o},"commons.msg.delete"),R()},x=[{label:O.global.t("commons.button.edit"),icon:"Edit",click:U},{label:O.global.t("commons.button.delete"),icon:"Delete",click:k}],R=async()=>{let a={page:t.currentPage,pageSize:t.pageSize,info:s.value};f.value=!0,await Sl(a).then(o=>{f.value=!1,n.value=o.data.items||[],t.total=o.data.total}).catch(()=>{f.value=!1})};return C({acceptParams:z}),(a,o)=>{const b=ne,g=Ae,P=Ve("fu-table-operations"),q=ce,N=be,Y=_e,W=ie,S=de,te=ge,T=ye;return v(),E("div",null,[oe((v(),B(He,{title:a.$t("terminal.quickCommand")},{toolbar:l(()=>[e(b,{type:"primary",onClick:o[0]||(o[0]=K=>w())},{default:l(()=>[M(y(a.$t("commons.button.create"))+y(a.$t("terminal.quickCommand")),1)]),_:1}),e(b,{type:"primary",plain:"",disabled:$.value.length===0,onClick:o[1]||(o[1]=K=>k(null))},{default:l(()=>[M(y(a.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),main:l(()=>[e(Ke,{"pagination-config":t,selects:$.value,"onUpdate:selects":o[2]||(o[2]=K=>$.value=K),data:n.value,onSearch:R},{default:l(()=>[e(g,{type:"selection",fix:""}),e(g,{label:a.$t("commons.table.name"),"show-overflow-tooltip":"","min-width":"100",prop:"name",fix:""},null,8,["label"]),e(g,{label:a.$t("terminal.command"),"min-width":"300","show-overflow-tooltip":"",prop:"command"},null,8,["label"]),e(P,{buttons:x,label:a.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title"])),[[T,f.value]]),e(te,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=K=>c.value=K),"destroy-on-close":!0,"close-on-click-modal":!1,size:"30%"},{header:l(()=>[e(he,{header:a.$t("commons.button."+V(d))+a.$t("terminal.quickCommand"),back:r},null,8,["header"])]),footer:l(()=>[A("span",Hl,[e(b,{onClick:o[5]||(o[5]=K=>c.value=!1)},{default:l(()=>[M(y(a.$t("commons.button.cancel")),1)]),_:1}),e(b,{type:"primary",onClick:o[6]||(o[6]=K=>u(D.value))},{default:l(()=>[M(y(a.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[e(S,{type:"flex",justify:"center"},{default:l(()=>[e(W,{span:22},{default:l(()=>[e(Y,{ref_key:"commandInfoRef",ref:D,"label-width":"100px","label-position":"top",model:V(p),rules:_},{default:l(()=>[e(N,{label:a.$t("commons.table.name"),prop:"name"},{default:l(()=>[e(q,{clearable:"",modelValue:V(p).name,"onUpdate:modelValue":o[3]||(o[3]=K=>V(p).name=K)},null,8,["modelValue"])]),_:1},8,["label"]),e(N,{label:a.$t("terminal.command"),prop:"command"},{default:l(()=>[e(q,{type:"textarea",clearable:"",modelValue:V(p).command,"onUpdate:modelValue":o[4]||(o[4]=K=>V(p).command=K)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const Gl=["id"],Kl=le({__name:"terminal",setup(I,{expose:C}){const f=m(),n=m(),$=g=>{f.value=g.terminalID,n.value=g.wsID,$e(()=>{g.error.length!==0?u(g.error):(U(),window.addEventListener("resize",o))})},t=new El.exports.FitAddon,s=m(!1),D=m(!1);let _=m(null),d=m(null);const z=Le(()=>s.value&&D.value,g=>{g&&(o(),z())}),p=()=>{s.value=!0},c=g=>{if(!Rl(g.data))return;const P=JSON.parse(g.data);d.element&&d.focus(),d.write(P.Data)},w=g=>{let P=g.message;P||(P="disconnected"),d.write(`\x1B[31m${P}\x1B[m\r
`)},r=g=>{d.write(g.reason)},u=g=>{let P=document.getElementById("terminal-"+f.value);d=new Te.exports.Terminal({lineHeight:1.2,fontSize:12,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#000000"},cursorBlink:!0,cursorStyle:"underline",scrollback:100,tabStopWidth:4}),P&&(d.open(P),d.write(g),d.loadAddon(t),t.fit(),D.value=!0)},U=()=>{let g=document.getElementById("terminal-"+f.value),P=window.location.href,q=P.split("//")[0]==="http:"?"ws":"wss",N=P.split("//")[1].split("/")[0];d=new Te.exports.Terminal({lineHeight:1.2,fontSize:12,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#000000"},cursorBlink:!0,cursorStyle:"underline",scrollback:100,tabStopWidth:4}),g&&(d.open(g),_=new WebSocket(`${q}://${N}/api/v1/terminals?id=${n.value}&cols=${d.cols}&rows=${d.rows}`),_.onopen=p,_.onmessage=c,_.onclose=r,_.onerror=w,d.onData(Y=>{x()&&_.send(JSON.stringify({type:"cmd",cmd:Me.encode(Y)}))}),d.loadAddon(new Il.exports.AttachAddon(_)),d.loadAddon(t),D.value=!0)},k=()=>{t.fit()},x=()=>(_&&_.readyState)===1;function R(){window.removeEventListener("resize",o);try{_.close()}catch{}try{d.dispose()}catch{}}function a(g){_.send(JSON.stringify({type:"cmd",cmd:Me.encode(g)}))}function o(){k();const{cols:g,rows:P}=d;x()&&_.send(JSON.stringify({type:"resize",cols:g,rows:P}))}const b=g=>{g.ctrlKey&&(g.preventDefault(),d&&(g.deltaY>0?d.options.fontSize>12&&(d.options.fontSize=d.options.fontSize-1):d.options.fontSize=d.options.fontSize+1))};return C({acceptParams:$,onClose:R,isWsOpen:x,onSendMsg:a}),el(()=>{R()}),(g,P)=>(v(),E("div",{id:"terminal-"+f.value,onWheel:b},null,40,Gl))}});var Nl=Be(Kl,[["__scopeId","data-v-4f7e8577"]]);const Wl={style:{"margin-left":"12px"}},jl={key:0},Jl={class:"dialog-footer"},Xl=le({__name:"host-create",emits:["on-conn-terminal","load-host-tree"],setup(I,{expose:C,emit:f}){const n=m(),$=m();let t=ee({id:0,name:"",groupID:0,addr:"",port:22,user:"",authMode:"password",password:"",privateKey:"",description:""});const s=ee({addr:[H.host],port:[H.requiredInput,H.port],user:[H.requiredInput],authMode:[H.requiredSelect],password:[H.requiredInput],privateKey:[H.requiredInput]}),D=m(!1),_=p=>{t.addr="",t.name="",t.groupID=0,t.addr="",t.port=22,t.user="",t.authMode="password",t.password="",t.privateKey="",t.description="",D.value=p.isLocal,p.isLocal&&(t.addr="127.0.0.1",t.user="root"),n.value=!0},d=()=>{n.value=!1},z=(p,c)=>{!p||p.validate(async w=>{if(!!w)switch(t.groupID=0,c){case"testConn":await Ge(t).then(k=>{k.data?ae(O.global.t("terminal.connTestOk")):Ue(O.global.t("terminal.connTestFailed"))});break;case"saveAndConn":const r=await Oe(t);n.value=!1;let u=r.data.user+"@"+r.data.addr+":"+r.data.port;r.data.name.length!==0&&(u=r.data.name+"-"+u);let U=t.addr==="127.0.0.1";f("on-conn-terminal",u,r.data.id,U),f("load-host-tree");break}})};return C({acceptParams:_}),(p,c)=>{const w=ll,r=ce,u=be,U=ze,k=ke,x=ie,R=de,a=ne,o=ge;return v(),E("div",null,[e(o,{modelValue:n.value,"onUpdate:modelValue":c[11]||(c[11]=b=>n.value=b),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:l(()=>[e(he,{header:p.$t("terminal.addHost"),back:d},null,8,["header"])]),footer:l(()=>[A("span",Jl,[e(a,{onClick:c[8]||(c[8]=b=>n.value=!1)},{default:l(()=>[M(y(p.$t("commons.button.cancel")),1)]),_:1}),e(a,{onClick:c[9]||(c[9]=b=>z($.value,"testConn"))},{default:l(()=>[M(y(p.$t("terminal.testConn")),1)]),_:1}),e(a,{type:"primary",onClick:c[10]||(c[10]=b=>z($.value,"saveAndConn"))},{default:l(()=>[M(y(p.$t("terminal.saveAndConn")),1)]),_:1})])]),default:l(()=>[e(V(_e),{ref_key:"hostRef",ref:$,"label-width":"100px","label-position":"top",model:V(t),rules:s},{default:l(()=>[e(R,{type:"flex",justify:"center"},{default:l(()=>[e(x,{span:22},{default:l(()=>[D.value?(v(),B(w,{key:0,style:{"margin-bottom":"20px"},center:"",title:p.$t("terminal.connLocalErr"),closable:!1,type:"warning"},null,8,["title"])):X("",!0),e(u,{label:p.$t("terminal.ip"),prop:"addr"},{default:l(()=>[D.value?X("",!0):(v(),B(r,{key:0,clearable:"",modelValue:V(t).addr,"onUpdate:modelValue":c[0]||(c[0]=b=>V(t).addr=b),modelModifiers:{trim:!0}},null,8,["modelValue"])),A("div",Wl,[D.value?(v(),E("span",jl,y(V(t).addr),1)):X("",!0)])]),_:1},8,["label"]),e(u,{label:p.$t("terminal.user"),prop:"user"},{default:l(()=>[e(r,{clearable:"",modelValue:V(t).user,"onUpdate:modelValue":c[1]||(c[1]=b=>V(t).user=b)},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{label:p.$t("terminal.authMode"),prop:"authMode"},{default:l(()=>[e(k,{modelValue:V(t).authMode,"onUpdate:modelValue":c[2]||(c[2]=b=>V(t).authMode=b)},{default:l(()=>[e(U,{label:"password"},{default:l(()=>[M(y(p.$t("terminal.passwordMode")),1)]),_:1}),e(U,{label:"key"},{default:l(()=>[M(y(p.$t("terminal.keyMode")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),V(t).authMode==="password"?(v(),B(u,{key:1,label:p.$t("terminal.password"),prop:"password"},{default:l(()=>[e(r,{clearable:"","show-password":"",type:"password",modelValue:V(t).password,"onUpdate:modelValue":c[3]||(c[3]=b=>V(t).password=b)},null,8,["modelValue"])]),_:1},8,["label"])):X("",!0),V(t).authMode==="key"?(v(),B(u,{key:2,label:p.$t("terminal.key"),prop:"privateKey"},{default:l(()=>[e(r,{clearable:"",type:"textarea",modelValue:V(t).privateKey,"onUpdate:modelValue":c[4]||(c[4]=b=>V(t).privateKey=b)},null,8,["modelValue"])]),_:1},8,["label"])):X("",!0),e(u,{label:p.$t("terminal.port"),prop:"port"},{default:l(()=>[e(r,{clearable:"",modelValue:V(t).port,"onUpdate:modelValue":c[5]||(c[5]=b=>V(t).port=b),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{label:p.$t("commons.table.title"),prop:"name"},{default:l(()=>[e(r,{clearable:"",modelValue:V(t).name,"onUpdate:modelValue":c[6]||(c[6]=b=>V(t).name=b)},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{label:p.$t("commons.table.description"),prop:"description"},{default:l(()=>[e(r,{clearable:"",modelValue:V(t).description,"onUpdate:modelValue":c[7]||(c[7]=b=>V(t).description=b)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),Fe=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Z=(()=>{if(typeof document=="undefined")return!1;const I=Fe[0],C={};for(const f of Fe)if((f==null?void 0:f[1])in document){for(const[$,t]of f.entries())C[I[$]]=t;return C}return!1})(),xe={change:Z.fullscreenchange,error:Z.fullscreenerror};let J={request(I=document.documentElement,C){return new Promise((f,n)=>{const $=()=>{J.off("change",$),f()};J.on("change",$);const t=I[Z.requestFullscreen](C);t instanceof Promise&&t.then($).catch(n)})},exit(){return new Promise((I,C)=>{if(!J.isFullscreen){I();return}const f=()=>{J.off("change",f),I()};J.on("change",f);const n=document[Z.exitFullscreen]();n instanceof Promise&&n.then(f).catch(C)})},toggle(I,C){return J.isFullscreen?J.exit():J.request(I,C)},onchange(I){J.on("change",I)},onerror(I){J.on("error",I)},on(I,C){const f=xe[I];f&&document.addEventListener(f,C,!1)},off(I,C){const f=xe[I];f&&document.removeEventListener(f,C,!1)},raw:Z};Object.defineProperties(J,{isFullscreen:{get:()=>Boolean(document[Z.fullscreenElement])},element:{enumerable:!0,get:()=>{var I;return(I=document[Z.fullscreenElement])!=null?I:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[Z.fullscreenEnabled])}});Z||(J={isEnabled:!1});var Pe=J;const Yl={class:"custom-tabs-label"},Ql={key:2},Zl={style:{"margin-left":"10px"}},et={style:{"margin-left":"10px"}},lt={class:"search-button",style:{float:"none"}},tt={class:"custom-tree-node"},at={key:0},ot={key:1},nt={key:0},rt=["onClick"],st=["onClick"],ut={key:0},it=le({__name:"index",setup(I,{expose:C}){const f=m(),n=ml(),$=tl();function t(){Pe.isEnabled&&(Pe.toggle(),$.setScreenFull())}const s=m();let D=null;const _=m(),d=m([]);let z=0;const p=m();let c=m(),w=m(),r=m(!1);const u=m(),U=m(""),k=m(),x=m(),R={label:"label",children:"children"},a=async()=>{q();const i=await Ie({});k.value=i.data,D=setInterval(()=>{Se()},1e3*5);for(let h=0;h<k.value.length;h++)if(!!k.value[h].children){for(let G=0;G<k.value[h].children.length;G++)if(k.value[h].children[G].label.indexOf("@127.0.0.1:")!==-1){if(s.value=k.value[h].children[G].id,k.value[h].children.splice(G,1),k.value[h].children.length===0&&k.value.splice(h,1),d.value.length!==0)return;te();return}}},o=()=>{clearInterval(Number(D)),D=null;for(const i of d.value)n&&n.refs[`t-${i.index}`][0]&&(i.status=n.refs[`t-${i.index}`][0].onClose())},b=(i,h)=>{if(h!=="remove")return;n&&n.refs[`t-${i}`]&&n.refs[`t-${i}`][0].onClose();const G=d.value;let Q=_.value;Q===i&&G.forEach((j,re)=>{if(j.index===i){const me=G[re+1]||G[re-1];me&&(Q=me.index)}}),_.value=Q,d.value=G.filter(j=>j.index!==i)},g=async()=>{const i=await Ie({});k.value=i.data};Le(U,i=>{x.value.filter(i)});const P=(i,h)=>i?h.label.includes(i):!0,q=async()=>{const i=await Dl();p.value=i.data};function N(i){if(i!==""&&n){if(r.value){for(const h of d.value)n.refs[`t-${h.index}`]&&n.refs[`t-${h.index}`][0].onSendMsg(i+`
`);return}n.refs[`t-${_.value}`]&&n.refs[`t-${_.value}`][0].onSendMsg(i+`
`),c.value=""}}function Y(){if(!(w.value===""||!n)){if(r.value){for(const i of d.value)n.refs[`t-${i.index}`]&&n.refs[`t-${i.index}`][0].onSendMsg(w.value+`
`);w.value="";return}n.refs[`t-${_.value}`]&&n.refs[`t-${_.value}`][0].onSendMsg(w.value+`
`),w.value=""}}function W(i){if(i==="newTabs")return!1}const S=()=>{f.value.acceptParams({isLocal:!1})},te=()=>{we(O.global.t("terminal.localhost"),s.value,!0)},T=(i,h)=>{i.level!==1&&we(i.label,h.id,!1)},K=async i=>{n&&n.refs[`t-${i.index}`]&&n.refs[`t-${i.index}`][0].onClose(),i.Refresh=!i.Refresh;const h=await Re(i.wsID);$e(()=>{n.refs[`t-${i.index}`]&&n.refs[`t-${i.index}`][0].acceptParams({wsID:i.wsID,terminalID:i.index,error:h.data?"":"Failed to set up the connection. Please check the host information"})}),Se()},we=async(i,h,G)=>{const Q=await Re(h);if(G){for(const j of d.value)if(j.title.indexOf("@127.0.0.1:")!==-1||j.title===O.global.t("terminal.localhost")){K(j);return}}d.value.push({index:z,title:i,wsID:h,status:Q.data?"online":"closed"}),_.value=z,!Q.data&&G&&f.value.acceptParams({isLocal:!0}),$e(()=>{n.refs[`t-${_.value}`]&&n.refs[`t-${_.value}`][0].acceptParams({wsID:h,terminalID:_.value,error:Q.data?"":"Authentication failed.  Please check the host information !"})}),z++};function Se(){for(const i of d.value)n&&n.refs[`t-${i.index}`][0]&&(i.status=n.refs[`t-${i.index}`][0].isWsOpen()?"online":"closed")}return C({acceptParams:a,cleanTimer:o}),(i,h)=>{const G=Ve("circleCheck"),Q=ol,j=ne,re=nl,me=fe,We=ve,je=rl,De=ce,Ee=sl,Je=ul,Xe=il,Ye=dl,Qe=cl;return v(),E("div",null,[e(Ye,{type:"card",class:"terminal-tabs",style:{"background-color":"#efefef","margin-top":"20px"},modelValue:_.value,"onUpdate:modelValue":h[4]||(h[4]=F=>_.value=F),"before-leave":W,onTabChange:h[5]||(h[5]=F=>pe(c)?c.value="":c=""),onEdit:b},{default:l(()=>[(v(!0),E(se,null,ue(V(d),F=>(v(),B(Ee,{key:F.index,closable:!0,label:F.title,name:F.index},{label:l(()=>[A("span",Yl,[F.status==="online"?(v(),B(Q,{key:0,style:{"margin-top":"1px"},color:"#67C23A"},{default:l(()=>[e(G)]),_:1})):X("",!0),F.status==="closed"?(v(),B(j,{key:1,icon:"Refresh",style:{color:"white"},size:"default",link:"",onClick:L=>K(F)},null,8,["onClick"])):X("",!0),F.title.length<=20?(v(),E("span",Ql,"\xA0"+y(F.title)+"\xA0",1)):(v(),B(re,{key:3,content:F.title,placement:"top-start"},{default:l(()=>[A("span",null,"\xA0"+y(F.title.substring(0,17))+"...\xA0",1)]),_:2},1032,["content"]))])]),default:l(()=>[(v(),B(Nl,{style:{height:"calc(100vh - 227px)","background-color":"#000"},ref_for:!0,ref:"t-"+F.index,key:F.Refresh})),A("div",null,[e(We,{modelValue:V(c),"onUpdate:modelValue":h[0]||(h[0]=L=>pe(c)?c.value=L:c=L),clearable:"",filterable:"",onChange:N,style:{width:"25%"}},{prefix:l(()=>[M(y(i.$t("terminal.quickCommand")),1)]),default:l(()=>[(v(!0),E(se,null,ue(p.value,L=>(v(),B(me,{key:L.id,label:L.name,value:L.command},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(De,{modelValue:V(w),"onUpdate:modelValue":h[2]||(h[2]=L=>pe(w)?w.value=L:w=L),onKeyup:qe(Y,["enter"]),style:{width:"75%"}},{prepend:l(()=>[e(je,{label:i.$t("terminal.batchInput"),modelValue:V(r),"onUpdate:modelValue":h[1]||(h[1]=L=>pe(r)?r.value=L:r=L)},null,8,["label","modelValue"])]),_:1},8,["modelValue","onKeyup"])])]),_:2},1032,["label","name"]))),128)),e(Ee,{closable:!1,name:"newTabs"},{label:l(()=>[oe(e(j,{style:{"background-color":"#ededed",border:"0"},icon:"Plus"},null,512),[[Qe,u.value]]),e(Je,{ref_key:"popoverRef",ref:u,width:"250px",trigger:"hover","virtual-triggering":"",persistent:""},{default:l(()=>[A("div",Zl,[e(j,{link:"",type:"primary",onClick:S},{default:l(()=>[M(y(i.$t("terminal.createConn")),1)]),_:1})]),A("div",et,[e(j,{link:"",type:"primary",onClick:te},{default:l(()=>[M(y(i.$t("terminal.localhost")),1)]),_:1})]),A("div",lt,[e(De,{modelValue:U.value,"onUpdate:modelValue":h[3]||(h[3]=F=>U.value=F),style:{"margin-top":"5px"},clearable:"","suffix-icon":"Search",placeholder:i.$t("commons.button.search")},null,8,["modelValue","placeholder"])]),e(V(al),{ref_key:"treeRef",ref:x,"expand-on-click-node":!1,"node-key":"id","default-expand-all":!0,data:k.value,props:R,"filter-node-method":P,"empty-text":i.$t("terminal.noHost")},{default:l(({node:F,data:L})=>[A("span",tt,[F.label==="default"?(v(),E("span",at,y(i.$t("website.default")),1)):(v(),E("div",ot,[F.label.length<=25?(v(),E("span",nt,[A("a",{onClick:Ze=>T(F,L)},y(F.label),9,rt)])):(v(),B(re,{key:1,content:F.label,placement:"top-start"},{default:l(()=>[A("span",null,[A("a",{onClick:Ze=>T(F,L)},y(F.label.substring(0,22))+"... ",9,st)])]),_:2},1032,["content"]))]))])]),_:1},8,["data","empty-text"])]),_:1},512)]),_:1}),V(d).length===0?(v(),E("div",ut,[e(Xe,{style:{"background-color":"#000",height:"calc(100vh - 200px)"},description:i.$t("terminal.emptyTerminal")},null,8,["description"])])):X("",!0)]),_:1},8,["modelValue"]),e(j,{onClick:t,class:"fullScreen",icon:"FullScreen"}),e(Xl,{ref_key:"dialogRef",ref:f,onOnConnTerminal:we,onLoadHostTree:g},null,512)])}}});var dt=Be(it,[["__scopeId","data-v-22de046f"]]);const ct={key:0},mt={key:1},jt=le({__name:"index",setup(I){const C=m("terminal"),f=m(),n=m(),$=m(),t=s=>{s==="host"&&f.value.acceptParams(),s==="command"&&n.value.acceptParams(),s==="terminal"&&$.value.acceptParams()};return pl(()=>{t("terminal")}),fl(()=>{var s;(s=$.value)==null||s.cleanTimer()}),(s,D)=>{const _=vl,d=ke,z=bl;return v(),E("div",null,[e(z,{class:"router_card"},{default:l(()=>[e(d,{modelValue:C.value,"onUpdate:modelValue":D[0]||(D[0]=p=>C.value=p),onChange:t},{default:l(()=>[e(_,{class:"router_card_button",size:"large",label:"terminal"},{default:l(()=>[M(y(s.$t("menu.terminal")),1)]),_:1}),e(_,{class:"router_card_button",size:"large",label:"host"},{default:l(()=>[M(y(s.$t("menu.host")),1)]),_:1}),e(_,{class:"router_card_button",size:"large",label:"command"},{default:l(()=>[M(y(s.$t("terminal.quickCommand")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),oe(A("div",null,[e(dt,{ref_key:"terminalTabRef",ref:$},null,512)],512),[[_l,C.value==="terminal"]]),C.value==="host"?(v(),E("div",ct,[e(Ll,{ref_key:"hostTabRef",ref:f},null,512)])):X("",!0),C.value==="command"?(v(),E("div",mt,[e(Ol,{ref_key:"commandTabRef",ref:n},null,512)])):X("",!0)])}}});export{jt as default};
