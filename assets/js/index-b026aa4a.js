import{d as we,r as $,x as ce,j as i,b as n,c as f,w as a,e as l,f as _,g,t,y as h,a3 as ze,h as y,F as Z,i as J,O as m,U as Oe,$ as le,K as qe,L as Ae,E as Pe,a2 as Fe,a1 as Ke,a4 as na,aw as sa,l as fe,m as De,A as ge,af as ra,_ as ua,a as ia,X as ie,Y as ve,ap as ye,aK as We,ac as ca,C as da,aL as pa,a0 as ma,p as ba,k as va,aM as ya,a5 as Ge,q as wa,s as fa,o as Da,aq as ga,ae as _a}from"./index-9eeac04e.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css            *//* empty css            *//* empty css              *//* empty css               */import{_ as ka}from"./index-8d9ad139.js";import{T as ha}from"./index-2dd05578.js";import{_ as $a}from"./index-e1bcfb8a.js";import{_ as ja}from"./index-bb4c3e65.js";/* empty css                *//* empty css                     */import"./form-item-d76e7d20.js";/* empty css               *//* empty css               */import{R as I,c as me}from"./form-rules-028b05ac.js";import{_ as Ta}from"./index-d5a7152b.js";import{g as Sa}from"./setting-f1c3ee2a.js";import{h as P}from"./index-5ffc91ba.js";import{l as Va}from"./database-a10f2df4.js";import{C as Na}from"./app-b908b206.js";import{G as Ca}from"./website-e8579279.js";/* empty css             */import"./tooltip-b30db216.js";/* empty css                *//* empty css             *//* empty css                    *//* empty css             *//* empty css                    */import{_ as Ra}from"./no_app-68a0aee4.js";import{l as C,b as be}from"./util-cbaccc93.js";import{D as Ia,L as Ea}from"./files-d9eb6d1f.js";import{_ as Xe}from"./layout-content-27c09564.js";import{j as Ha,o as Ma,T as Ua}from"./index-b02b032a.js";import{_ as Ba}from"./index-913c5065.js";import{u as Wa}from"./use-delete-data-8b6821a4.js";/* empty css               *//* empty css              *//* empty css             *//* empty css                     */import"./base64-e52cbffd.js";/* empty css                    *//* empty css                     *//* empty css              */const La=k=>P.post("/cronjobs/search",k),za=k=>P.post("/cronjobs",k),Oa=k=>P.post("/cronjobs/update",k),qa=k=>P.post("/cronjobs/del",k),Le=k=>P.post("cronjobs/search/records",k),Aa=k=>P.post("cronjobs/records/clean",{id:k}),Ye=k=>P.post("cronjobs/status",k),Pa=k=>P.post("cronjobs/download",k),Ze=k=>P.post("cronjobs/handle",{id:k}),Fa={key:2},Ka={key:4},Ga={class:"dialog-footer"},Xa=we({__name:"index",emits:["search"],setup(k,{expose:B,emit:W}){const O=$(""),E=$(!1),e=$({title:""}),Y=s=>{e.value=s,e.value.title==="create"&&ee(),O.value=i.global.t("commons.button."+e.value.title),E.value=!0,V(),p(),v()},Q=()=>{E.value=!1},r=$(),H=$(),T=$(),M=ce({isExist:!1,name:"",version:"",dbNames:[]}),q=(s,d,u)=>{switch(e.value.rowData.specType){case"perMonth":case"perNDay":Number.isInteger(e.value.rowData.day)&&Number.isInteger(e.value.rowData.hour)&&Number.isInteger(e.value.rowData.minute)||u(new Error(i.global.t("cronjob.cronSpecRule")));break;case"perWeek":Number.isInteger(e.value.rowData.week)&&Number.isInteger(e.value.rowData.hour)&&Number.isInteger(e.value.rowData.minute)||u(new Error(i.global.t("cronjob.cronSpecRule")));break;case"perDay":Number.isInteger(e.value.rowData.hour)&&Number.isInteger(e.value.rowData.minute)||u(new Error(i.global.t("cronjob.cronSpecRule")));break;case"perNHour":Number.isInteger(e.value.rowData.hour)&&Number.isInteger(e.value.rowData.minute)||u(new Error(i.global.t("cronjob.cronSpecRule")));break;case"perHour":case"perNMinute":Number.isInteger(e.value.rowData.minute)||u(new Error(i.global.t("cronjob.cronSpecRule")));break}u()},x=[{label:i.global.t("cronjob.perMonth"),value:"perMonth"},{label:i.global.t("cronjob.perWeek"),value:"perWeek"},{label:i.global.t("cronjob.perDay"),value:"perDay"},{label:i.global.t("cronjob.perHour"),value:"perHour"},{label:i.global.t("cronjob.perNDay"),value:"perNDay"},{label:i.global.t("cronjob.perNHour"),value:"perNHour"},{label:i.global.t("cronjob.perNMinute"),value:"perNMinute"}],ne=[{label:i.global.t("cronjob.monday"),value:1},{label:i.global.t("cronjob.tuesday"),value:2},{label:i.global.t("cronjob.wednesday"),value:3},{label:i.global.t("cronjob.thursday"),value:4},{label:i.global.t("cronjob.friday"),value:5},{label:i.global.t("cronjob.saturday"),value:6},{label:i.global.t("cronjob.sunday"),value:7}],se=ce({name:[I.requiredInput],type:[I.requiredSelect],specType:[I.requiredSelect],spec:[{validator:q,trigger:"blur",required:!0},{validator:q,trigger:"change",required:!0}],week:[I.requiredSelect,I.number],day:[I.number,me(1,31)],hour:[I.number,me(1,23)],minute:[I.number,me(1,59)],script:[I.requiredInput],website:[I.requiredSelect],dbName:[I.requiredSelect],url:[I.requiredInput],sourceDir:[I.requiredSelect],targetDirID:[I.requiredSelect,I.number],retainCopies:[I.number]}),R=$(),w=async s=>{e.value.rowData.sourceDir=s},ee=()=>{switch(e.value.rowData.type){case"shell":e.value.rowData.specType="perWeek",e.value.rowData.week=1,e.value.rowData.hour=1,e.value.rowData.minute=30;break;case"database":e.value.rowData.specType="perDay",e.value.rowData.hour=2,e.value.rowData.minute=30;break;case"website":e.value.rowData.specType="perWeek",e.value.rowData.week=1,e.value.rowData.hour=1,e.value.rowData.minute=30;break;case"directory":e.value.rowData.specType="perDay",e.value.rowData.hour=1,e.value.rowData.minute=30;break;case"curl":e.value.rowData.specType="perWeek",e.value.rowData.week=1,e.value.rowData.hour=1,e.value.rowData.minute=30;break}},p=async()=>{const s=await Sa();T.value=[];for(const d of s.data)d.id!==0&&(d.type==="LOCAL"&&(r.value=d.id,e.value.rowData.targetDirID||(e.value.rowData.targetDirID=d.id)),T.value.push({label:i.global.t("setting."+d.type),value:d.id}))},v=async()=>{const s=await Ca();H.value=s.data},V=async()=>{const s=await Na("mysql");if(M.isExist=s.data.isExist,M.name=s.data.name,M.version=s.data.version,M.isExist){const d=await Va();M.dbNames=d.data}};function ae(){return e.value.rowData.type==="website"||e.value.rowData.type==="database"||e.value.rowData.type==="directory"}function re(){return e.value.rowData.type==="shell"}function ue(){let s=e.value.rowData;switch(s.specType){case"perMonth":return s.day>0&&s.day<32&&s.hour>=0&&s.hour<24&&s.minute>=0&&s.minute<60;case"perWeek":return s.week>0&&s.week<8&&s.hour>=0&&s.hour<24&&s.minute>=0&&s.minute<60;case"perDay":return s.hour>=0&&s.hour<24&&s.minute>=0&&s.minute<60;case"perHour":return s.minute>0&&s.minute<60;case"perNDay":return s.day>0&&s.day<366&&s.hour>=0&&s.hour<24&&s.minute>=0&&s.minute<60;case"perNHour":return s.hour>0&&s.hour<8784&&s.minute>=0&&s.minute<60;case"perNMinute":return s.minute>0&&s.minute<527040}}const U=async s=>{if(e.value.rowData.week=Number(e.value.rowData.week),e.value.rowData.day=Number(e.value.rowData.day),e.value.rowData.hour=Number(e.value.rowData.hour),e.value.rowData.minute=Number(e.value.rowData.minute),!ue()){Oe(i.global.t("cronjob.cronSpecHelper"));return}!s||s.validate(async d=>{!d||!e.value.rowData||(e.value.title==="create"&&await za(e.value.rowData),e.value.title==="edit"&&await Oa(e.value.rowData),le(i.global.t("commons.msg.operationSuccess")),W("search"),E.value=!1)})};return B({acceptParams:Y}),(s,d)=>{const u=qe,o=Ae,b=Pe,D=Fe,N=Ke,te=na,oe=sa,F=fe,K=De,L=ge,de=ra;return n(),f(de,{modelValue:E.value,"onUpdate:modelValue":d[18]||(d[18]=c=>E.value=c),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:a(()=>[l(ja,{header:s.$t("cronjob.cronTask"),back:Q},null,8,["header"])]),footer:a(()=>[_("span",Ga,[l(L,{onClick:d[16]||(d[16]=c=>E.value=!1)},{default:a(()=>[g(t(s.$t("commons.button.cancel")),1)]),_:1}),l(L,{type:"primary",onClick:d[17]||(d[17]=c=>U(R.value))},{default:a(()=>[g(t(s.$t("commons.button.confirm")),1)]),_:1})])]),default:a(()=>[l(h(ze),{ref_key:"formRef",ref:R,"label-position":"top",model:e.value.rowData,rules:se},{default:a(()=>[l(K,{type:"flex",justify:"center"},{default:a(()=>[l(F,{span:22},{default:a(()=>[l(D,{label:s.$t("cronjob.taskType"),prop:"type"},{default:a(()=>[e.value.title==="create"?(n(),f(o,{key:0,style:{width:"100%"},onChange:ee,modelValue:e.value.rowData.type,"onUpdate:modelValue":d[0]||(d[0]=c=>e.value.rowData.type=c)},{default:a(()=>[l(u,{value:"shell",label:s.$t("cronjob.shell")},null,8,["label"]),l(u,{value:"website",label:s.$t("cronjob.website")},null,8,["label"]),l(u,{value:"database",label:s.$t("cronjob.database")},null,8,["label"]),l(u,{value:"directory",label:s.$t("cronjob.directory")},null,8,["label"]),l(u,{value:"curl",label:s.$t("cronjob.curl")},null,8,["label"])]),_:1},8,["modelValue"])):(n(),f(b,{key:1},{default:a(()=>[g(t(e.value.rowData.type),1)]),_:1}))]),_:1},8,["label"]),l(D,{label:s.$t("cronjob.taskName"),prop:"name"},{default:a(()=>[l(N,{disabled:e.value.title==="edit",style:{width:"100%"},clearable:"",modelValue:e.value.rowData.name,"onUpdate:modelValue":d[1]||(d[1]=c=>e.value.rowData.name=c),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])]),_:1},8,["label"]),l(D,{label:s.$t("cronjob.cronSpec"),prop:"spec"},{default:a(()=>[l(o,{style:{width:"20%"},modelValue:e.value.rowData.specType,"onUpdate:modelValue":d[2]||(d[2]=c=>e.value.rowData.specType=c)},{default:a(()=>[(n(),y(Z,null,J(x,c=>l(u,{key:c.label,value:c.value,label:c.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"]),e.value.rowData.specType==="perWeek"?(n(),f(o,{key:0,style:{width:"12%","margin-left":"20px"},modelValue:e.value.rowData.week,"onUpdate:modelValue":d[3]||(d[3]=c=>e.value.rowData.week=c)},{default:a(()=>[(n(),y(Z,null,J(ne,c=>l(u,{key:c.label,value:c.value,label:c.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])):m("",!0),e.value.rowData.specType==="perMonth"||e.value.rowData.specType==="perNDay"?(n(),f(N,{key:1,style:{width:"20%","margin-left":"20px"},modelValue:e.value.rowData.day,"onUpdate:modelValue":d[4]||(d[4]=c=>e.value.rowData.day=c),modelModifiers:{number:!0}},{append:a(()=>[g(t(s.$t("cronjob.day")),1)]),_:1},8,["modelValue"])):m("",!0),e.value.rowData.specType!=="perHour"&&e.value.rowData.specType!=="perNMinute"?(n(),f(N,{key:2,style:{width:"20%","margin-left":"20px"},modelValue:e.value.rowData.hour,"onUpdate:modelValue":d[5]||(d[5]=c=>e.value.rowData.hour=c),modelModifiers:{number:!0}},{append:a(()=>[g(t(s.$t("cronjob.hour")),1)]),_:1},8,["modelValue"])):m("",!0),l(N,{style:{width:"20%","margin-left":"20px"},modelValue:e.value.rowData.minute,"onUpdate:modelValue":d[6]||(d[6]=c=>e.value.rowData.minute=c),modelModifiers:{number:!0}},{append:a(()=>[g(t(s.$t("cronjob.minute")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"]),re()?(n(),f(D,{key:0,label:s.$t("cronjob.shellContent"),prop:"script"},{default:a(()=>[l(N,{style:{width:"100%"},clearable:"",type:"textarea",autosize:{minRows:3,maxRows:6},modelValue:e.value.rowData.script,"onUpdate:modelValue":d[7]||(d[7]=c=>e.value.rowData.script=c)},null,8,["modelValue"])]),_:1},8,["label"])):m("",!0),e.value.rowData.type==="website"?(n(),f(D,{key:1,label:s.$t("cronjob.website"),prop:"website"},{default:a(()=>[l(o,{style:{width:"100%"},modelValue:e.value.rowData.website,"onUpdate:modelValue":d[8]||(d[8]=c=>e.value.rowData.website=c)},{default:a(()=>[l(u,{label:s.$t("commons.table.all"),value:"all"},null,8,["label"]),(n(!0),y(Z,null,J(H.value,c=>(n(),f(u,{key:c,value:c,label:c},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):m("",!0),e.value.rowData.type==="database"?(n(),y("div",Fa,[l(D,{label:s.$t("cronjob.database"),prop:"dbName"},{default:a(()=>[l(o,{style:{width:"100%"},clearable:"",modelValue:e.value.rowData.dbName,"onUpdate:modelValue":d[9]||(d[9]=c=>e.value.rowData.dbName=c)},{default:a(()=>[l(u,{label:s.$t("commons.table.all"),value:"all"},null,8,["label"]),(n(!0),y(Z,null,J(M.dbNames,c=>(n(),f(u,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])])):m("",!0),e.value.rowData.type==="directory"?(n(),f(D,{key:3,label:s.$t("cronjob.sourceDir"),prop:"sourceDir"},{default:a(()=>[l(N,{style:{width:"100%"},modelValue:e.value.rowData.sourceDir,"onUpdate:modelValue":d[10]||(d[10]=c=>e.value.rowData.sourceDir=c)},{prepend:a(()=>[l(Ta,{onChoose:w,dir:!0})]),_:1},8,["modelValue"])]),_:1},8,["label"])):m("",!0),ae()?(n(),y("div",Ka,[l(D,{label:s.$t("cronjob.target"),prop:"targetDirID"},{default:a(()=>[l(o,{style:{width:"100%"},modelValue:e.value.rowData.targetDirID,"onUpdate:modelValue":d[11]||(d[11]=c=>e.value.rowData.targetDirID=c)},{default:a(()=>[(n(!0),y(Z,null,J(T.value,c=>(n(),f(u,{key:c.label,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.rowData.targetDirID!==r.value?(n(),f(D,{key:0},{default:a(()=>[l(te,{modelValue:e.value.rowData.keepLocal,"onUpdate:modelValue":d[12]||(d[12]=c=>e.value.rowData.keepLocal=c)},{default:a(()=>[g(t(s.$t("cronjob.saveLocal")),1)]),_:1},8,["modelValue"])]),_:1})):m("",!0),l(D,{label:s.$t("cronjob.retainCopies"),prop:"retainCopies"},{default:a(()=>[l(oe,{min:1,max:30,"step-strictly":"",step:1,modelValue:e.value.rowData.retainCopies,"onUpdate:modelValue":d[13]||(d[13]=c=>e.value.rowData.retainCopies=c),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"])])):m("",!0),e.value.rowData.type==="curl"?(n(),f(D,{key:5,label:s.$t("cronjob.url"),prop:"url"},{default:a(()=>[l(N,{style:{width:"100%"},clearable:"",modelValue:e.value.rowData.url,"onUpdate:modelValue":d[14]||(d[14]=c=>e.value.rowData.url=c),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1},8,["label"])):m("",!0),e.value.rowData.type==="directory"?(n(),f(D,{key:6,label:s.$t("cronjob.exclusionRules"),prop:"exclusionRules"},{default:a(()=>[l(N,{style:{width:"100%"},type:"textarea",placeholder:s.$t("cronjob.rulesHelper"),autosize:{minRows:3,maxRows:6},clearable:"",modelValue:e.value.rowData.exclusionRules,"onUpdate:modelValue":d[15]||(d[15]=c=>e.value.rowData.exclusionRules=c)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):m("",!0)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});const Ya=k=>(wa("data-v-e6e70900"),k=k(),fa(),k),Za={key:0},Ja={class:"a-card",style:{"margin-top":"20px"}},Qa={key:0},xa={key:1},et={key:2},at={key:3},tt={key:4},ot={key:5},lt={key:6},nt={key:7},st={class:"buttons"},rt={class:"infinite-list",style:{overflow:"auto"}},ut=["onClick"],it={key:3,style:{color:"red"}},ct={key:4},dt={style:{"margin-top":"10px","margin-bottom":"5px","font-size":"12px",float:"right"}},pt={class:"status-label"},mt={class:"status-count"},bt={class:"status-label"},vt={key:0,class:"status-count"},yt={key:1,class:"status-count"},wt={class:"status-label"},ft={key:0,class:"status-count"},Dt={key:1,class:"status-count"},gt={class:"status-label"},_t={key:0,class:"status-count"},kt={key:1},ht={class:"status-count"},$t={class:"status-label"},jt={class:"status-count"},Tt={class:"status-label"},St={key:0},Vt={key:1,class:"status-count"},Nt={class:"status-label"},Ct={class:"status-count"},Rt={class:"status-label"},It={key:0,class:"status-count"},Et={key:1,class:"status-count"},Ht={class:"status-label"},Mt={style:{width:"300px","word-break":"break-all"}},Ut={key:1,class:"app-warn"},Bt=Ya(()=>_("div",null,[_("img",{src:Ra})],-1)),Wt=we({__name:"index",setup(k,{expose:B}){const W=$(),O=$();let E=null;const e=$(),Y=[Ha(),Ma],Q=$(!1),r=$(),H=$([]),T=$(),M=$(""),q=$(),x=async o=>{r.value=o,Q.value=!0,v(!0),E=setInterval(()=>{V()},1e3*10)},ne=[{text:i.global.t("monitor.today"),value:()=>{const o=new Date(new Date().setHours(23,59,59,999));return[new Date(new Date().setHours(0,0,0,0)),o]}},{text:i.global.t("monitor.yestoday"),value:()=>{const o=new Date(new Date().getTime()-864e5),b=new Date(o.setHours(23,59,59,999));return[new Date(o.setHours(0,0,0,0)),b]}},{text:i.global.t("monitor.lastNDay",[3]),value:()=>{const o=new Date(new Date().getTime()-2592e5),b=new Date(new Date().setHours(23,59,59,999));return[new Date(o.setHours(0,0,0,0)),b]}},{text:i.global.t("monitor.lastNDay",[7]),value:()=>{const o=new Date(new Date().getTime()-6048e5),b=new Date(new Date().setHours(23,59,59,999));return[new Date(o.setHours(0,0,0,0)),b]}},{text:i.global.t("monitor.lastNDay",[30]),value:()=>{const o=new Date(new Date().getTime()-2592e6),b=new Date(new Date().setHours(23,59,59,999));return[new Date(o.setHours(0,0,0,0)),b]}}],se=[{label:i.global.t("cronjob.monday"),value:1},{label:i.global.t("cronjob.tuesday"),value:2},{label:i.global.t("cronjob.wednesday"),value:3},{label:i.global.t("cronjob.thursday"),value:4},{label:i.global.t("cronjob.friday"),value:5},{label:i.global.t("cronjob.saturday"),value:6},{label:i.global.t("cronjob.sunday"),value:7}],R=$([new Date(new Date(new Date().getTime()-3600*1e3*24*7).setHours(0,0,0,0)),new Date(new Date().setHours(23,59,59,999))]),w=ce({page:1,pageSize:12,recordTotal:0,cronjobID:0,startTime:new Date,endTime:new Date,status:""}),ee=async o=>{W.value=!0,await Ze(o.id).then(()=>{W.value=!1,le(i.global.t("commons.msg.operationSuccess")),w.pageSize=w.pageSize*w.page,w.page=1,H.value=[],v(!1)}).catch(()=>{W.value=!1})},p=async(o,b)=>{ye.confirm(i.global.t("cronjob."+b+"Msg"),i.global.t("cronjob.changeStatus"),{confirmButtonText:i.global.t("commons.button.confirm"),cancelButtonText:i.global.t("commons.button.cancel")}).then(async()=>{let D=b==="enable"?"Enable":"Disable";await Ye({id:o,status:D}),le(i.global.t("commons.msg.operationSuccess")),r.value.rowData.status=D})},v=async o=>{o&&(w.page=1,w.pageSize=12,H.value=[]),R.value&&R.value.length===2?(w.startTime=R.value[0],w.endTime=R.value[1]):(w.startTime=new Date(new Date().setHours(0,0,0,0)),w.endTime=new Date);let b={page:w.page,pageSize:w.pageSize,cronjobID:r.value.rowData.id,startTime:w.startTime,endTime:w.endTime,status:w.status};const D=await Le(b);if(w.page===1&&!D.data.items){O.value=!1;return}if(!!D.data.items){for(const N of D.data.items)H.value.push(N);O.value=!0,T.value=H.value[0],q.value=0,U(T.value),w.recordTotal=D.data.total}},V=async()=>{H.value=[],w.pageSize=w.pageSize*w.page,w.page=1,R.value&&R.value.length===2?(w.startTime=R.value[0],w.endTime=R.value[1]):(w.startTime=new Date(new Date().setHours(0,0,0,0)),w.endTime=new Date);let o={page:w.page,pageSize:w.pageSize,cronjobID:r.value.rowData.id,startTime:w.startTime,endTime:w.endTime,status:w.status};const b=await Le(o);H.value=b.data.items||[]},ae=async(o,b)=>{if(r.value.rowData.dbName==="all"){We(i.global.t("cronjob.allOptionHelper",[i.global.t("database.database")]));return}if(r.value.rowData.website==="all"){We(i.global.t("cronjob.allOptionHelper",[i.global.t("website.website")]));return}if(!o.file||o.file.indexOf("/")===-1){Oe(i.global.t("cronjob.errPath",[o.file]));return}let D={recordID:o.id,backupAccountID:b};await Pa(D).then(async N=>{const te=await Ia(N.data),oe=window.URL.createObjectURL(new Blob([te])),F=document.createElement("a");if(F.style.display="none",F.href=oe,o.file&&o.file.indexOf("/")!==-1){let L=o.file.split("/");F.download=L[L.length-1]}const K=new MouseEvent("click");F.dispatchEvent(K)})},re=async()=>{w.pageSize>=w.recordTotal||(w.page=w.page+1,v(!1))},ue=async(o,b)=>{T.value=o,q.value=b,U(o)},U=async o=>{if(o.status==="Failed"){M.value=o.records;return}if(o.records){const b=await Ea({path:o.records});M.value=b.data}},s=async()=>{ye.confirm(i.global.t("cronjob.cleanHelper"),i.global.t("commons.button.clean"),{confirmButtonText:i.global.t("commons.button.confirm"),cancelButtonText:i.global.t("commons.button.cancel"),type:"info"}).then(async()=>{await Aa(r.value.rowData.id),le(i.global.t("commons.msg.operationSuccess")),v(!0)})};function d(){return r.value.rowData.type==="website"||r.value.rowData.type==="database"||r.value.rowData.type==="directory"}function u(o){for(const b of se)if(b.value===o)return b.label;return""}return ia(()=>{clearInterval(Number(E)),E=null}),B({acceptParams:x}),(o,b)=>{const D=Pe,N=ge,te=ca,oe=da,F=pa,K=fe,L=qe,de=Ae,c=De,Je=ie("Select"),pe=ma,Qe=ie("Loading"),xe=ie("CloseBold"),A=Fe,ea=ba,aa=va,ta=ze,oa=ya,la=Ge;return Q.value?ve((n(),y("div",Za,[_("div",Ja,[l(oe,null,{default:a(()=>[_("div",null,[l(D,{style:{float:"left"},effect:"dark",type:"success"},{default:a(()=>[g(t(o.$t("cronjob."+r.value.rowData.type)),1)]),_:1}),r.value.rowData.status==="Enable"?(n(),f(D,{key:0,round:"",class:"status-content",type:"success"},{default:a(()=>[g(t(o.$t("commons.status.running")),1)]),_:1})):m("",!0),r.value.rowData.status==="Disable"?(n(),f(D,{key:1,round:"",class:"status-content",type:"info"},{default:a(()=>[g(t(o.$t("commons.status.stopped")),1)]),_:1})):m("",!0),l(D,{class:"status-content"},{default:a(()=>{var S,j,z,G,X,_e,ke,he,$e,je,Te,Se,Ve,Ne,Ce,Re,Ie,Ee,He,Me,Ue,Be;return[((S=r.value.rowData)==null?void 0:S.specType.indexOf("N"))===-1||((j=r.value.rowData)==null?void 0:j.specType)==="perWeek"?(n(),y("span",Qa,t(o.$t("cronjob."+((z=r.value.rowData)==null?void 0:z.specType)))+"\xA0 ",1)):(n(),y("span",xa,t(o.$t("cronjob.per")),1)),((G=r.value.rowData)==null?void 0:G.specType)==="perMonth"?(n(),y("span",et,t((X=r.value.rowData)==null?void 0:X.day)+t(o.$t("cronjob.day"))+"\xA0 "+t(h(C)((_e=r.value.rowData)==null?void 0:_e.hour))+" : "+t(h(C)((ke=r.value.rowData)==null?void 0:ke.minute)),1)):m("",!0),((he=r.value.rowData)==null?void 0:he.specType)==="perWeek"?(n(),y("span",at,t(u(($e=r.value.rowData)==null?void 0:$e.week))+"\xA0 "+t(h(C)((je=r.value.rowData)==null?void 0:je.hour))+" : "+t(h(C)((Te=r.value.rowData)==null?void 0:Te.minute)),1)):m("",!0),((Se=r.value.rowData)==null?void 0:Se.specType)==="perNDay"?(n(),y("span",tt,t((Ve=r.value.rowData)==null?void 0:Ve.day)+t(o.$t("cronjob.day1"))+",\xA0 "+t(h(C)((Ne=r.value.rowData)==null?void 0:Ne.hour))+" : "+t(h(C)((Ce=r.value.rowData)==null?void 0:Ce.minute)),1)):m("",!0),((Re=r.value.rowData)==null?void 0:Re.specType)==="perNHour"?(n(),y("span",ot,t((Ie=r.value.rowData)==null?void 0:Ie.hour)+t(o.$t("cronjob.hour"))+",\xA0 "+t(h(C)((Ee=r.value.rowData)==null?void 0:Ee.minute)),1)):m("",!0),((He=r.value.rowData)==null?void 0:He.specType)==="perHour"?(n(),y("span",lt," \xA0"+t(h(C)((Me=r.value.rowData)==null?void 0:Me.minute)),1)):m("",!0),((Ue=r.value.rowData)==null?void 0:Ue.specType)==="perNMinute"?(n(),y("span",nt," \xA0"+t((Be=r.value.rowData)==null?void 0:Be.minute)+t(o.$t("cronjob.minute")),1)):m("",!0),g(" \xA0"+t(o.$t("cronjob.handle")),1)]}),_:1}),_("span",st,[l(N,{type:"primary",onClick:b[0]||(b[0]=S=>ee(r.value.rowData)),link:""},{default:a(()=>[g(t(o.$t("commons.button.handle")),1)]),_:1}),l(te,{direction:"vertical"}),r.value.rowData.status==="Enable"?(n(),f(N,{key:0,type:"primary",onClick:b[1]||(b[1]=S=>p(r.value.rowData.id,"disable")),link:""},{default:a(()=>[g(t(o.$t("commons.button.disable")),1)]),_:1})):m("",!0),l(te,{direction:"vertical"}),r.value.rowData.status==="Disable"?(n(),f(N,{key:1,type:"primary",onClick:b[2]||(b[2]=S=>p(r.value.rowData.id,"enable")),link:""},{default:a(()=>[g(t(o.$t("commons.button.enable")),1)]),_:1})):m("",!0),l(N,{type:"primary",disabled:H.value.length<=7,onClick:b[3]||(b[3]=S=>s()),link:""},{default:a(()=>[g(t(o.$t("commons.button.clean")),1)]),_:1},8,["disabled"])])])]),_:1})]),l(Xe,{title:o.$t("cronjob.record"),reload:!0},{search:a(()=>[l(c,{gutter:20},{default:a(()=>[l(K,{span:8},{default:a(()=>[l(F,{style:{width:"calc(100% - 20px)"},onChange:b[4]||(b[4]=S=>v(!0)),modelValue:R.value,"onUpdate:modelValue":b[5]||(b[5]=S=>R.value=S),type:"datetimerange","range-separator":o.$t("commons.search.timeRange"),"start-placeholder":o.$t("commons.search.timeStart"),"end-placeholder":o.$t("commons.search.timeEnd"),shortcuts:ne},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"])]),_:1}),l(K,{span:16},{default:a(()=>[l(de,{onChange:b[6]||(b[6]=S=>v(!0)),modelValue:w.status,"onUpdate:modelValue":b[7]||(b[7]=S=>w.status=S)},{prefix:a(()=>[g(t(o.$t("commons.table.status")),1)]),default:a(()=>[l(L,{label:o.$t("commons.table.all"),value:""},null,8,["label"]),l(L,{label:o.$t("commons.status.success"),value:"Success"},null,8,["label"]),l(L,{label:o.$t("commons.status.waiting"),value:"Waiting"},null,8,["label"]),l(L,{label:o.$t("commons.status.failed"),value:"Failed"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),main:a(()=>[O.value?(n(),f(c,{key:0,gutter:20},{default:a(()=>[l(K,{span:8},{default:a(()=>[l(oe,null,{default:a(()=>[ve((n(),y("ul",rt,[(n(!0),y(Z,null,J(H.value,(S,j)=>(n(),y("li",{key:j,onClick:z=>ue(S,j),class:"infinite-list-item"},[S.status==="Success"?(n(),f(pe,{key:0},{default:a(()=>[l(Je)]),_:1})):m("",!0),S.status==="Waiting"?(n(),f(pe,{key:1},{default:a(()=>[l(Qe)]),_:1})):m("",!0),S.status==="Failed"?(n(),f(pe,{key:2},{default:a(()=>[l(xe)]),_:1})):m("",!0),j===q.value?(n(),y("span",it,t(h(be)(0,0,S.startTime)),1)):(n(),y("span",ct,t(h(be)(0,0,S.startTime)),1))],8,ut))),128))])),[[oa,re]]),_("div",dt,[_("span",null,t(o.$t("commons.table.total",[w.recordTotal])),1)])]),_:1})]),_:1}),l(K,{span:16},{default:a(()=>[l(ta,{"label-position":"top"},{default:a(()=>{var S;return[l(c,{type:"flex",justify:"center"},{default:a(()=>[d()?(n(),f(A,{key:0,class:"descriptionWide"},{label:a(()=>[_("span",pt,t(o.$t("cronjob.target")),1)]),default:a(()=>{var j;return[_("span",mt,t(r.value.rowData.targetDir),1),((j=T.value)==null?void 0:j.status)==="Success"?(n(),f(N,{key:0,type:"primary",style:{"margin-left":"10px"},link:"",icon:"Download",onClick:b[8]||(b[8]=z=>ae(T.value,r.value.rowData.targetDirID))},{default:a(()=>[g(t(o.$t("file.download")),1)]),_:1})):m("",!0)]}),_:1})):m("",!0),r.value.rowData.type==="website"?(n(),f(A,{key:1,class:"description"},{label:a(()=>[_("span",bt,t(o.$t("cronjob.website")),1)]),default:a(()=>[r.value.rowData.website!=="all"?(n(),y("span",vt,t(r.value.rowData.website),1)):(n(),y("span",yt,t(o.$t("commons.table.all")),1))]),_:1})):m("",!0),r.value.rowData.type==="database"?(n(),f(A,{key:2,class:"description"},{label:a(()=>[_("span",wt,t(o.$t("cronjob.database")),1)]),default:a(()=>[r.value.rowData.website!=="all"?(n(),y("span",ft,t(r.value.rowData.dbName),1)):(n(),y("span",Dt,t(o.$t("commons.table.all")),1))]),_:1})):m("",!0),r.value.rowData.type==="directory"?(n(),f(A,{key:3,class:"description"},{label:a(()=>[_("span",gt,t(o.$t("cronjob.directory")),1)]),default:a(()=>[r.value.rowData.sourceDir.length<=12?(n(),y("span",_t,t(r.value.rowData.sourceDir),1)):(n(),y("div",kt,[l(ea,{placement:"top-start",trigger:"hover",width:"250",content:r.value.rowData.sourceDir},{reference:a(()=>[_("span",ht,t(r.value.rowData.sourceDir.substring(0,12))+"... ",1)]),_:1},8,["content"])]))]),_:1})):m("",!0),d()?(n(),f(A,{key:4,class:"description"},{label:a(()=>[_("span",$t,t(o.$t("cronjob.retainCopies")),1)]),default:a(()=>[_("span",jt,t(r.value.rowData.retainCopies),1)]),_:1})):m("",!0)]),_:1}),r.value.rowData.type==="website"||r.value.rowData.type==="directory"?(n(),f(A,{key:0,class:"description"},{label:a(()=>[_("span",Tt,t(o.$t("cronjob.exclusionRules")),1)]),default:a(()=>[r.value.rowData.exclusionRules?(n(),y("div",St,[(n(!0),y(Z,null,J(r.value.rowData.exclusionRules.split(";"),j=>(n(),y("div",{key:j},[l(D,null,{default:a(()=>[g(t(j),1)]),_:2},1024)]))),128))])):(n(),y("span",Vt,"-"))]),_:1})):m("",!0),l(c,{type:"flex",justify:"center"},{default:a(()=>[l(A,{class:"descriptionWide"},{label:a(()=>[_("span",Nt,t(o.$t("commons.search.timeStart")),1)]),default:a(()=>{var j;return[_("span",Ct,t(h(be)(0,0,(j=T.value)==null?void 0:j.startTime)),1)]}),_:1}),l(A,{class:"description"},{label:a(()=>[_("span",Rt,t(o.$t("commons.table.interval")),1)]),default:a(()=>{var j,z,G,X;return[((j=T.value)==null?void 0:j.interval)<=1e3?(n(),y("span",It,t((z=T.value)==null?void 0:z.interval)+" ms ",1)):m("",!0),((G=T.value)==null?void 0:G.interval)>1e3?(n(),y("span",Et,t(((X=T.value)==null?void 0:X.interval)/1e3)+" s ",1)):m("",!0)]}),_:1}),l(A,{class:"description"},{label:a(()=>[_("span",Ht,t(o.$t("commons.table.status")),1)]),default:a(()=>{var j,z,G;return[((j=T.value)==null?void 0:j.status)==="Failed"?(n(),f(aa,{key:0,placement:"top"},{content:a(()=>{var X;return[_("div",Mt,t((X=T.value)==null?void 0:X.message),1)]}),default:a(()=>[l(D,{type:"danger"},{default:a(()=>[g(t(o.$t("commons.table.statusFailed")),1)]),_:1})]),_:1})):m("",!0),((z=T.value)==null?void 0:z.status)==="Success"?(n(),f(D,{key:1,type:"success"},{default:a(()=>[g(t(o.$t("commons.table.statusSuccess")),1)]),_:1})):m("",!0),((G=T.value)==null?void 0:G.status)==="Waiting"?(n(),f(D,{key:2,type:"info"},{default:a(()=>[g(t(o.$t("commons.table.statusWaiting")),1)]),_:1})):m("",!0)]}),_:1})]),_:1}),(S=T.value)!=null&&S.records?(n(),f(c,{key:1},{default:a(()=>[_("span",null,t(o.$t("commons.table.records")),1),l(h(Ua),{ref_key:"mymirror",ref:e,autofocus:!0,placeholder:o.$t("cronjob.noLogs"),"indent-with-tab":!0,tabSize:4,style:{height:"calc(100vh - 484px)",width:"100%","margin-top":"5px"},lineWrapping:!0,matchBrackets:!0,theme:"cobalt",styleActiveLine:!0,extensions:Y,modelValue:M.value,"onUpdate:modelValue":b[9]||(b[9]=j=>M.value=j),disabled:!0},null,8,["placeholder","modelValue"])]),_:1})):m("",!0)]}),_:1})]),_:1})]),_:1})):m("",!0),O.value?m("",!0):(n(),y("div",Ut,[_("div",null,[_("span",null,t(o.$t("cronjob.noRecord")),1),Bt])]))]),_:1},8,["title"])])),[[la,W.value]]):m("",!0)}}});var Lt=ua(Wt,[["__scopeId","data-v-e6e70900"]]);const zt={class:"search-button"},Ot={key:0},qt={key:1},At={key:2},Pt={key:3},Ft={key:4},Kt={key:5},Gt={key:6},Xt={key:7},Yt={key:8},Ao=we({__name:"index",setup(k){const B=$(),W=$([]),O=$(),E=$(),e=ce({currentPage:1,pageSize:10,total:0}),Y=$(),Q=[{label:i.global.t("cronjob.monday"),value:1},{label:i.global.t("cronjob.tuesday"),value:2},{label:i.global.t("cronjob.wednesday"),value:3},{label:i.global.t("cronjob.thursday"),value:4},{label:i.global.t("cronjob.friday"),value:5},{label:i.global.t("cronjob.saturday"),value:6},{label:i.global.t("cronjob.sunday"),value:7}],r=async()=>{let p={info:Y.value,page:e.currentPage,pageSize:e.pageSize};B.value=!0,await La(p).then(v=>{B.value=!1,E.value=v.data.items||[];for(const V of E.value)V.targetDir!=="-"&&V.targetDir!==""&&(V.targetDir=i.global.t("setting."+V.targetDir));e.total=v.data.total}).catch(()=>{B.value=!1})},H=$(),T=$(),M=async(p,v={specType:"perMonth",type:"shell",week:1,day:3,hour:1,minute:30,keepLocal:!0,retainCopies:7})=>{let V={title:p,rowData:{...v}};T.value.acceptParams(V)},q=async p=>{let v=[];p?v.push(p.id):W.value.forEach(V=>{v.push(V.id)}),await Wa(qa,{ids:v},"commons.msg.delete"),r()},x=async(p,v)=>{ye.confirm(i.global.t("cronjob."+v+"Msg"),i.global.t("cronjob.changeStatus"),{confirmButtonText:i.global.t("commons.button.confirm"),cancelButtonText:i.global.t("commons.button.cancel")}).then(async()=>{await Ye({id:p,status:v==="enable"?"Enable":"Disable"}),le(i.global.t("commons.msg.operationSuccess")),r()})},ne=async p=>{B.value=!0,await Ze(p.id).then(()=>{B.value=!1,le(i.global.t("commons.msg.operationSuccess")),r()}).catch(()=>{B.value=!1})},se=p=>p.type==="shell"||p.type==="curl"?"-":p.retainCopies+"",R=p=>{O.value=!0;let v={rowData:{...p}};H.value.acceptParams(v)},w=[{label:i.global.t("commons.button.handle"),click:p=>{ne(p)}},{label:i.global.t("commons.button.edit"),click:p=>{M("edit",p)}},{label:i.global.t("cronjob.record"),click:p=>{R(p)}},{label:i.global.t("commons.button.delete"),click:p=>{q(p)}}];function ee(p){for(const v of Q)if(v.value===p)return v.label;return""}return Da(()=>{r()}),(p,v)=>{const V=ge,ae=fe,re=Ke,ue=De,U=ga,s=ie("fu-table-operations"),d=Ge;return n(),y("div",null,[l(Ba,{buttons:[{label:h(i).global.t("cronjob.cronTask"),path:"/cronjobs"}]},null,8,["buttons"]),O.value?m("",!0):ve((n(),f(Xe,{key:0,title:p.$t("cronjob.cronTask")},{toolbar:a(()=>[l(ue,null,{default:a(()=>[l(ae,{span:16},{default:a(()=>[l(V,{type:"primary",onClick:v[0]||(v[0]=u=>M("create"))},{default:a(()=>[g(t(p.$t("commons.button.create"))+t(p.$t("cronjob.cronTask")),1)]),_:1}),l(V,{plain:"",disabled:W.value.length===0,onClick:v[1]||(v[1]=u=>q(null))},{default:a(()=>[g(t(p.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),_:1}),l(ae,{span:8},{default:a(()=>[l(ha,{onSearch:v[2]||(v[2]=u=>r())}),_("div",zt,[l(re,{modelValue:Y.value,"onUpdate:modelValue":v[3]||(v[3]=u=>Y.value=u),clearable:"",onClear:v[4]||(v[4]=u=>r()),"suffix-icon":"Search",onKeyup:v[5]||(v[5]=_a(u=>r(),["enter"])),onBlur:v[6]||(v[6]=u=>r()),placeholder:p.$t("commons.button.search")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),main:a(()=>[l(ka,{"pagination-config":e,selects:W.value,"onUpdate:selects":v[7]||(v[7]=u=>W.value=u),onSearch:r,data:E.value},{default:a(()=>[l(U,{type:"selection",fix:""}),l(U,{label:p.$t("cronjob.taskName"),"min-width":120,prop:"name"},{default:a(({row:u})=>[l($a,{onClick:o=>R(u),text:u.name},null,8,["onClick","text"])]),_:1},8,["label"]),l(U,{label:p.$t("commons.table.status"),"min-width":80,prop:"status"},{default:a(({row:u})=>[u.status==="Enable"?(n(),f(V,{key:0,onClick:o=>x(u.id,"disable"),link:"",type:"success"},{default:a(()=>[g(t(p.$t("commons.status.enabled")),1)]),_:2},1032,["onClick"])):(n(),f(V,{key:1,link:"",type:"danger",onClick:o=>x(u.id,"enable")},{default:a(()=>[g(t(p.$t("commons.status.disabled")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),l(U,{label:p.$t("cronjob.cronSpec"),"min-width":120},{default:a(({row:u})=>[u.specType.indexOf("N")===-1||u.specType==="perWeek"?(n(),y("span",Ot,t(p.$t("cronjob."+u.specType)),1)):(n(),y("span",qt,t(p.$t("cronjob.per")),1)),u.specType==="perMonth"?(n(),y("span",At,t(u.day)+t(p.$t("cronjob.day"))+" "+t(h(C)(u.hour))+" : "+t(h(C)(u.minute)),1)):m("",!0),u.specType==="perWeek"?(n(),y("span",Pt,t(ee(u.week))+" "+t(h(C)(u.hour))+" : "+t(h(C)(u.minute)),1)):m("",!0),u.specType==="perDay"?(n(),y("span",Ft,t(h(C)(u.hour))+" : "+t(h(C)(u.minute)),1)):m("",!0),u.specType==="perNDay"?(n(),y("span",Kt,t(u.day)+" "+t(p.$t("cronjob.day1"))+", "+t(h(C)(u.hour))+" : "+t(h(C)(u.minute)),1)):m("",!0),u.specType==="perNHour"?(n(),y("span",Gt,t(u.hour)+t(p.$t("cronjob.hour"))+", "+t(h(C)(u.minute)),1)):m("",!0),u.specType==="perHour"?(n(),y("span",Xt,t(h(C)(u.minute)),1)):m("",!0),u.specType==="perNMinute"?(n(),y("span",Yt,t(u.minute)+t(p.$t("cronjob.minute")),1)):m("",!0),g(" "+t(p.$t("cronjob.handle")),1)]),_:1},8,["label"]),l(U,{label:p.$t("cronjob.retainCopies"),"min-width":90,prop:"retainCopies"},{default:a(({row:u})=>[g(t(se(u)),1)]),_:1},8,["label"]),l(U,{label:p.$t("cronjob.lastRecrodTime"),"min-width":120,prop:"lastRecrodTime"},{default:a(({row:u})=>[g(t(u.lastRecrodTime),1)]),_:1},8,["label"]),l(U,{"min-width":80,label:p.$t("cronjob.target"),prop:"targetDir"},{default:a(({row:u})=>[g(t(u.targetDir),1)]),_:1},8,["label"]),l(s,{width:"200px",buttons:w,ellipsis:10,label:p.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title"])),[[d,B.value]]),l(Xa,{onSearch:r,ref_key:"dialogRef",ref:T},null,512),l(Lt,{onSearch:v[8]||(v[8]=u=>r()),ref_key:"dialogRecordRef",ref:H},null,512)])}}});export{Ao as default};
