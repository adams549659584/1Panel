import{_ as Ce,d as ne,x as K,r as c,b as N,h as M,e,w as a,f as s,t as l,O as J,ac as Re,a2 as de,m as ue,a3 as pe,q as Se,s as Ve,j as f,X as Pe,g as b,F as Ne,i as Ie,y as oe,$ as W,aK as De,l as fe,au as Fe,av as Ee,J as Be,A as ce,C as ge,a1 as be,aq as Ue,ax as Te,Y as ae,aJ as re,c as le,n as _e,ah as $e,a5 as ve,af as xe,a as Ae,ai as He,ao as Me,ab as Le,a6 as qe,V as je}from"./index-9eeac04e.js";/* empty css                *//* empty css               *//* empty css                *//* empty css              *//* empty css             *//* empty css             *//* empty css               */import{_ as ke}from"./layout-content-27c09564.js";/* empty css             */import"./form-item-d76e7d20.js";/* empty css              *//* empty css            */import{j as ze,o as Oe,T as Ge}from"./index-b02b032a.js";import{L as Je}from"./files-d9eb6d1f.js";import{_ as ee}from"./index-8a66c1e6.js";/* empty css                    */import{m as We,n as he,r as Ke,o as Xe,p as Ye,q as Qe,t as Ze}from"./database-a10f2df4.js";/* empty css                     *//* empty css                 *//* empty css            *//* empty css                    *//* empty css              *//* empty css               */import{_ as ea}from"./index-8d9ad139.js";import{s as aa,h as ta,a as sa,b as oa,l as la}from"./setting-f1c3ee2a.js";import{R as G,c as me}from"./form-rules-028b05ac.js";import{b as na}from"./util-cbaccc93.js";import{u as ia}from"./use-delete-data-8b6821a4.js";import{l as ra,m as da,k as ua,n as pa}from"./app-b908b206.js";import{_ as ca}from"./index-bb4c3e65.js";import{T as ma}from"./index-5896e1bd.js";import{_ as _a}from"./index-38d41e83.js";import"./index-5ffc91ba.js";import"./base64-e52cbffd.js";/* empty css             */import"./no_app-68a0aee4.js";import"./index-167a1d38.js";const B=q=>(Se("data-v-810b325c"),q=q(),Ve(),q),fa={key:0},ba={class:"title"},va=B(()=>s("span",{class:"status-label"},"uptime_in_days",-1)),ya={class:"status-count"},ha={class:"input-help"},ga=B(()=>s("span",{class:"status-label"},"tcp_port",-1)),$a={class:"status-count"},ka={class:"input-help"},wa=B(()=>s("span",{class:"status-label"},"connected_clients",-1)),Ca={class:"status-count"},Ra={class:"input-help"},Sa={class:"title"},Va=B(()=>s("span",{class:"status-label"},"used_memory_rss",-1)),Pa={class:"status-count"},Na={class:"input-help"},Ia=B(()=>s("span",{class:"status-label"},"used_memory",-1)),Da={class:"status-count"},Fa={class:"input-help"},Ea=B(()=>s("span",{class:"status-label"},"mem_fragmentation_ratio",-1)),Ba={class:"status-count"},Ua={class:"input-help"},Ta=B(()=>s("span",{class:"status-label"},"total_connections_received",-1)),xa={class:"status-count"},Aa={class:"input-help"},Ha=B(()=>s("span",{class:"status-label"},"total_commands_processed",-1)),Ma={class:"status-count"},La={class:"input-help"},qa=B(()=>s("span",{class:"status-label"},"instantaneous_ops_per_sec",-1)),ja={class:"status-count"},za={class:"input-help"},Oa=B(()=>s("span",{class:"status-label"},"keyspace_hits",-1)),Ga={class:"status-count"},Ja={class:"input-help"},Wa=B(()=>s("span",{class:"status-label"},"keyspace_misses",-1)),Ka={class:"status-count"},Xa={class:"input-help"},Ya=B(()=>s("span",{class:"status-label"},"hit",-1)),Qa={class:"status-count"},Za={class:"input-help"},et=B(()=>s("span",{class:"status-label"},"latest_fork_usec",-1)),at={class:"status-count"},tt={class:"input-help"},st=ne({__name:"index",setup(q,{expose:U}){const r=K({tcp_port:"",uptime_in_days:"",connected_clients:"",used_memory:"",used_memory_rss:"",used_memory_peak:"",mem_fragmentation_ratio:"",total_connections_received:"",total_commands_processed:"",instantaneous_ops_per_sec:"",keyspace_hits:"",keyspace_misses:"",hit:"",latest_fork_usec:""}),d=c(!1),k=t=>{d.value=!0,t.status==="Running"&&h()},h=async()=>{const t=await We();let R=(Number(t.data.keyspace_hits)/(Number(t.data.keyspace_hits)+Number(t.data.keyspace_misses))*100).toFixed(2);r.uptime_in_days=t.data.uptime_in_days,r.tcp_port=t.data.tcp_port,r.connected_clients=t.data.connected_clients,r.used_memory_rss=(Number(t.data.used_memory_rss)/1024/1024).toFixed(2)+" MB",r.used_memory=(Number(t.data.used_memory)/1024/1024).toFixed(2)+" MB",r.mem_fragmentation_ratio=t.data.mem_fragmentation_ratio,r.total_connections_received=t.data.total_connections_received,r.total_commands_processed=t.data.total_commands_processed,r.instantaneous_ops_per_sec=t.data.instantaneous_ops_per_sec,r.keyspace_hits=t.data.keyspace_hits,r.keyspace_misses=t.data.keyspace_misses,r.hit=R,r.latest_fork_usec=t.data.latest_fork_usec};return U({acceptParams:k}),(t,R)=>{const v=Re,_=de,P=ue,S=pe;return d.value?(N(),M("div",fa,[e(S,{"label-position":"top"},{default:a(()=>[s("span",ba,l(t.$t("database.baseParam")),1),e(v,{class:"devider"}),e(P,{type:"flex",style:{"margin-left":"50px"},justify:"center"},{default:a(()=>[e(_,{style:{width:"25%"}},{label:a(()=>[va]),default:a(()=>[s("span",ya,l(r.uptime_in_days),1),s("span",ha,l(t.$t("database.uptimeInDays")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[ga]),default:a(()=>[s("span",$a,l(r.tcp_port),1),s("span",ka,l(t.$t("database.tcpPort")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[wa]),default:a(()=>[s("span",Ca,l(r.connected_clients),1),s("span",Ra,l(t.$t("database.connectedClients")),1)]),_:1}),e(_,{style:{width:"25%"}})]),_:1}),s("span",Sa,l(t.$t("database.performanceParam")),1),e(v,{class:"devider"}),e(P,{type:"flex",style:{"margin-left":"50px"},justify:"center"},{default:a(()=>[e(_,{style:{width:"25%"}},{label:a(()=>[Va]),default:a(()=>[s("span",Pa,l(r.used_memory_rss),1),s("span",Na,l(t.$t("database.usedMemoryRss")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Ia]),default:a(()=>[s("span",Da,l(r.used_memory),1),s("span",Fa,l(t.$t("database.usedMemory")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Ea]),default:a(()=>[s("span",Ba,l(r.mem_fragmentation_ratio),1),s("span",Ua,l(t.$t("database.tmpTableToDBHelper")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Ta]),default:a(()=>[s("span",xa,l(r.total_connections_received),1),s("span",Aa,l(t.$t("database.totalConnectionsReceived")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Ha]),default:a(()=>[s("span",Ma,l(r.total_commands_processed),1),s("span",La,l(t.$t("database.totalCommandsProcessed")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[qa]),default:a(()=>[s("span",ja,l(r.instantaneous_ops_per_sec),1),s("span",za,l(t.$t("database.instantaneousOpsPerSec")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Oa]),default:a(()=>[s("span",Ga,l(r.keyspace_hits),1),s("span",Ja,l(t.$t("database.keyspaceHits")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Wa]),default:a(()=>[s("span",Ka,l(r.keyspace_misses),1),s("span",Xa,l(t.$t("database.keyspaceMisses")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[Ya]),default:a(()=>[s("span",Qa,l(r.hit),1),s("span",Za,l(t.$t("database.hit")),1)]),_:1}),e(_,{style:{width:"25%"}},{label:a(()=>[et]),default:a(()=>[s("span",at,l(r.latest_fork_usec),1),s("span",tt,l(t.$t("database.latestForkUsec")),1)]),_:1}),e(_,{style:{width:"25%"}}),e(_,{style:{width:"25%"}})]),_:1})]),_:1})])):J("",!0)}}});var ot=Ce(st,[["__scopeId","data-v-810b325c"]]);const lt={key:0},nt={class:"card-header"},it=s("br",null,null,-1),rt={class:"card-header"},dt={style:{width:"100%"},class:"tab-table"},ut={width:"32%"},pt={width:"80px"},ct={width:"32%"},mt={width:"10%"},_t={align:"left"},ft={style:{"margin-left":"2px","margin-top":"5px"}},bt={key:0},vt=ne({__name:"index",emits:["loading"],setup(q,{expose:U,emit:r}){const d=K({appendonly:"",appendfsync:"no",saves:[]}),k=K({appendonly:[G.requiredSelect],appendfsync:[G.requiredSelect]}),h=c(),t=c(!1),R=i=>{t.value=!0,i.status==="Running"&&(x(),V())},v=c(),_=c([]),P=c(),S=c(),w=K({currentPage:1,pageSize:10,total:0}),g=()=>{let i={second:0,count:0};d.saves.push(i)},C=i=>{d.saves.splice(i,1)},V=async()=>{let i={type:"redis",name:"",detailName:"",page:w.currentPage,pageSize:w.pageSize};const n=await aa(i);v.value=n.data.items||[],w.total=n.data.total},j=async()=>{r("loading",!0),await ta({name:"",detailName:"",type:"redis"}).then(()=>{r("loading",!1),V(),W(f.global.t("commons.msg.operationSuccess"))}).catch(()=>{r("loading",!1)})},L=async()=>{let i={type:"redis",name:"",detailName:"",file:P.value.fileDir+"/"+P.value.fileName};r("loading",!0),await sa(i).then(()=>{r("loading",!1),W(f.global.t("commons.msg.operationSuccess"))}).catch(()=>{r("loading",!1)})},T=async i=>{let n=[];i?n.push(i.id):_.value.forEach(m=>{n.push(m.id)}),await ia(oa,{ids:n},"commons.msg.delete"),V()},z=[{label:f.global.t("commons.button.recover"),click:i=>{P.value=i;let n={header:f.global.t("commons.button.recover"),operationInfo:f.global.t("database.recoverHelper",[i.fileName]),submitInputInfo:f.global.t("database.submitIt")};S.value.acceptParams(n)}},{label:f.global.t("commons.button.delete"),click:i=>{T(i)}}],O=async(i,n)=>{let m={};if(n=="aof"){if(!i)return;i.validate(async y=>{!y||(m.type=n,m.appendfsync=d.appendfsync,m.appendonly=d.appendonly,r("loading",!0),await he(m).then(()=>{r("loading",!1),W(f.global.t("commons.msg.operationSuccess"))}).catch(()=>{r("loading",!1)}))});return}let D=[];for(const y of d.saves){if(y.count<0||y.count>1e5||y.second<0||y.second>1e5){De(f.global.t("database.rdbInfo"));return}D.push(y.second+"",y.count+"")}m.type=n,m.save=D.join(" "),r("loading",!0),await he(m).then(()=>{r("loading",!1),W(f.global.t("commons.msg.operationSuccess"))}).catch(()=>{r("loading",!1)})},x=async()=>{var m,D,y;d.saves=[];const i=await Ke();d.appendonly=(m=i.data)==null?void 0:m.appendonly,d.appendfsync=(D=i.data)==null?void 0:D.appendfsync;let n=(y=i.data)==null?void 0:y.save.split(" ");for(let F=0;F<n.length;F++)F%2===1&&d.saves.push({second:Number(n[F-1]),count:Number(n[F])})};return U({acceptParams:R}),(i,n)=>{const m=fe,D=Fe,y=de,F=Ee,te=Be,A=ce,X=pe,I=ue,Y=ge,se=be,o=Ue,u=Pe("fu-table-operations");return t.value?(N(),M("div",lt,[e(I,{gutter:20,style:{"margin-top":"5px"},class:"row-box"},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(Y,{class:"el-card"},{header:a(()=>[s("div",nt,[s("span",null,"AOF "+l(i.$t("database.persistence")),1)])]),default:a(()=>[e(X,{model:d,ref_key:"formRef",ref:h,rules:k,"label-width":"120px"},{default:a(()=>[e(I,null,{default:a(()=>[e(m,{span:1},{default:a(()=>[it]),_:1}),e(X,null,{default:a(()=>[e(y,{label:"appendonly",prop:"appendonly"},{default:a(()=>[e(D,{"active-value":"yes","inactive-value":"no",modelValue:d.appendonly,"onUpdate:modelValue":n[0]||(n[0]=p=>d.appendonly=p)},null,8,["modelValue"])]),_:1}),e(y,{label:"appendfsync",prop:"appendfsync"},{default:a(()=>[e(te,{style:{width:"100%"},modelValue:d.appendfsync,"onUpdate:modelValue":n[1]||(n[1]=p=>d.appendfsync=p)},{default:a(()=>[e(F,{label:"always"},{default:a(()=>[b("always")]),_:1}),e(F,{label:"everysec"},{default:a(()=>[b("everysec")]),_:1}),e(F,{label:"no"},{default:a(()=>[b("no")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(y,null,{default:a(()=>[e(A,{type:"primary",onClick:n[2]||(n[2]=p=>O(h.value,"aof"))},{default:a(()=>[b(l(i.$t("commons.button.save")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(Y,{class:"el-card"},{header:a(()=>[s("div",rt,[s("span",null,"RDB "+l(i.$t("database.persistence")),1)])]),default:a(()=>[s("table",dt,[(N(!0),M(Ne,null,Ie(d.saves,(p,H)=>(N(),M("tr",{key:H},[s("td",ut,[e(se,{type:"number",modelValue:p.second,"onUpdate:modelValue":E=>p.second=E},null,8,["modelValue","onUpdate:modelValue"])]),s("td",pt,l(i.$t("database.rdbHelper1")),1),s("td",ct,[e(se,{type:"number",modelValue:p.count,"onUpdate:modelValue":E=>p.count=E},null,8,["modelValue","onUpdate:modelValue"])]),s("td",mt,l(i.$t("database.rdbHelper2")),1),s("td",null,[e(A,{link:"",type:"primary",style:{"font-size":"10px"},onClick:E=>C(H)},{default:a(()=>[b(l(i.$t("commons.button.delete")),1)]),_:2},1032,["onClick"])])]))),128)),s("tr",null,[s("td",_t,[e(A,{onClick:n[3]||(n[3]=p=>g())},{default:a(()=>[b(l(i.$t("commons.button.add")),1)]),_:1})])])]),s("div",null,[s("span",ft,l(i.$t("database.rdbHelper3")),1)]),e(A,{type:"primary",onClick:n[4]||(n[4]=p=>O(void 0,"rbd")),style:{"margin-top":"10px"}},{default:a(()=>[b(l(i.$t("commons.button.save")),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(Y,{style:{"margin-top":"20px"}},{default:a(()=>[e(ea,{"pagination-config":w,selects:_.value,"onUpdate:selects":n[6]||(n[6]=p=>_.value=p),onSearch:V,data:v.value},{toolbar:a(()=>[e(A,{type:"primary",onClick:j},{default:a(()=>[b(l(i.$t("setting.backup")),1)]),_:1}),e(A,{type:"primary",plain:"",disabled:_.value.length===0,onClick:n[5]||(n[5]=p=>T(null))},{default:a(()=>[b(l(i.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),default:a(()=>[e(o,{type:"selection",fix:""}),e(o,{label:i.$t("commons.table.name"),"show-overflow-tooltip":"",prop:"fileName"},null,8,["label"]),e(o,{label:i.$t("database.source"),prop:"backupType"},{default:a(({row:p})=>[p.source?(N(),M("span",bt,l(i.$t("setting."+p.source)),1)):J("",!0)]),_:1},8,["label"]),e(o,{label:i.$t("file.dir"),"show-overflow-tooltip":"",prop:"fileDir"},null,8,["label"]),e(o,{label:i.$t("commons.table.createdAt"),formatter:oe(na),prop:"createdAt"},null,8,["label","formatter"]),e(u,{width:"300px",buttons:z,ellipsis:10,label:i.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1}),e(ee,{ref_key:"confirmDialogRef",ref:S,onConfirm:L},null,512)])):J("",!0)}}}),yt={key:0},ht={key:1},gt=s("br",null,null,-1),$t={class:"input-help"},kt={class:"input-help"},wt={key:2},Ct=s("br",null,null,-1),Rt=ne({__name:"index",setup(q,{expose:U}){const r=[ze(),Oe],d=c(!1),k=Te(),h=o=>{k.value=o.view},t=K({name:"",port:6379,timeout:0,maxclients:0,maxmemory:0}),R=K({port:[G.port],timeout:[G.number,me(0,9999999)],maxclients:[G.number,me(1,65504)],maxmemory:[G.number,me(0,999999)]}),v=c("conf"),_=c(),P=c(),S=c(!1),w=c(),g=c(),C=c(),V=c(),j=c(),L=c(!1),T=o=>{switch(v.value=o,o){case"conf":se();break;case"persistence":P.value.acceptParams({status:w.value});break;case"tuning":case"port":Y();break;case"status":_.value.acceptParams({status:w.value});break}},z=o=>{d.value=o},O=o=>{w.value=o.status,g.value=o.redisName,L.value=!0,se()},x=c(),i=c(),n=async o=>{if(!o||!await o.validateField("port",m))return;let p={header:f.global.t("database.confChange"),operationInfo:f.global.t("database.restartNowHelper"),submitInputInfo:f.global.t("database.restartNow")};i.value.acceptParams(p)};function m(o){if(o)return o.message}const D=async o=>{if(!o||!await o.validateField("port",m))return;let p={key:"redis",name:t.name,port:t.port};d.value=!0,await ra(p).then(()=>{d.value=!1,W(f.global.t("commons.msg.operationSuccess"))}).finally(()=>{d.value=!1})},y=c(),F=async o=>{!o||o.validate(async u=>{if(!u)return;let p={header:f.global.t("database.confChange"),operationInfo:f.global.t("database.restartNowHelper"),submitInputInfo:f.global.t("database.restartNow")};y.value.acceptParams(p)})},te=async()=>{let o={timeout:t.timeout+"",maxclients:t.maxclients+"",maxmemory:t.maxmemory+"mb"};d.value=!0,await Xe(o).then(()=>{Y(),d.value=!1,W(f.global.t("commons.msg.operationSuccess"))}).finally(()=>{d.value=!1})},A=async()=>{d.value=!0;const o=await da("redis");V.value=o.data,S.value=!0,d.value=!1},X=async()=>{let o={header:f.global.t("database.confChange"),operationInfo:f.global.t("database.restartNowHelper1"),submitInputInfo:f.global.t("database.restartNow")};j.value.acceptParams(o)},I=async()=>{let o={file:V.value,restartNow:!0};d.value=!0,await Ye(o).then(()=>{S.value=!1,d.value=!1,W(f.global.t("commons.msg.operationSuccess"))}).catch(()=>{d.value=!0})},Y=async()=>{var u,p,H,E,Q;const o=await Qe();t.name=(u=o.data)==null?void 0:u.name,t.timeout=Number((p=o.data)==null?void 0:p.timeout),t.maxclients=Number((H=o.data)==null?void 0:H.maxclients),t.maxmemory=Number((E=o.data)==null?void 0:E.maxmemory.replaceAll("mb",""))/1048576,t.port=Number((Q=o.data)==null?void 0:Q.port)},se=async()=>{let u=`${(await la()).data}/apps/redis/${g.value}/conf/redis.conf`;S.value=!1,d.value=!0,await Je({path:u}).then(p=>{d.value=!1,V.value=p.data,_e(()=>{const H=k.value.state;k.value.dispatch({selection:{anchor:H.doc.length,head:H.doc.length},scrollIntoView:!0})})}).catch(()=>{d.value=!1})};return U({acceptParams:O}),(o,u)=>{const p=ce,H=$e,E=fe,Q=ue,ie=be,Z=de,ye=pe,we=ve;return ae((N(),M("div",null,[e(ke,{title:"Redis "+o.$t("database.setting"),reload:!0},{buttons:a(()=>[e(p,{type:"primary",plain:v.value!=="conf",onClick:u[0]||(u[0]=$=>T("conf"))},{default:a(()=>[b(l(o.$t("database.confChange")),1)]),_:1},8,["plain"]),e(p,{type:"primary",disabled:w.value!=="Running",plain:v.value!=="status",onClick:u[1]||(u[1]=$=>T("status"))},{default:a(()=>[b(l(o.$t("database.status")),1)]),_:1},8,["disabled","plain"]),e(p,{type:"primary",disabled:w.value!=="Running",plain:v.value!=="tuning",onClick:u[2]||(u[2]=$=>T("tuning"))},{default:a(()=>[b(l(o.$t("database.performanceTuning")),1)]),_:1},8,["disabled","plain"]),e(p,{type:"primary",plain:v.value!=="port",onClick:u[3]||(u[3]=$=>T("port"))},{default:a(()=>[b(l(o.$t("database.portSetting")),1)]),_:1},8,["plain"]),e(p,{type:"primary",disabled:w.value!=="Running",plain:v.value!=="persistence",onClick:u[4]||(u[4]=$=>T("persistence"))},{default:a(()=>[b(l(o.$t("database.persistence")),1)]),_:1},8,["disabled","plain"])]),main:a(()=>[v.value==="conf"?(N(),M("div",yt,[e(oe(Ge),{autofocus:!0,placeholder:"None data","indent-with-tab":!0,tabSize:4,style:{"margin-top":"10px",height:"calc(100vh - 380px)"},lineWrapping:!0,matchBrackets:!0,theme:"cobalt",styleActiveLine:!0,extensions:r,onReady:h,modelValue:V.value,"onUpdate:modelValue":u[5]||(u[5]=$=>V.value=$)},null,8,["modelValue"]),e(p,{style:{"margin-top":"10px"},onClick:u[6]||(u[6]=$=>A())},{default:a(()=>[b(l(o.$t("app.defaultConfig")),1)]),_:1}),e(p,{type:"primary",onClick:X,style:{"margin-top":"10px"}},{default:a(()=>[b(l(o.$t("commons.button.save")),1)]),_:1}),e(Q,null,{default:a(()=>[e(E,{span:8},{default:a(()=>[S.value?(N(),le(H,{key:0,style:{"margin-top":"10px"},title:o.$t("app.defaultConfigHelper"),type:"info",closable:!1},null,8,["title"])):J("",!0)]),_:1})]),_:1})])):J("",!0),ae(e(ot,{ref_key:"statusRef",ref:_},null,512),[[re,v.value==="status"]]),v.value==="tuning"?(N(),M("div",ht,[e(ye,{model:t,ref_key:"formRef",ref:C,rules:R,"label-position":"top"},{default:a(()=>[e(Q,{style:{"margin-top":"20px"}},{default:a(()=>[e(E,{span:1},{default:a(()=>[gt]),_:1}),e(E,{span:10},{default:a(()=>[e(Z,{label:o.$t("database.timeout"),prop:"timeout"},{default:a(()=>[e(ie,{clearable:"",type:"number",modelValue:t.timeout,"onUpdate:modelValue":u[7]||(u[7]=$=>t.timeout=$),modelModifiers:{number:!0}},{append:a(()=>[b(l(o.$t("home.Second")),1)]),_:1},8,["modelValue"]),s("span",$t,l(o.$t("database.timeoutHelper")),1)]),_:1},8,["label"]),e(Z,{label:o.$t("database.maxclients"),prop:"maxclients"},{default:a(()=>[e(ie,{clearable:"",type:"number",modelValue:t.maxclients,"onUpdate:modelValue":u[8]||(u[8]=$=>t.maxclients=$),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"]),e(Z,{label:o.$t("database.maxmemory"),prop:"maxmemory"},{default:a(()=>[e(ie,{clearable:"",type:"number",modelValue:t.maxmemory,"onUpdate:modelValue":u[9]||(u[9]=$=>t.maxmemory=$),modelModifiers:{number:!0}},{append:a(()=>[b("mb")]),_:1},8,["modelValue"]),s("span",kt,l(o.$t("database.maxmemoryHelper")),1)]),_:1},8,["label"]),e(Z,null,{default:a(()=>[e(p,{type:"primary",onClick:u[10]||(u[10]=$=>F(C.value))},{default:a(()=>[b(l(o.$t("commons.button.save")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])):J("",!0),v.value==="port"?(N(),M("div",wt,[e(ye,{model:t,ref_key:"portRef",ref:x,"label-position":"top"},{default:a(()=>[e(Q,null,{default:a(()=>[e(E,{span:1},{default:a(()=>[Ct]),_:1}),e(E,{span:10},{default:a(()=>[e(Z,{label:o.$t("setting.port"),prop:"port",rules:oe(G).port},{default:a(()=>[e(ie,{clearable:"",type:"number",modelValue:t.port,"onUpdate:modelValue":u[11]||(u[11]=$=>t.port=$),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label","rules"]),e(Z,null,{default:a(()=>[e(p,{onClick:u[12]||(u[12]=$=>n(x.value)),icon:"Collection"},{default:a(()=>[b(l(o.$t("commons.button.save")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])):J("",!0),ae(e(vt,{onLoading:z,ref_key:"persistenceRef",ref:P},null,512),[[re,v.value==="persistence"]])]),_:1},8,["title"]),e(ee,{ref_key:"confirmDialogRef",ref:j,onConfirm:I},null,512),e(ee,{ref:"confirmFileRef",onConfirm:I},null,512),e(ee,{ref_key:"confirmFormRef",ref:y,onConfirm:te},null,512),e(ee,{ref_key:"confirmPortRef",ref:i,onConfirm:u[13]||(u[13]=$=>D(x.value))},null,512)])),[[re,L.value],[we,d.value]])}}}),St={class:"dialog-footer"},Vt=ne({__name:"index",emits:["checkExist","closeTerminal"],setup(q,{expose:U,emit:r}){const d=c(!1),k=c(!1),h=K({password:""}),t=c(),R=c(),v=()=>{h.password="",P(),k.value=!0},_=()=>{k.value=!1},P=async()=>{const g=await ua("redis");h.password=g.data},S=async()=>{let g={id:0,value:h.password};d.value=!0,r("closeTerminal"),await Ze(g).then(()=>{d.value=!1,W(f.global.t("commons.msg.operationSuccess")),k.value=!1,r("checkExist")}).catch(()=>{d.value=!1})},w=async g=>{!g||g.validate(async C=>{if(!C)return;let V={header:f.global.t("database.confChange"),operationInfo:f.global.t("database.restartNowHelper"),submitInputInfo:f.global.t("database.restartNow")};t.value.acceptParams(V)})};return U({acceptParams:v}),(g,C)=>{const V=be,j=de,L=fe,T=ue,z=ce,O=xe,x=ve;return N(),le(O,{modelValue:k.value,"onUpdate:modelValue":C[3]||(C[3]=i=>k.value=i),"destroy-on-close":!0,"close-on-click-modal":!1,size:"30%"},{header:a(()=>[e(ca,{header:g.$t("database.requirepass"),back:_},null,8,["header"])]),footer:a(()=>[s("span",St,[e(z,{disabled:d.value,onClick:C[1]||(C[1]=i=>k.value=!1)},{default:a(()=>[b(l(g.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),e(z,{disabled:d.value,type:"primary",onClick:C[2]||(C[2]=i=>w(R.value))},{default:a(()=>[b(l(g.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:a(()=>[ae((N(),le(oe(pe),{ref_key:"formRef",ref:R,model:h,"label-position":"top"},{default:a(()=>[e(T,{type:"flex",justify:"center"},{default:a(()=>[e(L,{span:22},{default:a(()=>[e(j,{label:g.$t("database.requirepass"),rules:oe(G).requiredInput,prop:"password"},{default:a(()=>[e(V,{type:"password","show-password":"",clearable:"",modelValue:h.password,"onUpdate:modelValue":C[0]||(C[0]=i=>h.password=i)},null,8,["modelValue"])]),_:1},8,["label","rules"])]),_:1})]),_:1})]),_:1},8,["model"])),[[x,d.value]]),e(ee,{ref_key:"confirmDialogRef",ref:t,onConfirm:S},null,512)]),_:1},8,["modelValue"])}}}),Pt={class:"dialog-footer"},ms=ne({__name:"index",setup(q){const U=c(!1),r=c(!0),d=c(null),k=c(),h=c(!1),t=c(!1),R=c(),v=c(),_=c(!1),P=c(),S=c(!1),w=c(),g=async()=>{var n;h.value=!0,(n=d.value)==null||n.onClose(!1),_.value=!1,k.value.acceptParams({status:R.value,redisName:v.value})},C=async()=>{if(P.value===0){S.value=!0;return}let m=window.location.href.split("//")[1].split(":")[0];window.open(`http://${m}:${P.value}`,"_blank")},V=n=>{je.push({name:"AppDetail",params:{appKey:n}})},j=async()=>{const n=await pa("redis-commander");P.value=n.data},L=c(),T=async()=>{L.value.acceptParams()},z=n=>{t.value=n.isExist,v.value=n.name,R.value=n.status,U.value=!1,R.value==="Running"&&(j(),_e(()=>{_.value=!0,d.value.acceptParams({endpoint:"/api/v1/databases/redis/exec",args:"",error:""})}))},O=async()=>{R.value==="Running"&&_e(()=>{_.value=!0,d.value.acceptParams({endpoint:"/api/v1/databases/redis/exec",args:"",error:""})})},x=async n=>{var m;w.value=!w.value,(m=d.value)==null||m.onClose(n),_.value=n},i=()=>{x(!0)};return Ae(()=>{x(!1)}),(n,m)=>{const D=ce,y=ge,F=He,te=$e,A=Me,X=ve;return ae((N(),M("div",null,[e(ke,{title:"Redis "+n.$t("menu.database")},Le({app:a(()=>[e(_a,{"app-key":"redis",loading:U.value,"onUpdate:loading":m[0]||(m[0]=I=>U.value=I),"mask-show":r.value,"onUpdate:mask-show":m[1]||(m[1]=I=>r.value=I),onBefore:i,onSetting:g,onIsExist:z},null,8,["loading","mask-show"])]),_:2},[!h.value&&t.value?{name:"toolbar",fn:a(()=>[s("div",{class:qe({mask:R.value!="Running"})},[e(D,{type:"primary",plain:"",onClick:C,icon:"Position"},{default:a(()=>[b("Redis-Commander")]),_:1}),e(D,{type:"primary",plain:"",onClick:T},{default:a(()=>[b(l(n.$t("database.changePassword")),1)]),_:1})],2)]),key:"0"}:void 0,t.value&&!h.value?{name:"main",fn:a(()=>[ae((N(),le(ma,{style:{height:"calc(100vh - 370px)"},key:w.value,ref_key:"terminalRef",ref:d})),[[re,_.value]])]),key:"1"}:void 0]),1032,["title"]),R.value!="Running"&&!h.value&&t.value&&r.value?(N(),le(y,{key:0,class:"mask-prompt"},{default:a(()=>[s("span",null,l(n.$t("commons.service.serviceNotStarted",["Redis"])),1)]),_:1})):J("",!0),e(Rt,{ref_key:"settingRef",ref:k,style:{"margin-top":"30px"}},null,512),e(Vt,{ref_key:"passwordRef",ref:L,onCheckExist:O,onCloseTerminal:m[2]||(m[2]=I=>x(!0))},null,512),e(A,{modelValue:S.value,"onUpdate:modelValue":m[5]||(m[5]=I=>S.value=I),title:n.$t("app.checkTitle"),width:"30%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[s("span",Pt,[e(D,{onClick:m[4]||(m[4]=I=>S.value=!1)},{default:a(()=>[b(l(n.$t("commons.button.cancel")),1)]),_:1})])]),default:a(()=>[e(te,{closable:!1,title:n.$t("app.checkInstalledWarn",["Redis-Commander"]),type:"info"},{default:a(()=>[e(F,{icon:"Position",onClick:m[3]||(m[3]=I=>V("redis-commander")),type:"primary"},{default:a(()=>[b(l(n.$t("database.goInstall")),1)]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue","title"])])),[[X,U.value]])}}});export{ms as default};
