import{d as K,G as Q,r as v,x as L,j as R,Y as q,b as x,h as W,e,w as a,f as N,g as w,t as p,c as A,O as H,U as Z,$ as U,V as M,a1 as ee,a2 as ae,l as oe,m as le,a3 as te,A as se,af as pe,a5 as ne,v as ce,S as fe,aY as we,o as ge,a0 as be,I as ve,J as _e,av as ye,y as V,aJ as J,ap as Ve,X as Y}from"./index-609fd921.js";/* empty css                *//* empty css            *//* empty css              *//* empty css                    *//* empty css                     *//* empty css             */import"./form-item-d76e7d20.js";/* empty css              *//* empty css               */import{_ as Pe}from"./layout-content-47227111.js";import{u as $e,e as Ce,f as X,i as he}from"./setting-34057840.js";import{R as g,c as Te}from"./form-rules-08616160.js";import{_ as Ne}from"./index-110fbc44.js";/* empty css                *//* empty css             */import{b as D}from"./auth-d33d9a76.js";/* empty css                    *//* empty css             */import"./index-e09fb15b.js";import"./util-bdb43d7e.js";import"./base64-e52cbffd.js";/* empty css            */const Se={class:"dialog-footer"},Ue=K({__name:"index",setup(re,{expose:m}){const c=Q(),y=v(),k=L({oldPassword:[g.requiredInput],newPassword:[g.requiredInput,{min:6,message:R.global.t("commons.rule.commonPassword"),trigger:"blur"}],newPasswordComplexity:[g.requiredInput,g.password],retryPassword:[g.requiredInput,{validator:T,trigger:"blur"}]}),P=v(!1),o=v(!1),s=L({oldPassword:"",newPassword:"",newPasswordComplexity:"",retryPassword:""}),$=v(),h=n=>{$.value=n.complexityVerification,s.oldPassword="",s.newPassword="",s.newPasswordComplexity="",s.retryPassword="",o.value=!0};function T(n,i,f){if(($.value==="disable"?s.newPassword:s.newPasswordComplexity)!==s.retryPassword)return f(new Error(R.global.t("commons.rule.rePassword")));f()}const E=async n=>{!n||n.validate(async i=>{if(!i)return;let f=$.value==="disable"?s.newPassword:s.newPasswordComplexity;if(f===s.oldPassword){Z(R.global.t("setting.duplicatePassword"));return}P.value=!0,await $e({oldPassword:s.oldPassword,newPassword:f}).then(async()=>{P.value=!1,o.value=!1,U(R.global.t("commons.msg.operationSuccess")),await D(),M.push({name:"login",params:{code:""}}),c.setLogStatus(!1)}).catch(()=>{P.value=!1})})},S=()=>{o.value=!1};return m({acceptParams:h}),(n,i)=>{const f=ee,b=ae,B=oe,I=le,F=te,l=se,t=pe,d=ne;return q((x(),W("div",null,[e(t,{modelValue:o.value,"onUpdate:modelValue":i[6]||(i[6]=u=>o.value=u),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:a(()=>[e(Ne,{header:n.$t("setting.changePassword"),back:S},null,8,["header"])]),footer:a(()=>[N("span",Se,[e(l,{disabled:P.value,onClick:i[4]||(i[4]=u=>o.value=!1)},{default:a(()=>[w(p(n.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),e(l,{disabled:P.value,type:"primary",onClick:i[5]||(i[5]=u=>E(y.value))},{default:a(()=>[w(p(n.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:a(()=>[e(F,{ref_key:"passFormRef",ref:y,"label-position":"top",model:s,rules:k},{default:a(()=>[e(I,{type:"flex",justify:"center"},{default:a(()=>[e(B,{span:22},{default:a(()=>[e(b,{label:n.$t("setting.oldPassword"),prop:"oldPassword"},{default:a(()=>[e(f,{type:"password","show-password":"",clearable:"",modelValue:s.oldPassword,"onUpdate:modelValue":i[0]||(i[0]=u=>s.oldPassword=u)},null,8,["modelValue"])]),_:1},8,["label"]),$.value==="disable"?(x(),A(b,{key:0,label:n.$t("setting.newPassword"),prop:"newPassword"},{default:a(()=>[e(f,{type:"password","show-password":"",clearable:"",modelValue:s.newPassword,"onUpdate:modelValue":i[1]||(i[1]=u=>s.newPassword=u)},null,8,["modelValue"])]),_:1},8,["label"])):H("",!0),$.value==="enable"?(x(),A(b,{key:1,label:n.$t("setting.newPassword"),prop:"newPasswordComplexity"},{default:a(()=>[e(f,{type:"password","show-password":"",clearable:"",modelValue:s.newPasswordComplexity,"onUpdate:modelValue":i[2]||(i[2]=u=>s.newPasswordComplexity=u)},null,8,["modelValue"])]),_:1},8,["label"])):H("",!0),e(b,{label:n.$t("setting.retryPassword"),prop:"retryPassword"},{default:a(()=>[e(f,{type:"password","show-password":"",clearable:"",modelValue:s.retryPassword,"onUpdate:modelValue":i[3]||(i[3]=u=>s.retryPassword=u)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])),[[d,P.value]])}}}),ke=N("br",null,null,-1),Ee={class:"input-help"},Ie={style:{width:"45px"}},oa=K({__name:"index",setup(re){const m=v(!1),c=ce(),y=Q(),k=fe(()=>y.themeConfig),{switchDark:P}=we(),o=L({userName:"",password:"",email:"",sessionTimeout:0,localTime:"",panelName:"",theme:"",language:"",complexityVerification:"",repoUrl:""}),s=v(),$=v(10),h=v(),T=v(),E=v(),S=async()=>{const l=await Ce();o.userName=l.data.userName,o.password="******",o.sessionTimeout=Number(l.data.sessionTimeout),o.localTime=l.data.localTime,o.panelName=l.data.panelName,o.theme=l.data.theme,o.language=l.data.language,o.complexityVerification=l.data.complexityVerification,o.repoUrl=l.data.repoUrl},n=v(),i=()=>{E.value.acceptParams({complexityVerification:o.complexityVerification})},f=async(l,t,d)=>{!l||!await l.validateField("userName",I)||Ve.confirm(c.t("setting.userChangeHelper"),c.t("setting.userChange"),{confirmButtonText:c.t("commons.button.confirm"),cancelButtonText:c.t("commons.button.cancel"),type:"info"}).then(async()=>{await X({key:t,value:d}).then(async()=>{await D(),m.value=!1,U(c.t("commons.msg.operationSuccess")),M.push({name:"login",params:{code:""}}),y.setLogStatus(!1)}).catch(()=>{m.value=!1})})},b=async(l,t,d)=>{if(!l||!await l.validateField(t.replace(t[0],t[0].toLowerCase()),I)||d==="")return;switch(m.value=!0,t){case"Language":c.locale.value=d,y.updateLanguage(d);break;case"Theme":y.setThemeConfig({...k.value,theme:d}),P();break;case"SessionTimeout":if(Number(d)<300){m.value=!1,Z(c.t("setting.sessionTimeoutError")),S();return}break;case"PanelName":y.setThemeConfig({...k.value,panelName:d}),document.title=d;break;case"MonitorStoreDays":case"ServerPort":d=d+"";break}let _={key:t,value:d+""};await X(_).then(async()=>{if(_.key==="UserName"){await D(),m.value=!1,U(c.t("commons.msg.operationSuccess")),M.push({name:"login",params:{code:""}}),y.setLogStatus(!1);return}_.key==="Language"&&location.reload(),m.value=!1,U(c.t("commons.msg.operationSuccess")),S()}).catch(()=>{m.value=!1})};function B(){h.value=$.value,T.value=!0,s.value=setInterval(()=>{h.value>0&&h.value<=$.value?h.value--:(T.value=!1,clearInterval(s.value),s.value=null)},1e3)}function I(l){if(l)return l.message}const F=async()=>{m.value=!0,await he().then(l=>{m.value=!1,o.localTime=l.data,B(),U(c.t("commons.msg.operationSuccess"))}).catch(()=>{m.value=!1})};return ge(()=>{S()}),(l,t)=>{const d=oe,u=se,_=ee,C=ae,ue=Y("Sunny"),G=be,O=ve,ie=Y("Moon"),j=_e,z=ye,de=le,me=ne;return q((x(),W("div",null,[e(Pe,{title:l.$t("setting.panel"),divider:!0},{main:a(()=>[e(V(te),{model:o,ref_key:"panelFormRef",ref:n,"label-position":"left","label-width":"160px"},{default:a(()=>[e(de,null,{default:a(()=>[e(d,{span:1},{default:a(()=>[ke]),_:1}),e(d,{span:10},{default:a(()=>[e(C,{label:l.$t("setting.user"),rules:V(g).userName,prop:"userName"},{default:a(()=>[e(_,{clearable:"",modelValue:o.userName,"onUpdate:modelValue":t[1]||(t[1]=r=>o.userName=r)},{append:a(()=>[e(u,{style:{width:"85px"},onClick:t[0]||(t[0]=r=>f(n.value,"UserName",o.userName)),icon:"Collection"},{default:a(()=>[w(p(l.$t("commons.button.save")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(C,{label:l.$t("setting.passwd"),rules:V(g).requiredInput,prop:"password"},{default:a(()=>[e(_,{type:"password",clearable:"",disabled:"",modelValue:o.password,"onUpdate:modelValue":t[2]||(t[2]=r=>o.password=r)},{append:a(()=>[e(u,{style:{width:"85px"},icon:"Setting",onClick:i},{default:a(()=>[w(p(l.$t("commons.button.set")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(C,{label:l.$t("setting.theme"),rules:V(g).requiredSelect,prop:"theme"},{default:a(()=>[e(j,{onChange:t[3]||(t[3]=r=>b(n.value,"Theme",o.theme)),modelValue:o.theme,"onUpdate:modelValue":t[4]||(t[4]=r=>o.theme=r)},{default:a(()=>[e(O,{label:"light"},{default:a(()=>[e(G,null,{default:a(()=>[e(ue)]),_:1}),w(" "+p(l.$t("setting.light")),1)]),_:1}),e(O,{label:"dark"},{default:a(()=>[e(G,null,{default:a(()=>[e(ie)]),_:1}),w(" "+p(l.$t("setting.dark")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(C,{label:l.$t("setting.title"),rules:V(g).requiredInput,prop:"panelName"},{default:a(()=>[e(_,{clearable:"",modelValue:o.panelName,"onUpdate:modelValue":t[6]||(t[6]=r=>o.panelName=r)},{append:a(()=>[e(u,{style:{width:"85px"},onClick:t[5]||(t[5]=r=>b(n.value,"PanelName",o.panelName)),icon:"Collection"},{default:a(()=>[w(p(l.$t("commons.button.save")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(C,{label:l.$t("setting.language"),rules:V(g).requiredSelect,prop:"language"},{default:a(()=>[e(j,{style:{width:"100%"},onChange:t[7]||(t[7]=r=>b(n.value,"Language",o.language)),modelValue:o.language,"onUpdate:modelValue":t[8]||(t[8]=r=>o.language=r)},{default:a(()=>[e(z,{label:"zh"},{default:a(()=>[w("\u4E2D\u6587")]),_:1}),e(z,{label:"en"},{default:a(()=>[w("English")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),e(C,{label:l.$t("setting.sessionTimeout"),rules:[V(g).integerNumber,V(Te)(300,864e3)],prop:"sessionTimeout"},{default:a(()=>[e(_,{modelValue:o.sessionTimeout,"onUpdate:modelValue":t[10]||(t[10]=r=>o.sessionTimeout=r),modelModifiers:{number:!0}},{append:a(()=>[e(u,{style:{width:"85px"},onClick:t[9]||(t[9]=r=>b(n.value,"SessionTimeout",o.sessionTimeout)),icon:"Collection"},{default:a(()=>[w(p(l.$t("commons.button.save")),1)]),_:1})]),_:1},8,["modelValue"]),N("div",null,[N("span",Ee,p(l.$t("setting.sessionTimeoutHelper",[o.sessionTimeout])),1)])]),_:1},8,["label","rules"]),e(C,{label:l.$t("setting.syncTime")},{default:a(()=>[e(_,{disabled:"",modelValue:o.localTime,"onUpdate:modelValue":t[11]||(t[11]=r=>o.localTime=r)},{append:a(()=>[q(e(u,{style:{width:"85px"},onClick:F,icon:"Refresh"},{default:a(()=>[w(p(l.$t("commons.button.sync")),1)]),_:1},512),[[J,!T.value]]),q(N("div",Ie,[N("span",null,p(h.value)+" "+p(l.$t("setting.second")),1)],512),[[J,T.value]])]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(C,{label:l.$t("setting.repoUrl"),rules:V(g).requiredInput,prop:"repoUrl"},{default:a(()=>[e(_,{clearable:"",modelValue:o.repoUrl,"onUpdate:modelValue":t[13]||(t[13]=r=>o.repoUrl=r)},{append:a(()=>[e(u,{style:{width:"85px"},onClick:t[12]||(t[12]=r=>b(n.value,"RepoUrl",o.repoUrl)),icon:"Collection"},{default:a(()=>[w(p(l.$t("commons.button.save")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]),e(Ue,{ref_key:"passwordRef",ref:E},null,512)])),[[me,m.value]])}}});export{oa as default};
