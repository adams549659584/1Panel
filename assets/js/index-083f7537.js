import{d as O,r as d,x as H,b as w,c as T,w as l,e as t,f as k,g as y,t as p,Y as M,h as I,y as X,a3 as Y,j as r,U as Q,$ as U,a1 as F,a2 as W,av as Z,J as ee,l as q,m as A,A as j,af as ae,a5 as K,o as te,C as le,aq as oe,O as se,ae as ne,a6 as re,ap as N,X as ie}from"./index-9eeac04e.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css            *//* empty css            *//* empty css              *//* empty css               *//* empty css             */import{_ as ue}from"./index-8d9ad139.js";import{_ as de}from"./index-bb4c3e65.js";/* empty css                *//* empty css                    *//* empty css              */import"./form-item-d76e7d20.js";import{R as pe}from"./form-rules-028b05ac.js";import{q as me,r as x,l as ce,m as fe}from"./host-190478f5.js";import{e as ve,n as ge}from"./util-cbaccc93.js";import{_ as _e,a as be}from"./index-e0f0ac3b.js";import{T as we}from"./index-2dd05578.js";import{_ as ye}from"./layout-content-27c09564.js";/* empty css                    */import"./index-5ffc91ba.js";import"./base64-e52cbffd.js";import"./index-913c5065.js";/* empty css                     *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css               */const $e={class:"input-help"},he={class:"input-help"},ke={class:"input-help"},De={class:"dialog-footer"},Re=O({__name:"index",emits:["search"],setup(G,{expose:i,emit:V}){const c=d(),$=d(),D=d(""),m=d(!1),o=d({title:""}),R=n=>{o.value=n,o.value.title==="edit"&&($.value=ve(n.rowData)),D.value=r.global.t("commons.button."+o.value.title),m.value=!0},h=()=>{m.value=!1},f=H({address:[pe.requiredInput]}),S=d(),E=async n=>{!n||n.validate(async u=>{if(!u||(o.value.rowData.operation="add",!o.value.rowData))return;let g=[];o.value.rowData.address.indexOf("-")!==-1?g=o.value.rowData.address.split("-"):o.value.rowData.address.indexOf(",")!==-1?g=o.value.rowData.address.split(","):o.value.rowData.address.indexOf("/")!==-1?g.push(o.value.rowData.address.split("/")[0]):g.push(o.value.rowData.address);for(const a of g)if(ge(a)){Q(r.global.t("firewall.addressFormatError"));return}if(c.value=!0,o.value.title==="create"){await me(o.value.rowData).then(()=>{c.value=!1,U(r.global.t("commons.msg.operationSuccess")),V("search"),m.value=!1}).catch(()=>{c.value=!1});return}$.value.operation="remove",o.value.rowData.operation="add",await x({oldRule:$.value,newRule:o.value.rowData}).then(()=>{c.value=!1,U(r.global.t("commons.msg.operationSuccess")),V("search"),m.value=!1}).catch(()=>{c.value=!1})})};return i({acceptParams:R}),(n,u)=>{const g=F,a=W,e=Z,v=ee,b=q,B=A,P=j,z=ae,C=K;return w(),T(z,{modelValue:m.value,"onUpdate:modelValue":u[4]||(u[4]=_=>m.value=_),"destroy-on-close":!0,"close-on-click-modal":!1,size:"50%"},{header:l(()=>[t(de,{header:n.$t("firewall.ipRule"),back:h},null,8,["header"])]),footer:l(()=>[k("span",De,[t(P,{onClick:u[2]||(u[2]=_=>m.value=!1)},{default:l(()=>[y(p(n.$t("commons.button.cancel")),1)]),_:1}),t(P,{type:"primary",onClick:u[3]||(u[3]=_=>E(S.value))},{default:l(()=>[y(p(n.$t("commons.button.confirm")),1)]),_:1})])]),default:l(()=>[M((w(),I("div",null,[t(X(Y),{ref_key:"formRef",ref:S,"label-position":"top",model:o.value.rowData,rules:f},{default:l(()=>[t(B,{type:"flex",justify:"center"},{default:l(()=>[t(b,{span:22},{default:l(()=>[t(a,{label:n.$t("firewall.address"),prop:"address"},{default:l(()=>[t(g,{disabled:o.value.title==="edit",autosize:{minRows:3,maxRows:6},type:"textarea",clearable:"",modelValue:o.value.rowData.address,"onUpdate:modelValue":u[0]||(u[0]=_=>o.value.rowData.address=_),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"]),k("span",$e,p(n.$t("firewall.addressHelper1")),1),k("span",he,p(n.$t("firewall.addressHelper2")),1),k("span",ke,p(n.$t("firewall.addressHelper3")),1)]),_:1},8,["label"]),t(a,{label:n.$t("firewall.strategy"),prop:"strategy"},{default:l(()=>[t(v,{modelValue:o.value.rowData.strategy,"onUpdate:modelValue":u[1]||(u[1]=_=>o.value.rowData.strategy=_)},{default:l(()=>[t(e,{label:"accept"},{default:l(()=>[y(p(n.$t("firewall.allow")),1)]),_:1}),t(e,{label:"drop"},{default:l(()=>[y(p(n.$t("firewall.deny")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[C,c.value]])]),_:1},8,["modelValue"])}}}),Se={style:{position:"relative"}},Ce={class:"search-button"},Ve={key:0},Ee={key:1},ra=O({__name:"index",setup(G){const i=d(),V=d("address"),c=d([]),$=d(),D=d(!0),m=d("running"),o=d(),R=d(),h=H({currentPage:1,pageSize:10,total:0}),f=async()=>{if(m.value!=="running"){i.value=!1,R.value=[],h.total=0;return}let a={type:V.value,info:$.value,page:h.currentPage,pageSize:h.pageSize};i.value=!0,await ce(a).then(e=>{i.value=!1,R.value=e.data.items||[],h.total=e.data.total}).catch(()=>{i.value=!1})},S=d(),E=async(a,e={strategy:"accept"})=>{let v={title:a,rowData:{...e}};S.value.acceptParams(v)},n=async(a,e)=>{let v=e==="accept"?r.global.t("firewall.changeStrategyIPHelper2"):r.global.t("firewall.changeStrategyIPHelper1");N.confirm(v,r.global.t("firewall.changeStrategy",[" IP "]),{confirmButtonText:r.global.t("commons.button.confirm"),cancelButtonText:r.global.t("commons.button.cancel")}).then(async()=>{let b={oldRule:{operation:"remove",address:a.address,strategy:a.strategy},newRule:{operation:"add",address:a.address,strategy:e}};i.value=!0,await x(b).then(()=>{i.value=!1,U(r.global.t("commons.msg.operationSuccess")),f()}).catch(()=>{i.value=!1})})},u=async a=>{N.confirm(r.global.t("commons.msg.delete"),r.global.t("commons.msg.deleteTitle"),{confirmButtonText:r.global.t("commons.button.confirm"),cancelButtonText:r.global.t("commons.button.cancel"),type:"warning"}).then(async()=>{let e=[];if(a)e.push({operation:"remove",address:a.address,port:"",source:"",protocol:"",strategy:a.strategy});else for(const v of c.value)e.push({operation:"remove",address:v.address,port:"",source:"",protocol:"",strategy:v.strategy});i.value=!0,await fe({type:"port",rules:e}).then(()=>{i.value=!1,U(r.global.t("commons.msg.operationSuccess")),f()}).catch(()=>{i.value=!1})})},g=[{label:r.global.t("commons.button.edit"),click:a=>{E("edit",a)}},{label:r.global.t("commons.button.delete"),click:a=>{u(a)}}];return te(()=>{i.value=!0,o.value.acceptParams()}),(a,e)=>{const v=le,b=j,B=q,P=F,z=A,C=oe,_=ie("fu-table-operations"),J=K;return M((w(),I("div",Se,[t(_e),t(be,{ref_key:"fireStatuRef",ref:o,onSearch:f,loading:i.value,"onUpdate:loading":e[0]||(e[0]=s=>i.value=s),"mask-show":D.value,"onUpdate:mask-show":e[1]||(e[1]=s=>D.value=s),status:m.value,"onUpdate:status":e[2]||(e[2]=s=>m.value=s)},null,8,["loading","mask-show","status"]),m.value!="running"&&D.value?(w(),T(v,{key:0,class:"mask-prompt"},{default:l(()=>[k("span",null,p(a.$t("firewall.firewallNotStart")),1)]),_:1})):se("",!0),t(ye,{title:a.$t("firewall.ipRule"),class:re({mask:m.value!="running"})},{toolbar:l(()=>[t(z,null,{default:l(()=>[t(B,{span:16},{default:l(()=>[t(b,{type:"primary",onClick:e[3]||(e[3]=s=>E("create"))},{default:l(()=>[y(p(a.$t("commons.button.create"))+" "+p(a.$t("firewall.ipRule")),1)]),_:1}),t(b,{onClick:e[4]||(e[4]=s=>u(null)),plain:"",disabled:c.value.length===0},{default:l(()=>[y(p(a.$t("commons.button.delete")),1)]),_:1},8,["disabled"])]),_:1}),t(B,{span:8},{default:l(()=>[t(we,{onSearch:e[5]||(e[5]=s=>f())}),k("div",Ce,[t(P,{modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=s=>$.value=s),clearable:"",onClear:e[7]||(e[7]=s=>f()),"suffix-icon":"Search",onKeyup:e[8]||(e[8]=ne(s=>f(),["enter"])),onBlur:e[9]||(e[9]=s=>f()),placeholder:a.$t("commons.button.search")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),main:l(()=>[t(ue,{"pagination-config":h,selects:c.value,"onUpdate:selects":e[10]||(e[10]=s=>c.value=s),onSearch:f,data:R.value},{default:l(()=>[t(C,{type:"selection",fix:""}),t(C,{"min-width":80,label:a.$t("firewall.address"),prop:"address"},{default:l(({row:s})=>[s.address&&s.address!=="Anywhere"?(w(),I("span",Ve,p(s.address),1)):(w(),I("span",Ee,p(a.$t("firewall.allIP")),1))]),_:1},8,["label"]),t(C,{"min-width":80,label:a.$t("firewall.strategy"),prop:"strategy"},{default:l(({row:s})=>[s.strategy==="accept"?(w(),T(b,{key:0,onClick:L=>n(s,"drop"),link:"",type:"success"},{default:l(()=>[y(p(a.$t("firewall.allow")),1)]),_:2},1032,["onClick"])):(w(),T(b,{key:1,link:"",type:"danger",onClick:L=>n(s,"accept")},{default:l(()=>[y(p(a.$t("firewall.deny")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),t(_,{width:"200px",buttons:g,ellipsis:10,label:a.$t("commons.table.operate"),fix:""},null,8,["label"])]),_:1},8,["pagination-config","selects","data"])]),_:1},8,["title","class"]),t(Re,{onSearch:f,ref_key:"dialogRef",ref:S},null,512)])),[[J,i.value]])}}});export{ra as default};
