import{d as J,u as ye,r as n,b as o,c as g,w as a,e as t,y as e,h as D,F as L,i as j,f as k,t as v,g as E,O as q,ag as W,ah as ke,M as he,N as $e,l as ee,m as ae,ao as Ve,a as Ce,Y as le,j as b,$ as Y,a4 as Ae,a2 as re,a1 as de,a3 as ie,A as te,a5 as oe,x as Q,ab as be,v as Te,ap as ce,K as Ie,L as we,af as Be,_ as ze,o as Fe,Q as Ne,z as Me,p as He,E as qe,a6 as ve,ae as Le,q as Oe,s as Ge}from"./index-609fd921.js";/* empty css                *//* empty css            *//* empty css               *//* empty css                *//* empty css               *//* empty css            *//* empty css              *//* empty css               */import{g as me,h as je,U as Ke,i as Ze,j as xe,a as Qe,G as We,A as Ye}from"./app-1a8bdb12.js";import{_ as Je}from"./layout-content-47227111.js";import{_ as Xe,a as ea}from"./index-d8f066d1.js";/* empty css               *//* empty css                *//* empty css                          *//* empty css              *//* empty css             */import"./form-item-d76e7d20.js";/* empty css                 */import{b as X}from"./bus-624744fb.js";import{_ as Re}from"./index-110fbc44.js";/* empty css               *//* empty css                    */import{R as pe}from"./form-rules-08616160.js";import{_ as ge}from"./index-3ec321ac.js";import{a as aa}from"./util-bdb43d7e.js";import"./index-e09fb15b.js";/* empty css                    *//* empty css             *//* empty css                     */import"./index-af1c8b2d.js";import"./use-delete-data-3fb8ebbf.js";import"./setting-34057840.js";import"./base64-e52cbffd.js";import"./files-c7fff4dc.js";/* empty css                 *//* empty css             */var la="/assets/svg/no_update_app-0eb2585f.svg";const ta=k("br",null,null,-1),oa=["onClick"],na=J({__name:"index",setup(O,{expose:T}){const S=ye(),y=n({items:[]});let s=n(!1),c=new Map;const w=d=>{c.clear(),y.value.items=[],y.value.items=d.items,y.value.items.forEach(V=>{if(c.has(V.type)){const B=c.get(V.type);B.push(V.name),c.set(V.type,B)}else c.set(V.type,[V.name])}),s.value=!0},$=d=>{d==="app"&&(s.value=!1),d==="website"&&S.push({name:"Website"}),d==="database"&&S.push({name:"MySQL"})};return T({acceptParams:w}),(d,V)=>{const B=ke,U=he,M=$e,z=ee,m=ae,_=Ve;return o(),g(_,{modelValue:e(s),"onUpdate:modelValue":V[0]||(V[0]=f=>W(s)?s.value=f:s=f),title:d.$t("app.checkTitle"),width:"50%","close-on-click-modal":!1},{default:a(()=>[t(m,null,{default:a(()=>[t(B,{type:"warning",description:d.$t("app.deleteHelper",[d.$t("app.app")]),center:"","show-icon":"",closable:!1},null,8,["description"]),e(s)?(o(),g(z,{key:0,span:20,offset:2},{default:a(()=>[ta,t(M,{border:"",column:1},{default:a(()=>[(o(!0),D(L,null,j(e(c),(f,F)=>(o(),g(U,{key:F},{label:a(()=>[k("a",{href:"javascript:void(0);",onClick:i=>$(f[0])},v(d.$t("app."+f[0])),9,oa)]),default:a(()=>[E(" "+v(e(c).get(f[0]).toString()),1)]),_:2},1024))),128))]),_:1})]),_:1})):q("",!0)]),_:1})]),_:1},8,["modelValue","title"])}}}),sa={class:"input-help"},ua={class:"input-help"},pa={class:"input-help"},ra=["innerHTML"],da={class:"dialog-footer"},ia=J({__name:"index",emits:["close"],setup(O,{expose:T,emit:S}){let y=n({operate:"delete",installId:0,deleteBackup:!1,forceDelete:!1,deleteDB:!0}),s=n(!1),c=n(!1),w=n(""),$=n(""),d=n(""),V=n("");const B=n(),U=()=>{s.value=!1,S("close",s)},M=async m=>{y.value={operate:"delete",installId:0,deleteBackup:!1,forceDelete:!1,deleteDB:!0},$.value="",y.value.installId=m.id,V.value=m.app.type,w.value=b.global.t("website.deleteConfirmHelper",[m.name]),d.value=m.name,s.value=!0},z=async()=>{c.value=!0,me(y.value).then(()=>{U(),Y(b.global.t("commons.msg.deleteSuccess")),X.emit("update",!0)}).finally(()=>{c.value=!1})};return Ce(()=>{X.off("update")}),T({acceptParams:M}),(m,_)=>{const f=Ae,F=re,i=de,p=ie,P=te,G=Ve,I=oe;return o(),g(G,{modelValue:e(s),"onUpdate:modelValue":_[4]||(_[4]=h=>W(s)?s.value=h:s=h),title:m.$t("commons.button.delete")+" - "+e(d),width:"40%","close-on-click-modal":!1,"before-close":U},{footer:a(()=>[k("span",da,[t(P,{onClick:U,disabled:e(c)},{default:a(()=>[E(v(m.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),t(P,{type:"primary",onClick:z,disabled:e(c)||e($)!==e(d)},{default:a(()=>[E(v(m.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:a(()=>[le((o(),g(p,{ref_key:"deleteForm",ref:B,"label-position":"left"},{default:a(()=>[t(F,null,{default:a(()=>[t(f,{modelValue:e(y).forceDelete,"onUpdate:modelValue":_[0]||(_[0]=h=>e(y).forceDelete=h),label:m.$t("app.forceDelete")},null,8,["modelValue","label"]),k("span",sa,v(m.$t("app.forceDeleteHelper")),1)]),_:1}),t(F,null,{default:a(()=>[t(f,{modelValue:e(y).deleteBackup,"onUpdate:modelValue":_[1]||(_[1]=h=>e(y).deleteBackup=h),label:m.$t("app.deleteBackup")},null,8,["modelValue","label"]),k("span",ua,v(m.$t("app.deleteBackupHelper")),1)]),_:1}),e(V)==="website"?(o(),g(F,{key:0},{default:a(()=>[t(f,{modelValue:e(y).deleteDB,"onUpdate:modelValue":_[2]||(_[2]=h=>e(y).deleteDB=h),label:m.$t("app.deleteDB")},null,8,["modelValue","label"]),k("span",pa,v(m.$t("app.deleteDBHelper")),1)]),_:1})):q("",!0),t(F,null,{default:a(()=>[k("span",{innerHTML:e(w)},null,8,ra),t(i,{modelValue:e($),"onUpdate:modelValue":_[3]||(_[3]=h=>W($)?$.value=h:$=h),placeholder:e(d)},null,8,["modelValue","placeholder"])]),_:1})]),_:1})),[[I,e(c)]])]),_:1},8,["modelValue","title"])}}});const ca=J({__name:"index",setup(O,{expose:T}){const S=n({id:0});let y=n(!1),s=n(!1);const c=n();let w=n(!1);const $=n();let d=n({}),V=Q({}),B=n({}),U=n(!1);const M=async i=>{U.value=!1,B.value.installId=i.id,c.value=[],S.value.id=i.id,w.value=!1,await _(),y.value=!0},z=()=>{y.value=!1},m=()=>{c.value.forEach(i=>{d.value[i.key]=i.value}),w.value=!w.value},_=async()=>{try{s.value=!0;const i=await je(Number(S.value.id));i.data&&i.data.length>0&&i.data.forEach(p=>{p.edit&&(U.value=!0);let P=p.value;p.type==="number"&&(P=Number(P)),c.value.push({default:P,labelEn:p.labelEn,labelZh:p.labelZh,rule:p.rule,value:P,edit:p.edit,key:p.key,type:p.type,values:p.values,showValue:p.showValue}),V[p.key]=[pe.requiredInput],p.rule&&V[p.key].push(pe[p.rule])})}catch{}finally{s.value=!1}},f=i=>Te().locale.value=="zh"?i.labelZh:i.labelEn,F=async i=>{!i||await i.validate(p=>{!p||ce.confirm(b.global.t("app.updateWarn"),b.global.t("app.update"),{confirmButtonText:b.global.t("commons.button.confirm"),cancelButtonText:b.global.t("commons.button.cancel"),type:"info"}).then(async()=>{B.value.params=d.value;try{s.value=!0,await Ke(B.value),s.value=!1,Y(b.global.t("commons.msg.updateSuccess")),z()}catch{s.value=!1}})})};return T({acceptParams:M}),(i,p)=>{const P=te,G=he,I=$e,h=ke,K=de,N=Ie,Z=we,ne=re,se=ie,ue=ee,l=ae,C=Be,R=oe;return o(),g(C,{"close-on-click-modal":!1,modelValue:e(y),"onUpdate:modelValue":p[1]||(p[1]=r=>W(y)?y.value=r:y=r),size:"40%"},be({header:a(()=>[t(Re,{header:i.$t("app.param"),back:z},be({_:2},[e(U)?{name:"buttons",fn:a(()=>[t(P,{type:"primary",plain:"",onClick:m,disabled:e(s)},{default:a(()=>[E(v(e(w)?i.$t("app.detail"):i.$t("commons.button.edit")),1)]),_:1},8,["disabled"])]),key:"0"}:void 0]),1032,["header"])]),default:a(()=>[e(w)?le((o(),g(l,{key:1},{default:a(()=>[t(ue,{span:22,offset:1},{default:a(()=>[t(h,{title:i.$t("app.updateHelper"),type:"warning",closable:!1},null,8,["title"]),t(se,{ref_key:"paramForm",ref:$,model:e(d),"label-position":"top",rules:e(V)},{default:a(()=>[(o(!0),D(L,null,j(c.value,(r,x)=>(o(),D("div",{key:x},[t(ne,{prop:r.key,label:f(r)},{default:a(()=>[r.type=="number"?(o(),g(K,{key:0,type:"number",modelValue:e(d)[r.key],"onUpdate:modelValue":A=>e(d)[r.key]=A,modelModifiers:{number:!0},disabled:!r.edit},null,8,["modelValue","onUpdate:modelValue","disabled"])):r.type=="select"?(o(),g(Z,{key:1,modelValue:e(d)[r.key],"onUpdate:modelValue":A=>e(d)[r.key]=A},{default:a(()=>[(o(!0),D(L,null,j(r.values,A=>(o(),g(N,{key:A.label,value:A.value,label:A.label,disabled:!r.edit},null,8,["value","label","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(o(),g(K,{key:2,modelValue:e(d)[r.key],"onUpdate:modelValue":A=>e(d)[r.key]=A,modelModifiers:{trim:!0},disabled:!r.edit},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:2},1032,["prop","label"])]))),128))]),_:1},8,["model","rules"])]),_:1})]),_:1})),[[R,e(s)]]):(o(),g(I,{key:0,border:"",column:1},{default:a(()=>[(o(!0),D(L,null,j(c.value,(r,x)=>(o(),g(G,{label:f(r),key:x},{default:a(()=>[k("span",null,v(r.showValue&&r.showValue!=""?r.showValue:r.value),1)]),_:2},1032,["label"]))),128))]),_:1}))]),_:2},[e(w)?{name:"footer",fn:a(()=>[k("span",null,[t(P,{onClick:z,disabled:e(s)},{default:a(()=>[E(v(i.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),t(P,{type:"primary",disabled:e(s),onClick:p[0]||(p[0]=r=>F($.value))},{default:a(()=>[E(v(i.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["modelValue"])}}}),ma={class:"dialog-footer"},_a=J({__name:"index",emits:["close"],setup(O,{expose:T,emit:S}){const y=n();let s=n(!1),c=n(!1),w=n(),$=Q({detailId:0,operate:"upgrade",installId:0});const d=n("");let V=n({detailId:[pe.requiredSelect]});const B=()=>{s.value=!1,S("close",s)},U=(m,_)=>{$.installId=m,d.value=_,Ze(m).then(f=>{w.value=f.data,f.data!=null&&f.data.length>0&&($.detailId=f.data[0].detailId),s.value=!0})},M=async()=>{c.value=!0,await me($).then(()=>{Y(b.global.t("commons.msg.operationSuccess")),X.emit("upgrade",!0),B()}).finally(()=>{c.value=!1})},z=async()=>{ce.confirm(b.global.t("app.operatorHelper",[b.global.t("app.upgrade")]),b.global.t("app.upgrade"),{confirmButtonText:b.global.t("commons.button.confirm"),cancelButtonText:b.global.t("commons.button.cancel"),type:"info"}).then(()=>{M()})};return Ce(()=>{X.off("upgrade")}),T({acceptParams:U}),(m,_)=>{const f=Ie,F=we,i=re,p=ie,P=ee,G=ae,I=te,h=Be,K=oe;return o(),g(h,{"close-on-click-modal":!1,modelValue:e(s),"onUpdate:modelValue":_[1]||(_[1]=N=>W(s)?s.value=N:s=N),size:"30%"},{header:a(()=>[t(Re,{header:m.$t("app.upgrade"),resource:d.value,back:B},null,8,["header","resource"])]),footer:a(()=>[k("span",ma,[t(I,{onClick:B,disabled:e(c)},{default:a(()=>[E(v(m.$t("commons.button.cancel")),1)]),_:1},8,["disabled"]),t(I,{type:"primary",onClick:z,disabled:e(w)==null||e(c)},{default:a(()=>[E(v(m.$t("commons.button.confirm")),1)]),_:1},8,["disabled"])])]),default:a(()=>[t(G,null,{default:a(()=>[t(P,{span:22,offset:1},{default:a(()=>[le((o(),g(p,{ref_key:"updateRef",ref:y,rules:e(V),"label-position":"top",model:e($)},{default:a(()=>[t(i,{label:m.$t("app.versioneSelect"),prop:"detailId"},{default:a(()=>[t(F,{modelValue:e($).detailId,"onUpdate:modelValue":_[0]||(_[0]=N=>e($).detailId=N)},{default:a(()=>[(o(!0),D(L,null,j(e(w),(N,Z)=>(o(),g(f,{key:Z,value:N.detailId,label:N.version},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["rules","model"])),[[K,e(c)]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const Ee=O=>(Oe("data-v-706a0646"),O=O(),Ge(),O),fa={class:"search-button"},ba={key:0,class:"update-prompt"},va=Ee(()=>k("div",null,[k("img",{src:la})],-1)),ga={class:"install-card"},ya={class:"icon"},ka={class:"a-detail"},ha={class:"d-name"},$a={class:"name"},Va={class:"status"},Ca={key:1},Ia={class:"d-description"},wa={class:"description"},Ba=Ee(()=>k("div",{class:"app-divider"},null,-1)),Ra={key:0,class:"d-button"},Ea=J({__name:"index",setup(O){let T=n(),S=n(!1),y=n(!1),s=null;const c=Q({currentPage:1,pageSize:20,total:0});let w=n(!1),$=Q({installId:0,operate:"",detailId:0});const d=n(),V=n(),B=n(),U=n(),M=n(),z=n();let m=n([]),_=n("all"),f=Q({page:1,pageSize:15,name:"",tags:[],update:!1});const F=ye();let i=n(b.global.t("app.installed")),p=n("installed");const P=()=>{y.value=!0,xe().then(()=>{Y(b.global.t("app.syncSuccess")),I()}).finally(()=>{y.value=!1})},G=l=>{f.tags=[],_.value=l,l!=="all"&&(f.tags=[l]),I()},I=()=>{S.value=!0,f.page=c.currentPage,f.pageSize=c.pageSize,Qe(f).then(l=>{T.value=l.data.items,c.total=l.data.total}).finally(()=>{S.value=!1}),We().then(l=>{m.value=l.data})},h=(l,C)=>{$.installId=l.id,$.operate=C,C=="upgrade"?z.value.acceptParams(l.id,l.name):C=="delete"?Ye(l.id).then(async R=>{const r=R.data;R.data&&R.data.length>0?B.value.acceptParams({items:r}):U.value.acceptParams(l)}):N(C)},K=async()=>{w.value=!1,S.value=!0,await me($).then(()=>{Y(b.global.t("commons.msg.operationSuccess")),I()}).catch(()=>{I()}).finally(()=>{S.value=!1})},N=async l=>{ce.confirm(b.global.t("app.operatorHelper",[b.global.t("app."+l)]),b.global.t("app."+l),{confirmButtonText:b.global.t("commons.button.confirm"),cancelButtonText:b.global.t("commons.button.cancel"),type:"info"}).then(()=>{K()})},Z=[{label:b.global.t("app.sync"),click:l=>{h(l,"sync")}},{label:b.global.t("app.rebuild"),click:l=>{h(l,"rebuild")}},{label:b.global.t("app.restart"),click:l=>{h(l,"restart")}},{label:b.global.t("app.start"),click:l=>{h(l,"start")},disabled:l=>l.status==="Running"},{label:b.global.t("app.stop"),click:l=>{h(l,"stop")},disabled:l=>l.status!=="Running"},{label:b.global.t("app.delete"),click:l=>{h(l,"delete")}},{label:b.global.t("app.params"),click:l=>{ue(l.id)}}],ne=(l,C)=>{let R={type:"app",name:l,detailName:C};d.value.acceptParams(R)},se=(l,C)=>{let R={type:"app",name:l,detailName:C};V.value.acceptParams(R)},ue=l=>{M.value.acceptParams({id:l})};return Fe(()=>{F.currentRoute.value.path=="/apps/upgrade"&&(i.value=b.global.t("app.canUpgrade"),p.value="upgrade",f.update=!0),I(),s=setInterval(()=>{I()},1e4*6)}),Ne(()=>{clearInterval(Number(s)),s=null}),(l,C)=>{const R=te,r=ee,x=de,A=ae,Pe=Me,Se=He,_e=qe,Ue=oe;return o(),D(L,null,[le((o(),g(Je,{title:e(i),divider:!0},{toolbar:a(()=>[t(A,{gutter:5},{default:a(()=>[t(r,{span:20},{default:a(()=>[k("div",null,[t(R,{class:ve(["tag-button",e(_)==="all"?"":"no-active"]),onClick:C[0]||(C[0]=u=>G("all")),type:e(_)==="all"?"primary":"",plain:e(_)!=="all"},{default:a(()=>[E(v(l.$t("app.all")),1)]),_:1},8,["class","type","plain"]),(o(!0),D(L,null,j(e(m),u=>(o(),D("div",{key:u.key,style:{display:"inline"}},[t(R,{class:ve(["tag-button",e(_)===u.key?"":"no-active"]),onClick:fe=>G(u.key),type:e(_)===u.key?"primary":"",plain:e(_)!==u.key},{default:a(()=>[E(v(u.name),1)]),_:2},1032,["class","onClick","type","plain"])]))),128))])]),_:1}),t(r,{span:4},{default:a(()=>[k("div",fa,[t(x,{class:"table-button",modelValue:e(f).name,"onUpdate:modelValue":C[1]||(C[1]=u=>e(f).name=u),clearable:"",onClear:C[2]||(C[2]=u=>I()),"suffix-icon":"Search",onKeyup:C[3]||(C[3]=Le(u=>I(),["enter"])),onBlur:C[4]||(C[4]=u=>I()),placeholder:l.$t("commons.button.search")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),rightButton:a(()=>[e(p)==="installed"&&e(T)!=null?(o(),g(R,{key:0,onClick:P,type:"primary",link:""},{default:a(()=>[E(v(l.$t("app.sync")),1)]),_:1})):q("",!0)]),main:a(()=>[e(T)==null?(o(),D("div",ba,[k("span",null,v(e(p)==="upgrade"?l.$t("app.updatePrompt"):l.$t("app.installPrompt")),1),va])):q("",!0),t(A,{gutter:5},{default:a(()=>[(o(!0),D(L,null,j(e(T),(u,fe)=>(o(),g(r,{key:fe,xs:24,sm:24,md:24,lg:12,xl:12,class:"install-card-col-12"},{default:a(()=>[k("div",ga,[t(A,{gutter:24},{default:a(()=>[t(r,{xs:3,sm:3,md:3,lg:4,xl:4},{default:a(()=>[k("div",ya,[t(Pe,{shape:"square",size:66,src:"data:image/png;base64,"+u.app.icon},null,8,["src"])])]),_:2},1024),t(r,{xs:21,sm:21,md:21,lg:20,xl:20},{default:a(()=>[k("div",ka,[k("div",ha,[k("span",$a,v(u.name),1),k("span",Va,[u.status==="Error"?(o(),g(Se,{key:0,placement:"bottom",width:400,trigger:"hover",content:u.message},{reference:a(()=>[(o(),g(ge,{key:u.status,status:u.status},null,8,["status"]))]),_:2},1032,["content"])):(o(),D("span",Ca,[(o(),g(ge,{key:u.status,status:u.status},null,8,["status"]))]))]),e(p)==="installed"?(o(),g(R,{key:0,class:"h-button",type:"primary",plain:"",round:"",size:"small",disabled:u.status!=="Running",onClick:H=>se(u.app.key,u.name)},{default:a(()=>[E(v(l.$t("database.loadBackup")),1)]),_:2},1032,["disabled","onClick"])):q("",!0),e(p)==="installed"?(o(),g(R,{key:1,class:"h-button",type:"primary",plain:"",round:"",size:"small",disabled:u.status!=="Running",onClick:H=>ne(u.app.key,u.name)},{default:a(()=>[E(v(l.$t("app.backup")),1)]),_:2},1032,["disabled","onClick"])):q("",!0),e(p)==="upgrade"?(o(),g(R,{key:2,class:"h-button",type:"primary",plain:"",round:"",size:"small",onClick:H=>h(u,"upgrade")},{default:a(()=>[E(v(l.$t("app.upgrade")),1)]),_:2},1032,["onClick"])):q("",!0)]),k("div",Ia,[t(_e,null,{default:a(()=>[E(v(l.$t("app.version"))+"\uFF1A"+v(u.version),1)]),_:2},1024),u.httpPort>0?(o(),g(_e,{key:0},{default:a(()=>[E(v(l.$t("app.busPort"))+"\uFF1A"+v(u.httpPort),1)]),_:2},1024)):q("",!0),k("div",wa,[k("span",null,v(l.$t("app.areadyRun"))+"\uFF1A "+v(e(aa)(u.createdAt)),1)])]),Ba,e(p)==="installed"&&u.status!="Installing"?(o(),D("div",Ra,[(o(),D(L,null,j(Z,(H,De)=>t(R,{key:De,type:H.disabled&&H.disabled(u)?"info":"primary",plain:"",round:"",size:"small",onClick:Pa=>H.click(u),disabled:H.disabled&&H.disabled(u)},{default:a(()=>[E(v(H.label),1)]),_:2},1032,["type","onClick","disabled"])),64))])):q("",!0)])]),_:2},1024)]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),_:1},8,["title"])),[[Ue,e(S)||e(y)]]),t(Xe,{ref_key:"backupRef",ref:d,onClose:I},null,512),t(ea,{ref_key:"uploadRef",ref:V},null,512),t(na,{ref_key:"checkRef",ref:B},null,512),t(ia,{ref_key:"deleteRef",ref:U,onClose:I},null,512),t(ca,{ref_key:"appParamRef",ref:M},null,512),t(_a,{ref_key:"upgradeRef",ref:z,onClose:I},null,512)],64)}}});var _l=ze(Ea,[["__scopeId","data-v-706a0646"]]);export{_l as default};
