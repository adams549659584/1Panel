import{d as K,r as y,x as E,o as Q,l as W,A as X,a1 as ee,a2 as te,au as ae,aZ as le,C as oe,m as ne,af as ie,a5 as se,b as _,h as k,Y as I,c as F,w as o,y as c,a3 as N,e as l,g,t as r,f as s,O as re,$ as C,j as u,ap as ue,U as me}from"./index-609fd921.js";/* empty css                */import{_ as pe}from"./index-110fbc44.js";/* empty css                *//* empty css            *//* empty css             *//* empty css               */import"./form-item-d76e7d20.js";/* empty css              *//* empty css               */import{_ as de}from"./layout-content-47227111.js";import{o as ce,e as fe,f as M,v as ge,w as ve,x as be}from"./setting-34057840.js";import{R as S,c as ye}from"./form-rules-08616160.js";import{h as _e}from"./util-bdb43d7e.js";/* empty css                    *//* empty css            */import"./index-e09fb15b.js";import"./base64-e52cbffd.js";const he=s("br",null,null,-1),we={key:0,class:"input-help"},Se={key:1,class:"input-help"},Ve={class:"input-help"},$e={class:"input-help"},xe={style:{"line-height":"24px"}},Ce=s("ul",null,[s("li",null,"Google Authenticator"),s("li",null,"Microsoft Authenticator"),s("li",null,"1Password"),s("li",null,"LastPass"),s("li",null,"Authenticator")],-1),Te={style:{"margin-top":"10px","margin-bottom":"10px",float:"right"}},Ee={class:"input-help"},ke={class:"dialog-footer"},Je=K({__name:"index",setup(Fe){const n=y(!1),a=E({serverPort:9999,securityEntrance:"",expirationDays:0,expirationTime:"",complexityVerification:"",mfaStatus:"disable",mfaSecret:"disable"}),P=y(),v=y(!1),b=E({days:0}),h=async()=>{const e=await fe();a.serverPort=Number(e.data.serverPort),a.securityEntrance=e.data.securityEntrance,a.expirationDays=Number(e.data.expirationDays),a.expirationTime=e.data.expirationTime,a.complexityVerification=e.data.complexityVerification,a.mfaStatus=e.data.mfaStatus,a.mfaSecret=e.data.mfaSecret},w=y(!1),V=E({secret:"",qrImage:""}),$=y(),T=y(),H=async(e,t,m)=>{if(!e||!await e.validateField(t.replace(t[0],t[0].toLowerCase()),D)||m==="")return;let f={key:t,value:m+""};n.value=!0,await M(f).then(()=>{n.value=!1,C(u.global.t("commons.msg.operationSuccess")),h()}).catch(()=>{n.value=!1})};function D(e){if(e)return e.message}const R=async(e,t,m)=>{!e||!await e.validateField(t.replace(t[0],t[0].toLowerCase()),D)||ue.confirm(u.global.t("setting.portChangeHelper"),u.global.t("setting.portChange"),{confirmButtonText:u.global.t("commons.button.confirm"),cancelButtonText:u.global.t("commons.button.cancel"),type:"info"}).then(async()=>{n.value=!0,await ge({serverPort:m}).then(()=>{n.value=!1,C(u.global.t("commons.msg.operationSuccess"));let p=window.location.href,x=p.split("//")[1].split(":")[0];window.open(`${p.split("//")[0]}//${x}:${m}/`,"_self")}).catch(()=>{n.value=!1})})},U=async()=>{if(a.mfaStatus==="enable"){const e=await ve();V.secret=e.data.secret,V.qrImage=e.data.qrImage,w.value=!0}else w.value=!1,n.value=!0,await M({key:"MFAStatus",value:"disable"}).then(()=>{n.value=!1,h(),C(u.global.t("commons.msg.operationSuccess"))}).catch(()=>{n.value=!1})},q=()=>{v.value=!1},L=async()=>{if(!$.value){me(u.global.t("commons.msg.comfimNoNull",["code"]));return}n.value=!0,await be({code:$.value,secret:V.secret}).then(()=>{n.value=!1,h(),C(u.global.t("commons.msg.operationSuccess")),w.value=!1}).catch(()=>{n.value=!1})},G=async()=>{a.mfaStatus="disable",w.value=!1},O=async()=>{b.days=a.expirationDays,v.value=!0},j=async e=>{!e||e.validate(async t=>{if(!t)return;let m=new Date(new Date().getTime()+3600*1e3*24*b.days);n.value=!0,await M({key:"ExpirationDays",value:b.days+""}).then(()=>{n.value=!1,h(),A(),a.expirationTime=_e(m),v.value=!1}).catch(()=>{n.value=!1})})};function A(){if(a.expirationDays===0)return a.expirationTime=u.global.t("setting.unSetting"),u.global.t("setting.unSetting");let e=new Date(a.expirationTime).getTime()-new Date().getTime();return e<0?(a.expirationTime=u.global.t("setting.unSetting"),u.global.t("setting.unSetting")):Math.floor(e/(3600*1e3*24))}return Q(()=>{h(),ce()}),(e,t)=>{const m=W,d=X,f=ee,p=te,x=ae,z=le,Y=oe,Z=ne,J=ie,B=se;return _(),k("div",null,[I((_(),F(de,{title:e.$t("setting.safe"),divider:!0},{main:o(()=>[I((_(),F(c(N),{model:a,ref_key:"panelFormRef",ref:T,"label-position":"left","label-width":"180px"},{default:o(()=>[l(Z,null,{default:o(()=>[l(m,{span:1},{default:o(()=>[he]),_:1}),l(m,{span:10},{default:o(()=>[l(p,{label:e.$t("setting.panelPort"),rules:c(S).port,prop:"serverPort"},{default:o(()=>[l(f,{clearable:"",modelValue:a.serverPort,"onUpdate:modelValue":t[1]||(t[1]=i=>a.serverPort=i),modelModifiers:{number:!0}},{append:o(()=>[l(d,{style:{width:"85px"},onClick:t[0]||(t[0]=i=>R(T.value,"ServerPort",a.serverPort)),icon:"Collection"},{default:o(()=>[g(r(e.$t("commons.button.save")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","rules"]),l(p,{label:e.$t("setting.expirationTime"),prop:"expirationTime",rules:c(S).requiredInput},{default:o(()=>[l(f,{disabled:"",modelValue:a.expirationTime,"onUpdate:modelValue":t[2]||(t[2]=i=>a.expirationTime=i)},{append:o(()=>[l(d,{style:{width:"85px"},onClick:O,icon:"Setting"},{default:o(()=>[g(r(e.$t("commons.button.set")),1)]),_:1})]),_:1},8,["modelValue"]),s("div",null,[a.expirationTime!==e.$t("setting.unSetting")?(_(),k("span",we,r(e.$t("setting.timeoutHelper",[A()])),1)):(_(),k("span",Se,r(e.$t("setting.noneSetting")),1))])]),_:1},8,["label","rules"]),l(p,{label:e.$t("setting.complexity"),prop:"complexityVerification",rules:c(S).requiredSelect},{default:o(()=>[l(x,{onChange:t[3]||(t[3]=i=>H(T.value,"ComplexityVerification",a.complexityVerification)),modelValue:a.complexityVerification,"onUpdate:modelValue":t[4]||(t[4]=i=>a.complexityVerification=i),"active-value":"enable","inactive-value":"disable"},null,8,["modelValue"]),s("span",Ve,r(e.$t("setting.complexityHelper")),1)]),_:1},8,["label","rules"]),l(p,{label:e.$t("setting.mfa"),prop:"securityEntrance",rules:c(S).requiredSelect},{default:o(()=>[l(x,{onChange:U,modelValue:a.mfaStatus,"onUpdate:modelValue":t[5]||(t[5]=i=>a.mfaStatus=i),"active-value":"enable","inactive-value":"disable"},null,8,["modelValue"]),s("span",$e,r(e.$t("setting.mfaHelper")),1)]),_:1},8,["label","rules"]),w.value?(_(),F(p,{key:0},{default:o(()=>[l(Y,{style:{width:"100%"}},{default:o(()=>[s("ul",xe,[s("li",null,[g(r(e.$t("setting.mfaHelper1"))+" ",1),Ce]),s("li",null,r(e.$t("setting.mfaHelper2")),1),l(z,{style:{"margin-left":"15px",width:"100px",height:"100px"},src:V.qrImage},null,8,["src"]),s("li",null,r(e.$t("setting.mfaHelper3")),1),l(f,{modelValue:$.value,"onUpdate:modelValue":t[6]||(t[6]=i=>$.value=i)},null,8,["modelValue"]),s("div",Te,[l(d,{onClick:G},{default:o(()=>[g(r(e.$t("commons.button.cancel")),1)]),_:1}),l(d,{type:"primary",onClick:L},{default:o(()=>[g(r(e.$t("commons.button.saveAndEnable")),1)]),_:1})])])]),_:1})]),_:1})):re("",!0)]),_:1})]),_:1})]),_:1},8,["model"])),[[B,n.value]])]),_:1},8,["title"])),[[B,n.value]]),l(J,{modelValue:v.value,"onUpdate:modelValue":t[10]||(t[10]=i=>v.value=i),"destroy-on-close":!0,"close-on-click-modal":!1,size:"30%"},{header:o(()=>[l(pe,{header:e.$t("setting.expirationTime"),back:q},null,8,["header"])]),footer:o(()=>[s("span",ke,[l(d,{onClick:t[8]||(t[8]=i=>v.value=!1)},{default:o(()=>[g(r(e.$t("commons.button.cancel")),1)]),_:1}),l(d,{type:"primary",onClick:t[9]||(t[9]=i=>j(P.value))},{default:o(()=>[g(r(e.$t("commons.button.confirm")),1)]),_:1})])]),default:o(()=>[l(c(N),{ref_key:"timeoutFormRef",ref:P,"label-position":"top",model:b},{default:o(()=>[l(p,{label:e.$t("setting.days"),prop:"days",rules:[c(S).number,c(ye)(0,60)]},{default:o(()=>[l(f,{clearable:"",modelValue:b.days,"onUpdate:modelValue":t[7]||(t[7]=i=>b.days=i),modelModifiers:{number:!0}},null,8,["modelValue"]),s("span",Ee,r(e.$t("setting.expirationHelper")),1)]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Je as default};
